<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-02-20">
<meta name="description" content="mlr3 소개, mlr3 필수문법, mlr3 모델링 기초에 대해 배워봅시다.">

<title>Rchemist - mlr3 기초</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-QKQJ0CJQC4"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-QKQJ0CJQC4', { 'anonymize_ip': true});
</script>
<style>html{ scroll-behavior: smooth; }</style>
<link href="../../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../../site_libs/pagedtable-1.1/js/pagedtable.js"></script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Rchemist</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> <i class="bi bi-house" role="img">
</i> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> <i class="bi bi-file-person" role="img">
</i> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../gallery/index.html"> <i class="bi bi-sliders2" role="img">
</i> 
<span class="menu-text">Gallery</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">mlr3 기초</h1>
                  <div>
        <div class="description">
          mlr3 소개, mlr3 필수문법, mlr3 모델링 기초에 대해 배워봅시다.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">mlr3</div>
                <div class="quarto-category">R</div>
                <div class="quarto-category">machine learning</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 20, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sec-introduction" id="toc-sec-introduction" class="nav-link active" data-scroll-target="#sec-introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#r6" id="toc-r6" class="nav-link" data-scroll-target="#r6">R6</a>
  <ul class="collapse">
  <li><a href="#mlr3의-필수-활용요소" id="toc-mlr3의-필수-활용요소" class="nav-link" data-scroll-target="#mlr3의-필수-활용요소"><code>mlr3</code>의 필수 활용요소</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-basics" id="toc-sec-basics" class="nav-link" data-scroll-target="#sec-basics">Data &amp; Modeling</a>
  <ul class="collapse">
  <li><a href="#tasks" id="toc-tasks" class="nav-link" data-scroll-target="#tasks">Tasks</a>
  <ul class="collapse">
  <li><a href="#내장-태스크" id="toc-내장-태스크" class="nav-link" data-scroll-target="#내장-태스크">내장 태스크</a></li>
  <li><a href="#외부-데이터-태스크로-변환" id="toc-외부-데이터-태스크로-변환" class="nav-link" data-scroll-target="#외부-데이터-태스크로-변환">외부 데이터 태스크로 변환</a></li>
  <li><a href="#데이터-살펴보기" id="toc-데이터-살펴보기" class="nav-link" data-scroll-target="#데이터-살펴보기">데이터 살펴보기</a></li>
  <li><a href="#태스크-변환자mutators" id="toc-태스크-변환자mutators" class="nav-link" data-scroll-target="#태스크-변환자mutators">태스크 변환자(Mutators)</a></li>
  </ul></li>
  <li><a href="#learner" id="toc-learner" class="nav-link" data-scroll-target="#learner">Learner</a>
  <ul class="collapse">
  <li><a href="#train-학습시키기" id="toc-train-학습시키기" class="nav-link" data-scroll-target="#train-학습시키기">Train: 학습시키기</a></li>
  <li><a href="#predict-예측하기" id="toc-predict-예측하기" class="nav-link" data-scroll-target="#predict-예측하기">Predict: 예측하기</a></li>
  <li><a href="#hyperparameters" id="toc-hyperparameters" class="nav-link" data-scroll-target="#hyperparameters">Hyperparameters</a></li>
  <li><a href="#evaluation-평가" id="toc-evaluation-평가" class="nav-link" data-scroll-target="#evaluation-평가">Evaluation: 평가</a></li>
  </ul></li>
  <li><a href="#분류classification" id="toc-분류classification" class="nav-link" data-scroll-target="#분류classification">분류(Classification)</a>
  <ul class="collapse">
  <li><a href="#분류-모델-만들기" id="toc-분류-모델-만들기" class="nav-link" data-scroll-target="#분류-모델-만들기">분류 모델 만들기</a></li>
  <li><a href="#taskclassif" id="toc-taskclassif" class="nav-link" data-scroll-target="#taskclassif">TaskClassif</a></li>
  <li><a href="#learnerclassif-와-measureclassif" id="toc-learnerclassif-와-measureclassif" class="nav-link" data-scroll-target="#learnerclassif-와-measureclassif">LearnerClassif 와 MeasureClassif</a></li>
  <li><a href="#predictionclassif-confusion-matrix-thresholding" id="toc-predictionclassif-confusion-matrix-thresholding" class="nav-link" data-scroll-target="#predictionclassif-confusion-matrix-thresholding">PredictionClassif, Confusion Matrix, Thresholding</a></li>
  <li><a href="#지원되는-러너-알고리즘" id="toc-지원되는-러너-알고리즘" class="nav-link" data-scroll-target="#지원되는-러너-알고리즘">지원되는 러너 알고리즘</a></li>
  </ul></li>
  <li><a href="#결론" id="toc-결론" class="nav-link" data-scroll-target="#결론">결론</a></li>
  <li><a href="#레퍼런스" id="toc-레퍼런스" class="nav-link" data-scroll-target="#레퍼런스">레퍼런스</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
안내사항
</div>
</div>
<div class="callout-body-container callout-body">
<p>이 글은 <a href="https://mlr3book.mlr-org.com/">mlr3book</a><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>을 참고하여 작성되었습니다. 국내 R 사용자들에게 잘 알려지지 않은 <code>mlr3</code><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> 패키지를 활용하여 R에서도 손쉽게 머신러닝을 수행할 수 있다는 것을 보여드리고자 합니다.</p>
</div>
</div>
<section id="sec-introduction" class="level1">
<h1>Introduction</h1>
<p><code>mlr3</code> (Machine Learning in R) 패키지와 생태계는 R 언어에서 분류 (classification), 회귀 (regression), 기타 머신러닝 작업들을 수행할 수 있도록 도와주는 포괄적, 객체 지향적(Object Oriented), 확장 가능한 프레임워크입니다.</p>
<p><code>mlr3</code> 는 R의 <code>caret</code>, <code>tidymodels</code>, Python의 <code>scikit-learn</code>과 마찬가지로 여러 머신러닝 알고리즘들을 통합하여 하나의 통일된 인터페이스로 제공함으로써 머신러닝 작업을 더 적절하게 수행할 수 있게끔 도와주는 패키지입니다.</p>
<p>mlr3가 어떻게 작동하는지 빠르게 파악하고 싶으시다면, mlr3 <a href="https://cheatsheets.mlr-org.com/mlr3.pdf">cheatsheets</a>을 살펴보시기 바랍니다.</p>
<p><code>mlr3verse</code>는 <code>mlr3</code>의 생태계로써, 머신러닝을 위한 R 패키지들의 집합체로 이루어져 있습니다. <code>mlr3</code> 패키지에서는 머신러닝을 위한 기본적인 코드들을 제공하고, 추가적인 학습 알고리즘, 파라미터 튜닝, 피처 선택 등은 확장 패키지들을 통해 이용할 수 있습니다.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://mlr-org.com/ecosystem.html"><img src="https://raw.githubusercontent.com/mlr-org/mlr3/master/man/figures/mlr3verse.svg?sanitize=true" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="reference: mlr-org.com"></a></p>
</figure>
</div>
<figcaption>reference: mlr-org.com</figcaption>
</figure>
</div>
<p><code>mlr3</code> 생태계는 R의 <code>R6</code>와 <code>data.table</code>을 기반으로 만들어졌습니다. <code>R6</code>는 객체지향 (object orientation)을 위해, <code>data.table</code>은 데이터를 저장하고 작동시키기 위해 사용되었습니다.</p>
<p><code>mlr3</code>의 원활한 사용을 위해, 두 패키지의 기초를 살펴보도록 합시다.</p>
<section id="r6" class="level2">
<h2 class="anchored" data-anchor-id="r6">R6</h2>
<p>R6는 객체지향 프로그래밍 (OOP)을 위한 R의 최근 패러다임 중 하나입니다. R6는 S3와 같이 R에 존재하던 기존의 객체지향성의 단점을 해결하는것이 특징입니다. 아마 다른 프로그래밍 언어에서 객체 지향 개념을 다루어 보셨다면, R6가 더 익숙하게 느껴질 것입니다.</p>
<p><code>R6</code>에서 객체(object)는 <code>R6Class()</code> 생성자 객체와 더불어 <code>$new()</code>메소드를 통해 생성됩니다.</p>
<p>예를 들어 보겠습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(R6)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>Foo <span class="ot">=</span> <span class="fu">R6Class</span>()</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>foo <span class="ot">=</span> Foo<span class="sc">$</span><span class="fu">new</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이 객체들은 자신들의 필드 안에서 변환 가능하도록 압축된 상태를 띄고 있는데, 우리는 이 객체들에 <code>$</code> 기호를 통해 접근할 수 있습니다.</p>
<p>필드 뿐만 아니라, 객체들이 갖고 있는 메소드를 통해 각 객체의 상태를 파악하고 정보를 검색하거나, 객체의 내부 상태를 변경할 수 있습니다. 예를 들어 <code>mlr3</code> 의 학습모델(learner) 의 <code>$train()</code> 메소드를 통해, 모델을 학습된 상태로 변경할 수 있고, 이를 통해 예측을 할 수 있게 됩니다.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>R6</code> 객체의 내부 요소는 다음과 같이 부릅니다.</p>
<ul>
<li><p><code>$field</code>: 필드, 정보</p></li>
<li><p><code>$method()</code>: 메소드, 특정 동작 실행</p></li>
</ul>
</div>
</div>
<p><code>R6</code> 객체들은 각각의 환경(environment)로서, 참조 특성 (reference semantics)을 갖습니다. 예를 들어, foo2 = foo 를 실행할 시, foo2 는 foo가 복사된 것은 아니지만, 하나의 객체를 참조하고 있는 것입니다. 따라서, <code>foo$bar = 3</code> 을 실행할 시, <code>foo2$bar</code> 역시 3이 됩니다.</p>
<p>객체를 복사할 경우 <code>$clone()</code> 메소드와 <code>deep = TRUE</code> 인자를 사용해야 합니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>foo2 <span class="ot">=</span> foo<span class="sc">$</span><span class="fu">clone</span>(<span class="at">deep=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3verse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>R6에 대해 더 자세히 알고 싶다면, R6 <a href="https://r6.r-lib.org/">vignettes</a>, 특히 <a href="https://r6.r-lib.org/articles/Introduction.html">introduction</a>부분을 참고하세요. 포괄적인 R6의 정보를 얻고 싶다면, <a href="https://adv-r.hadley.nz/r6.html">Advanced R의 R6 챕터</a>를 참고하세요.</p>
</div>
</div>
<hr>
<section id="mlr3의-필수-활용요소" class="level3">
<h3 class="anchored" data-anchor-id="mlr3의-필수-활용요소"><code>mlr3</code>의 필수 활용요소</h3>
<section id="sugar-functions" class="level4">
<h4 class="anchored" data-anchor-id="sugar-functions">Sugar functions</h4>
<p>대부분의 <code>mlr3</code> 객체들은 sugar function으로 불리는 간편한 함수들을 제공합니다. 다시 말해, sugar function은 원래의 코드에 대한 단축키(shortcut)로서 사용자가 입력해야 하는 코드를 줄여줍니다. 예를 들어 <code>lrn("regr.rpart")</code> 는 <code>LearnerRegrRpart$new()</code> 의 sugar 버전입니다.</p>
</section>
<section id="dictionaries" class="level4">
<h4 class="anchored" data-anchor-id="dictionaries">Dictionaries</h4>
<p><code>mlr3</code>는 러너(<code>learners</code>)나 태스크(<code>tasks</code>) 객체들을 저장하기 위해 dictionary 구조를 사용합니다. dictionary 구조는 key와 value로 이루어져 있어 key와 value를 연관시켜주는데, 이는 실제 사전의 단어와 단어의 설명과 같다고 이해하시면 됩니다.</p>
<p>dictionary는 연관된 객체들을 묶어 나열하고 검색하기 쉽게 하기 위해 사용됩니다. 예를 들어 특정 학습모델을 검색할 때, <code>mlr_learners</code> dictionary에 원하는 러너(key)를 입력하면 검색이 가능합니다.</p>
<p>예를 들면 다음과 같습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(mlr3)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>mlr_learners<span class="sc">$</span><span class="fu">get</span>(<span class="st">'classif.rpart'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;LearnerClassifRpart:classif.rpart&gt;: Classification Tree
* Model: -
* Parameters: xval=0
* Packages: mlr3, rpart
* Predict Types:  [response], prob
* Feature Types: logical, integer, numeric, factor, ordered
* Properties: importance, missings, multiclass, selected_features,
  twoclass, weights</code></pre>
</div>
</div>
<p>또한 <code>as.data.table(mlr3_learners)</code> 모든 학습 모델의 정보를 확인할 수도 있습니다.</p>
</section>
<section id="mlr3viz" class="level4">
<h4 class="anchored" data-anchor-id="mlr3viz"><code>mlr3viz</code></h4>
<p><code>mlr3viz</code>는 <code>mlr3</code> 생태계 안에서 시각화를 담당하는 패키지입니다. <code>ggplot2</code>의 <code>theme_minimal()</code>을 적용시킨 동일한 배경의 그래프들을 생성합니다. <code>mlr3viz</code>는 <code>ggplot2</code> 를 기반으로 하고 있으며, <code>fortify</code>와 <code>autoplot</code> 라는 확장 패키지를 통해 예측, 학습모델, 벤치마크 객체 등 <code>mlr3</code>의 결과물들을 시각화하는 데 사용됩니다. <code>mlr3viz</code>에서 가장 많이 사용되는 것은 <code>autoplot()</code>으로, 객체의 타입에 따라 그래프의 출력 결과가 결정됩니다.</p>
<hr>
</section>
</section>
</section>
</section>
<section id="sec-basics" class="level1">
<h1>Data &amp; Modeling</h1>
<section id="tasks" class="level2">
<h2 class="anchored" data-anchor-id="tasks">Tasks</h2>
<p>태스크(<code>task</code>)는 일반적으로 테이블 형태의 데이터와 머신러닝 문제들을 정의한 메타데이터를 갖고 있는 객체입니다. 예를 들면 머신러닝의 분류에서 타겟 피처(feature)의 이름이 메타 데이터 입니다.</p>
<p>한마디로, 태스크는 우리가 활용하는 기본 데이터와 머신러닝을 위해 필요한 데이터들을 담아둔 정보 등이 포함된 객체입니다.</p>
<p>이 메타 데이터는 사용자가 모덜이 학습될 때 예측 타겟을 다시 지정해줄 필요 없도록 태스크와 함께 작동하게 됩니다.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
용어 표현
</div>
</div>
<div class="callout-body-container callout-body">
<p>Task와 Learner 등 영어로 지정된 단어들은 따로 번역하지 않고, 소리 그대로 <strong>“태스크”</strong>와 <strong>“러너”</strong>로 부르겠습니다.</p>
</div>
</div>
<section id="내장-태스크" class="level3">
<h3 class="anchored" data-anchor-id="내장-태스크">내장 태스크</h3>
<p><code>mlr3</code>에는 <code>mlr_tasks</code>라고 하는 R6 Dictionary 를 통해 미리 지정된 머신러닝 태스크를 제공하고 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mlr_tasks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;DictionaryTask&gt; with 20 stored values
Keys: bike_sharing, boston_housing, breast_cancer, german_credit, ilpd,
  iris, kc_housing, moneyball, mtcars, optdigits, penguins,
  penguins_simple, pima, ruspini, sonar, spam, titanic, usarrests,
  wine, zoo</code></pre>
</div>
</div>
<p><code>mlr_tasks</code>에 내장된 태스크를 가져오기 위해선, <code>tsk()</code> 함수와 불러오고자 하는 태스크의 이름을 입력하면 됩니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>task_mtcars <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"mtcars"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>task_mtcars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;TaskRegr:mtcars&gt; (32 x 11): Motor Trends
* Target: mpg
* Properties: -
* Features (10):
  - dbl (10): am, carb, cyl, disp, drat, gear, hp, qsec, vs, wt</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
도움말 보기
</div>
</div>
<div class="callout-body-container callout-body">
<p>일반적으로 R에서 도움말을 보기 위해선 <code>help()</code>나 <code>?</code>를 이용합니다. mlr3의 <code>R6</code> 클래스들도 마찬가지로 <code>?mlr_tasks_mtcars</code>와 같이 <code>?</code>을 이용해서 도움말을 찾아볼 수 있습니다. 뿐만 아니라 인스턴스의 <code>task_mtcars$help()</code>와 같이 <code>$help()</code> 메소드를 이용해, 도움말 페이지로 접근할 수 있습니다.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>task_sonar <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">'sonar'</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>split <span class="ot">=</span> <span class="fu">partition</span>(task_sonar, <span class="at">ratio=</span>.<span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="외부-데이터-태스크로-변환" class="level3">
<h3 class="anchored" data-anchor-id="외부-데이터-태스크로-변환">외부 데이터 태스크로 변환</h3>
<p><code>mlr3</code>에서 제공하는 데이터가 아닌, 외부의 데이터셋을 <code>mlr3</code> 태스크로 활용하려면 아래와 같이 데이터셋을 태스크로 변환하는 작업이 필요합니다. 예를 들어, <code>mtcars</code> 데이터셋을 <code>mlr3</code>의 회귀 태스크로 직접 변환하고자 할 때, <code>as_task_regr()</code> 함수를 이용합니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>mtcars_subset <span class="ot">=</span> <span class="fu">subset</span>(mtcars, <span class="at">select =</span> <span class="fu">c</span>(<span class="st">"mpg"</span>, <span class="st">"cyl"</span>, <span class="st">"disp"</span>))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mtcars_subset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   32 obs. of  3 variables:
 $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
 $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...
 $ disp: num  160 160 108 258 360 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>tsk_mtcars <span class="ot">=</span> <span class="fu">as_task_regr</span>(mtcars_subset, <span class="at">target=</span><span class="st">"mpg"</span>, <span class="at">id=</span><span class="st">"cars"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>태스크를 설정할 때, 반드시 <code>target</code> 인자를 지정해줌으로써 target 열을 지정합니다. <code>id</code> 인자는 선택사항으로, 특정 태스크에 이름을 부여하는 것입니다.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
UTF8 열(column)이름
</div>
</div>
<div class="callout-body-container callout-body">
<p>외부의 데이터를 태스크로 변환할 때, <a href="https://en.wikipedia.org/wiki/UTF-8">UTF8 이름</a>을 따르지 않는 경우, 머신러닝 학습과정에서 오류가 발생합니다. 따라서 <code>make.names()</code> 함수를 이용해 데이터의 열 이름을 변경하는 것을 권장합니다.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3viz)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(tsk_mtcars, <span class="at">type =</span> <span class="st">"pairs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="데이터-살펴보기" class="level3">
<h3 class="anchored" data-anchor-id="데이터-살펴보기">데이터 살펴보기</h3>
<p>태스크 객체는 테이블 형태의 데이터와 함께, 메타 데이터를 포함하고 있습니다. 예를 들면 행과 열의 개수, 피처(feature) 변수, 타겟 변수와 각 변수의 데이터유형 등을 확인할 수 있습니다.</p>
<p>이런 메타 데이터들은 각 객체의 field를 통해 확인이 가능합니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(tsk_mtcars<span class="sc">$</span>nrow, tsk_mtcars<span class="sc">$</span>ncol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 32  3</code></pre>
</div>
</div>
<p>피처와 타겟변수의 이름은 각각 <code>$feature_names</code> 와 <code>$target_names</code> 에 저장되어 있습니다. 여기서 <code>target</code>은 예측하고자 하는 변수를 의미합니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>tsk_mtcars<span class="sc">$</span>feature_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "cyl"  "disp"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>tsk_mtcars<span class="sc">$</span>target_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "mpg"</code></pre>
</div>
</div>
<p>한편 태스크 안에 들어있는 데이터는 <code>data.table</code> 객체로, <code>$data()</code> 메소드를 통해 확인할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>tsk_mtcars<span class="sc">$</span><span class="fu">data</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["mpg"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["cyl"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["disp"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"21.0","2":"6","3":"160.0"},{"1":"21.0","2":"6","3":"160.0"},{"1":"22.8","2":"4","3":"108.0"},{"1":"21.4","2":"6","3":"258.0"},{"1":"18.7","2":"8","3":"360.0"},{"1":"18.1","2":"6","3":"225.0"},{"1":"14.3","2":"8","3":"360.0"},{"1":"24.4","2":"4","3":"146.7"},{"1":"22.8","2":"4","3":"140.8"},{"1":"19.2","2":"6","3":"167.6"},{"1":"17.8","2":"6","3":"167.6"},{"1":"16.4","2":"8","3":"275.8"},{"1":"17.3","2":"8","3":"275.8"},{"1":"15.2","2":"8","3":"275.8"},{"1":"10.4","2":"8","3":"472.0"},{"1":"10.4","2":"8","3":"460.0"},{"1":"14.7","2":"8","3":"440.0"},{"1":"32.4","2":"4","3":"78.7"},{"1":"30.4","2":"4","3":"75.7"},{"1":"33.9","2":"4","3":"71.1"},{"1":"21.5","2":"4","3":"120.1"},{"1":"15.5","2":"8","3":"318.0"},{"1":"15.2","2":"8","3":"304.0"},{"1":"13.3","2":"8","3":"350.0"},{"1":"19.2","2":"8","3":"400.0"},{"1":"27.3","2":"4","3":"79.0"},{"1":"26.0","2":"4","3":"120.3"},{"1":"30.4","2":"4","3":"95.1"},{"1":"15.8","2":"8","3":"351.0"},{"1":"19.7","2":"6","3":"145.0"},{"1":"15.0","2":"8","3":"301.0"},{"1":"21.4","2":"4","3":"121.0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><code>$data()</code> 메소드 안에서 rows와 cols를 통해 원하는 데이터를 확인할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>tsk_mtcars<span class="sc">$</span><span class="fu">data</span>(<span class="at">rows=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">cols=</span>tsk_mtcars<span class="sc">$</span>feature_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["cyl"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["disp"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"6","2":"160"},{"1":"6","2":"160"},{"1":"4","2":"108"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>태스크를 <code>data.table</code> 객체로 바꾼다면, R에서 사용되는 데이터프레임 관련 모든 함수들을 사용할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">as.data.table</span>(tsk_mtcars))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      mpg             cyl             disp      
 Min.   :10.40   Min.   :4.000   Min.   : 71.1  
 1st Qu.:15.43   1st Qu.:4.000   1st Qu.:120.8  
 Median :19.20   Median :6.000   Median :196.3  
 Mean   :20.09   Mean   :6.188   Mean   :230.7  
 3rd Qu.:22.80   3rd Qu.:8.000   3rd Qu.:326.0  
 Max.   :33.90   Max.   :8.000   Max.   :472.0  </code></pre>
</div>
</div>
</section>
<section id="태스크-변환자mutators" class="level3">
<h3 class="anchored" data-anchor-id="태스크-변환자mutators">태스크 변환자(Mutators)</h3>
<p>머신러닝을 수행하며, 행과 열들을 선택하는 경우가 종종 있습니다. 예를 들면 훈련 데이터와 검증 데이터를 분리하기 위해 행을 선택하는 경우, 모델링에 넣을 피처들을 선택하는 경우가 있겠죠.</p>
<p><code>mlr3</code>의 태스크는 행을 선택하는 <code>$filter()</code>, 열을 선택하는 <code>$select()</code> 를 이용해 원하는 조건의 데이터를 추출할 수 있습니다.</p>
<p>여기서 한 가지 주의해야 할 것이 있습니다. <code>$select()</code>와 <code>$filter()</code>는 변환자이기 때문에, 기존의 태스크 객체를 수정하게 됩니다. 다시 말해, 행이나 열을 선택하게 되면 처음의 태스크 객체도 변경된다는 것이죠.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>task_iris <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"iris"</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>task_iris<span class="sc">$</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"Sepal.Length"</span>,<span class="st">"Petal.Width"</span>))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>task_iris<span class="sc">$</span><span class="fu">filter</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>task_iris<span class="sc">$</span><span class="fu">data</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Species"],"name":[1],"type":["fct"],"align":["left"]},{"label":["Petal.Width"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Sepal.Length"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"setosa","2":"0.2","3":"4.9"},{"1":"setosa","2":"0.2","3":"4.7"},{"1":"setosa","2":"0.2","3":"4.6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>이를 방지하기 위해서는 <code>$clone()</code> 메소드를 이용해 새로운 태스크로 복사한 뒤에 행이나 열을 선택하는 작업하시면 됩니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>task_iris_copy <span class="ot">=</span> task_iris<span class="sc">$</span><span class="fu">clone</span>()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>task_iris_copy<span class="sc">$</span><span class="fu">filter</span>(<span class="dv">2</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>task_iris_copy<span class="sc">$</span><span class="fu">data</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Species"],"name":[1],"type":["fct"],"align":["left"]},{"label":["Petal.Width"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Sepal.Length"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"setosa","2":"0.2","3":"4.9"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>task_iris<span class="sc">$</span><span class="fu">data</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Species"],"name":[1],"type":["fct"],"align":["left"]},{"label":["Petal.Width"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Sepal.Length"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"setosa","2":"0.2","3":"4.9"},{"1":"setosa","2":"0.2","3":"4.7"},{"1":"setosa","2":"0.2","3":"4.6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><code>task_iris_copy</code>는 <code>task_iris</code>를 복사한 뒤, 2번째 행을 <code>$filter()</code> 했지만, <code>task_iris</code>의 데이터는 아무 변화가 없는 것을 확인할 수 있습니다.</p>
</section>
</section>
<section id="learner" class="level2">
<h2 class="anchored" data-anchor-id="learner">Learner</h2>
<p>러너 클래스는 널리 알려진 다양한 머신러닝 알고리즘들을 통일된 형태로 제공합니다. 태스크와 마찬가지로 <code>mlr_learners</code> dictionary를 통해 확인할 수 있습니다.</p>
<p>러너는 머신러닝 모델을 학습(train)하고 예측하는 역할을 수행합니다. 태스크와 마찬가지로, 러너의 sugar function인 <code>lrn()</code> 을 활용해 러너를 사용할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrn</span>(<span class="st">"regr.rpart"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;LearnerRegrRpart:regr.rpart&gt;: Regression Tree
* Model: -
* Parameters: xval=0
* Packages: mlr3, rpart
* Predict Types:  [response]
* Feature Types: logical, integer, numeric, factor, ordered
* Properties: importance, missings, selected_features, weights</code></pre>
</div>
</div>
<p>러너의 기본 형태는 <code>Learner</code>입니다. Learner로 시작하는 다양한 러너들이 존재합니다. <code>mlr3</code>의 러너들은 <a href="https://mlr3learners.mlr-org.com/"><code>mlr3learners</code></a>와 <a href="https://mlr3extralearners.mlr-org.com/"><code>mlr3extralearners</code></a>패키지를 통해 확인 가능합니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.table</span>(mlr_learners) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["key"],"name":[1],"type":["chr"],"align":["left"]},{"label":["label"],"name":[2],"type":["chr"],"align":["left"]},{"label":["task_type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["feature_types"],"name":[4],"type":["list"],"align":["right"]},{"label":["packages"],"name":[5],"type":["list"],"align":["right"]},{"label":["properties"],"name":[6],"type":["list"],"align":["right"]},{"label":["predict_types"],"name":[7],"type":["list"],"align":["right"]}],"data":[{"1":"classif.cv_glmnet","2":"NA","3":"classif","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [4]>","7":"<chr [2]>"},{"1":"classif.debug","2":"Debug Learner for Classification","3":"classif","4":"<chr [6]>","5":"<chr [1]>","6":"<chr [4]>","7":"<chr [2]>"},{"1":"classif.featureless","2":"Featureless Classification Learner","3":"classif","4":"<chr [7]>","5":"<chr [1]>","6":"<chr [6]>","7":"<chr [2]>"},{"1":"classif.glmnet","2":"NA","3":"classif","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [3]>","7":"<chr [2]>"},{"1":"classif.kknn","2":"NA","3":"classif","4":"<chr [5]>","5":"<chr [3]>","6":"<chr [2]>","7":"<chr [2]>"},{"1":"classif.lda","2":"NA","3":"classif","4":"<chr [5]>","5":"<chr [3]>","6":"<chr [3]>","7":"<chr [2]>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
패키지 설치
</div>
</div>
<div class="callout-body-container callout-body">
<p>mlr3의 러너를 실행하기 위한 패키지가 없다면 아래와 같은 경고 메시지가 뜹니다.</p>
<pre><code>Warning: Package 'ranger' required but not installed for Learner 'classif.ranger</code></pre>
<p>이러한 에러는 패키지를 설치해주시면 간단히 해결됩니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"ranger"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>lrn_rpart <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">'regr.rpart'</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>lrn_rpart</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;LearnerRegrRpart:regr.rpart&gt;: Regression Tree
* Model: -
* Parameters: xval=0
* Packages: mlr3, rpart
* Predict Types:  [response]
* Feature Types: logical, integer, numeric, factor, ordered
* Properties: importance, missings, selected_features, weights</code></pre>
</div>
</div>
<p>각 러너들은 아래의 메타데이터를 갖고 있습니다.</p>
<ul>
<li><p><code>$feature_types</code>: 피처들의 유형</p></li>
<li><p><code>$packages</code>: 모델을 학습시키고 예측하기 위해 필요한 패키지들</p></li>
<li><p><code>$properties</code>: 해당 러너가 갖고 있는 추가적인 특성. 예를 들어 importance 특성이 있다면 학습 후, 각 피처들의 importance를 추출할 수 있습니다.</p></li>
<li><p><code>$predict_types</code>: 해당 러너를 활용해 가능한 예측 유형입니다. 분류 유형의 러너는 <code>response</code>와 <code>prob</code>을 출력합니다.</p></li>
<li><p><code>$param_set</code>: 가능한 하이퍼파라미터 세트</p></li>
</ul>
<p><br></p>
<p>모든 러너들은 두 단계에 걸쳐 진행됩니다.</p>
<ul>
<li><p>학습 (Training): <code>$train()</code> 메소드를 통해 학습시키고자 하는 태스크를 학습합니다.</p></li>
<li><p>예측 (Prediction): <code>$predict()</code> 메소드에 학습 때 사용하지 않은 데이터를 사용합니다. 학습 데이터를 기반으로 훈련된 모델이 새로운 데이터를 받아 예측값을 반환합니다.</p></li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
예측 전 학습
</div>
</div>
<div class="callout-body-container callout-body">
<p>러너가 학습되지 않았다면(<code>$train()</code>이 실시되지 않았다면) <code>$predict()</code> 실행 시 에러가 발생합니다.</p>
</div>
</div>
<section id="train-학습시키기" class="level3">
<h3 class="anchored" data-anchor-id="train-학습시키기">Train: 학습시키기</h3>
<p>앞서 말했듯이, <code>mlr3</code>에서는 러너에 태스크를 투입하여 모델을 학습시킵니다. 머신러닝에서는 태스크를 투입하기 전, 훈련에 사용할 데이터와 예측에 사용할 데이터를 나누는 것이 일반적입니다.</p>
<p><code>mlr3</code> 에서는 <code>$partition()</code> 메소드를 이용해 두 개의 데이터로 나눌 수 있습니다. 기본값(default)은 전체 데이터의 67%를 훈련에, 나머지 33%를 예측에 사용합니다. 물론 이 비율은 ratio 인자 (범위: 0~1)를 통해 변경 가능합니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>splits <span class="ot">=</span> <span class="fu">partition</span>(tsk_mtcars, <span class="at">ratio =</span> <span class="fl">0.7</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>splits</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$train
 [1]  1  4  5  9 10 21 25 27 32  6  7 11 12 15 17 22 23 24 31 18 19 20 28

$test
[1]  2  3  8 30 13 14 16 29 26</code></pre>
</div>
</div>
<p>데이터를 나누었으니, 이제 모델을 학습시켜보도록 하겠습니다. 위에서 선언한 <code>rpart</code> 러너에서 <code>$train()</code> 메소드를 실행시킵니다. 태스크와 <code>row_ids</code>에는 splits 중 <code>train</code>에 해당하는 부분을 입력합니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span><span class="fu">train</span>(tsk_mtcars, <span class="at">row_ids =</span> splits<span class="sc">$</span>train)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>n= 23 

node), split, n, deviance, yval
      * denotes terminal node

1) root 23 901.0783 20.3913  
  2) cyl&gt;=5 15 127.9240 16.6800 *
  3) cyl&lt; 5 8 179.1600 27.3500 *</code></pre>
</div>
</div>
<p>학습을 시킨 이후, <code>$model</code> 필드를 통해 학습된 결과를 확인할 수 있습니다.</p>
</section>
<section id="predict-예측하기" class="level3">
<h3 class="anchored" data-anchor-id="predict-예측하기">Predict: 예측하기</h3>
<p>모델 학습이 완료되었다면, 예측값을 만들어볼 수 있습니다. splits의 test 행을 이용해 <code>$predict()</code> 메소드를 실행합니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">=</span> lrn_rpart<span class="sc">$</span><span class="fu">predict</span>(tsk_mtcars,<span class="at">row_ids =</span> splits<span class="sc">$</span>test)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>prediction</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;PredictionRegr&gt; for 9 observations:
    row_ids truth response
          2  21.0    16.68
          3  22.8    27.35
          8  24.4    27.35
---                       
         16  10.4    16.68
         29  15.8    16.68
         26  27.3    27.35</code></pre>
</div>
</div>
<p><code>row_ids</code> 는 예측 데이터의 행의 번호와 동일합니다. <code>truth</code>는 태스크에 저장되어 있는 테스트 데이터의 실제값을 의미하고 <code>response</code>는 학습시킨 모델이 예측한 값을 의미합니다. 각각의 열은 <code>Prediction</code> 객체의 필드를 통해 확인할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span>response</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16.68 27.35 27.35 16.68 16.68 16.68 16.68 16.68 27.35</code></pre>
</div>
</div>
<p><code>mlr3viz</code>를 이용해 Prediction 객체를 시각화할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(prediction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>만약 splits로 나눈 데이터가 아니라 데이터프레임 형태로 된 새로운 데이터를 활용해 예측값을 만들고 싶다면, <code>$predict_newdata()</code>를 사용하면 됩니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>mtcars_new <span class="ot">=</span> <span class="fu">data.table</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">cyl =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>), <span class="at">disp =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">120</span>),</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">hp =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">150</span>), <span class="at">drat =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="fl">3.9</span>), <span class="at">wt =</span> <span class="fu">c</span>(<span class="fl">3.8</span>, <span class="fl">4.1</span>),</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">qsec =</span> <span class="fu">c</span>(<span class="dv">18</span>, <span class="fl">19.5</span>), <span class="at">vs =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="at">am =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">gear =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">4</span>), <span class="at">carb =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">=</span> lrn_rpart<span class="sc">$</span><span class="fu">predict_newdata</span>(mtcars_new)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>prediction</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;PredictionRegr&gt; for 2 observations:
 row_ids truth response
       1    NA    16.68
       2    NA    16.68</code></pre>
</div>
</div>
<p>물론 새로 생성한 <code>mtcars_new</code> 데이터는 실제 값이 제공되지 않았기 때문에, <code>Prediction</code> 객체의 truth는 <code>NA</code>로 출력됩니다.</p>
<p>일반적으로 회귀 모델에서는 타겟의 값을 예측하지만, 일부 회귀 모델은 표준 오차(standard error, SE) 또한 예측할 수 있습니다. 이를 위해서는 <code>$predict_type</code> 필드가 기본값인 <code>response</code> 에서 <code>se</code>로 변경되어야 합니다. 위에서 다루었던 의사결정나무(<code>regr.rpart</code>) 모델은 표준오차 설정이 불가능하기 때문에, 선형 회귀모형으로 예시를 들어보겠습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>lrn_lm <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.lm"</span>, <span class="at">predict_type =</span> <span class="st">"se"</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>lrn_lm<span class="sc">$</span><span class="fu">train</span>(tsk_mtcars, splits<span class="sc">$</span>train)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>lrn_lm<span class="sc">$</span><span class="fu">predict</span>(tsk_mtcars, splits<span class="sc">$</span>test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;PredictionRegr&gt; for 9 observations:
    row_ids truth response       se
          2  21.0 22.11158 1.192766
          3  22.8 26.64815 1.167893
          8  24.4 25.90958 1.393723
---                                
         16  10.4 12.84206 1.940138
         29  15.8 14.92227 1.042515
         26  27.3 27.20160 1.172699</code></pre>
</div>
</div>
</section>
<section id="hyperparameters" class="level3">
<h3 class="anchored" data-anchor-id="hyperparameters">Hyperparameters</h3>
<p>각 러너들은 학습에 영향을 미치는 하이퍼파라미터들을 설정해줄 수 있습니다. 하이퍼라미터를 통해 모델이 어떻게 학습되는지, 또는 어떻게 예측값을 생성할지 등을 조정해줄 수 있습니다.</p>
<section id="paradox-parameter-sets" class="level4">
<h4 class="anchored" data-anchor-id="paradox-parameter-sets">Paradox, Parameter Sets</h4>
<p>위의 예시에서 사용하던 의사결정나무 하이퍼파라미터에 접근해보겠습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span>param_set</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;ParamSet&gt;
                id    class lower upper nlevels
            &lt;char&gt;   &lt;char&gt; &lt;num&gt; &lt;num&gt;   &lt;num&gt;
 1:             cp ParamDbl     0     1     Inf
 2:     keep_model ParamLgl    NA    NA       2
 3:     maxcompete ParamInt     0   Inf     Inf
 4:       maxdepth ParamInt     1    30      30
 5:   maxsurrogate ParamInt     0   Inf     Inf
 6:      minbucket ParamInt     1   Inf     Inf
 7:       minsplit ParamInt     1   Inf     Inf
 8: surrogatestyle ParamInt     0     1       2
 9:   usesurrogate ParamInt     0     2       3
10:           xval ParamInt     0   Inf     Inf
                                                                                      default
                                                                                       &lt;list&gt;
 1:                                                                                      0.01
 2:                                                                                     FALSE
 3:                                                                                         4
 4:                                                                                        30
 5:                                                                                         5
 6: &lt;NoDefault&gt;\n  Public:\n    clone: function (deep = FALSE) \n    initialize: function () 
 7:                                                                                        20
 8:                                                                                         0
 9:                                                                                         2
10:                                                                                        10
     value
    &lt;list&gt;
 1:       
 2:       
 3:       
 4:       
 5:       
 6:       
 7:       
 8:       
 9:       
10:      0</code></pre>
</div>
</div>
<p>위의 결과는 <code>paradox::ParamSet</code> 객체입니다. 이 객체는 하이퍼파라미터의 이름(<code>id</code>), 데이터 유형(<code>class</code>), 하이퍼파라미터의 범위(<code>lower</code>, <code>upper</code>), 범주형일 경우의 범주의 수(<code>nlevels</code>), 초기값(<code>default</code>), 그리고 최종적으로 설정된 값(<code>value</code>) 에 대한 정보를 담고 있습니다.</p>
<p>아래의 표는 사용가능한 하이퍼파라미터 유형들에 대한 표입니다.</p>
<table class="table">
<thead>
<tr class="header">
<th>Hyperparameter Class</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>ParamDbl</code></td>
<td>Real-valued (Numeric) Parameters</td>
</tr>
<tr class="even">
<td><code>ParamInt</code></td>
<td>Integer Parameters</td>
</tr>
<tr class="odd">
<td><code>ParamFct</code></td>
<td>Categorical (Factor) Parameters</td>
</tr>
<tr class="even">
<td><code>ParamLgl</code></td>
<td>Logical / Boolean Parameters</td>
</tr>
<tr class="odd">
<td><code>ParamUty</code></td>
<td>Untyped Parameters</td>
</tr>
</tbody>
</table>
<p>의사결정나무 예시에서, <code>ParamSet</code>을 바탕으로 다음의 내용을 추론할 수 있습니다.</p>
<ul>
<li><code>cp</code> 는 반드시 0 (<code>lower</code>)과 1 (<code>upper</code>) 사이의 범위를 갖는 double (<code>ParamDbl</code>) 형태의 변수여야 하고, 초기값은 0.01 (<code>default</code>)</li>
<li><code>keep_model</code>은 반드시 <code>TRUE나</code> <code>FALSE</code> 값을 갖는 logical (<code>ParamLgl</code>) 형태의 값이어야 함</li>
<li><code>xval</code>은 0과 무한대(Inf) 범위를 갖는 정수(ParamInt)여야 하고, 초기값 10을 가지며, 현재 값이 0으로 설정되어 있음</li>
</ul>
</section>
<section id="하이퍼파리미터-확인-및-설정" class="level4">
<h4 class="anchored" data-anchor-id="하이퍼파리미터-확인-및-설정">하이퍼파리미터 확인 및 설정</h4>
<p>위와 같이 하이퍼 파라미터에 접근한 뒤, 기존의 값을 원하는 값으로 변경하거나, 새로운 하이퍼파라미터에 값을 설정해줄 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span>param_set<span class="sc">$</span>values<span class="sc">$</span>cp <span class="ot">=</span> <span class="fl">0.2</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span>param_set<span class="sc">$</span>values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$xval
[1] 0

$cp
[1] 0.2</code></pre>
</div>
</div>
<p>변경된 파라미터가 적용된 것을 확인할 수 있습니다.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
하이퍼파라미터 최적화
</div>
</div>
<div class="callout-body-container callout-body">
<p>하이퍼 파라미터에 대한 자세한 설명은 <a href="https://rchemistblog.com/blog/posts/mlr3_hyperparameter/">mlr3 하이퍼파라미터 최적화 포스트</a>에서 더 자세히 다루도록 하겠습니다.</p>
</div>
</div>
</section>
</section>
<section id="evaluation-평가" class="level3">
<h3 class="anchored" data-anchor-id="evaluation-평가">Evaluation: 평가</h3>
<p>아마 머신러닝 모델링 과정에서 가장 중요한 단계가 바로 모델의 성능 평가일 것입니다. 평가를 하지 않는다면 아무리 잘 만든 모델이라도 그 성능을 알 수 없기 때문이죠. 평가에서는 앞서 만든 객체들을 바탕으로 모델의 성능을 평가해보도록 하겠습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>lrn_rpart <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.rpart"</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>tsk_mtcars <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"mtcars"</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>splits <span class="ot">=</span> <span class="fu">partition</span>(tsk_mtcars)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span><span class="fu">train</span>(tsk_mtcars, splits<span class="sc">$</span>train)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">=</span> lrn_rpart<span class="sc">$</span><span class="fu">predict</span>(tsk_mtcars, splits<span class="sc">$</span>test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="measures" class="level4">
<h4 class="anchored" data-anchor-id="measures">Measures</h4>
<p>예측값이 잘 예측되었는지는 데이터의 실제값과 머신러닝 모델이 예측한 예측값의 비교를 통해 평가됩니다. 태스크와 러너와 비슷하게, <code>mlr3</code>에서는 측정기준들이 <code>mlr_measures</code>라고 불리는 딕셔너리에 저장되어 있습니다. 이는 <code>msr()</code>로 사용 가능합니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.table</span>(<span class="fu">msr</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["key"],"name":[1],"type":["chr"],"align":["left"]},{"label":["label"],"name":[2],"type":["chr"],"align":["left"]},{"label":["task_type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["packages"],"name":[4],"type":["list"],"align":["right"]},{"label":["predict_type"],"name":[5],"type":["chr"],"align":["left"]},{"label":["task_properties"],"name":[6],"type":["list"],"align":["right"]}],"data":[{"1":"aic","2":"Akaike Information Criterion","3":"NA","4":"<chr [1]>","5":"NA","6":"<chr [0]>"},{"1":"bic","2":"Bayesian Information Criterion","3":"NA","4":"<chr [1]>","5":"NA","6":"<chr [0]>"},{"1":"classif.acc","2":"Classification Accuracy","3":"classif","4":"<chr [2]>","5":"response","6":"<chr [0]>"},{"1":"classif.auc","2":"Area Under the ROC Curve","3":"classif","4":"<chr [2]>","5":"prob","6":"<chr [1]>"},{"1":"classif.bacc","2":"Balanced Accuracy","3":"classif","4":"<chr [2]>","5":"response","6":"<chr [0]>"},{"1":"classif.bbrier","2":"Binary Brier Score","3":"classif","4":"<chr [2]>","5":"prob","6":"<chr [1]>"},{"1":"classif.ce","2":"Classification Error","3":"classif","4":"<chr [2]>","5":"response","6":"<chr [0]>"},{"1":"classif.costs","2":"Cost-sensitive Classification","3":"classif","4":"<chr [1]>","5":"response","6":"<chr [0]>"},{"1":"classif.dor","2":"Diagnostic Odds Ratio","3":"classif","4":"<chr [2]>","5":"response","6":"<chr [1]>"},{"1":"classif.fbeta","2":"F-beta score","3":"classif","4":"<chr [2]>","5":"response","6":"<chr [1]>"},{"1":"classif.fdr","2":"False Discovery Rate","3":"classif","4":"<chr [2]>","5":"response","6":"<chr [1]>"},{"1":"classif.fn","2":"False Negatives","3":"classif","4":"<chr [2]>","5":"response","6":"<chr [1]>"},{"1":"classif.fnr","2":"False Negative Rate","3":"classif","4":"<chr [2]>","5":"response","6":"<chr [1]>"},{"1":"classif.fomr","2":"False Omission Rate","3":"classif","4":"<chr [2]>","5":"response","6":"<chr [1]>"},{"1":"classif.fp","2":"False Positives","3":"classif","4":"<chr [2]>","5":"response","6":"<chr [1]>"},{"1":"classif.fpr","2":"False Positive Rate","3":"classif","4":"<chr [2]>","5":"response","6":"<chr [1]>"},{"1":"classif.logloss","2":"Log Loss","3":"classif","4":"<chr [2]>","5":"prob","6":"<chr [0]>"},{"1":"classif.mauc_au1p","2":"Weighted average 1 vs. 1 multiclass AUC","3":"classif","4":"<chr [2]>","5":"prob","6":"<chr [0]>"},{"1":"classif.mauc_au1u","2":"Average 1 vs. 1 multiclass AUC","3":"classif","4":"<chr [2]>","5":"prob","6":"<chr [0]>"},{"1":"classif.mauc_aunp","2":"Weighted average 1 vs. rest multiclass AUC","3":"classif","4":"<chr [2]>","5":"prob","6":"<chr [0]>"},{"1":"classif.mauc_aunu","2":"Average 1 vs. rest multiclass AUC","3":"classif","4":"<chr [2]>","5":"prob","6":"<chr [0]>"},{"1":"classif.mbrier","2":"Multiclass Brier Score","3":"classif","4":"<chr [2]>","5":"prob","6":"<chr [0]>"},{"1":"classif.mcc","2":"Matthews Correlation Coefficient","3":"classif","4":"<chr [2]>","5":"response","6":"<chr [1]>"},{"1":"classif.npv","2":"Negative Predictive Value","3":"classif","4":"<chr [2]>","5":"response","6":"<chr [1]>"},{"1":"classif.ppv","2":"Positive Predictive Value","3":"classif","4":"<chr [2]>","5":"response","6":"<chr [1]>"},{"1":"classif.prauc","2":"Precision-Recall Curve","3":"classif","4":"<chr [2]>","5":"prob","6":"<chr [1]>"},{"1":"classif.precision","2":"Precision","3":"classif","4":"<chr [2]>","5":"response","6":"<chr [1]>"},{"1":"classif.recall","2":"Recall","3":"classif","4":"<chr [2]>","5":"response","6":"<chr [1]>"},{"1":"classif.sensitivity","2":"Sensitivity","3":"classif","4":"<chr [2]>","5":"response","6":"<chr [1]>"},{"1":"classif.specificity","2":"Specificity","3":"classif","4":"<chr [2]>","5":"response","6":"<chr [1]>"},{"1":"classif.tn","2":"True Negatives","3":"classif","4":"<chr [2]>","5":"response","6":"<chr [1]>"},{"1":"classif.tnr","2":"True Negative Rate","3":"classif","4":"<chr [2]>","5":"response","6":"<chr [1]>"},{"1":"classif.tp","2":"True Positives","3":"classif","4":"<chr [2]>","5":"response","6":"<chr [1]>"},{"1":"classif.tpr","2":"True Positive Rate","3":"classif","4":"<chr [2]>","5":"response","6":"<chr [1]>"},{"1":"clust.ch","2":"Calinski Harabasz","3":"clust","4":"<chr [3]>","5":"partition","6":"<chr [0]>"},{"1":"clust.dunn","2":"Dunn","3":"clust","4":"<chr [3]>","5":"partition","6":"<chr [0]>"},{"1":"clust.silhouette","2":"Silhouette","3":"clust","4":"<chr [3]>","5":"partition","6":"<chr [0]>"},{"1":"clust.wss","2":"Within Sum of Squares","3":"clust","4":"<chr [3]>","5":"partition","6":"<chr [0]>"},{"1":"debug_classif","2":"Debug Classification Measure","3":"NA","4":"<chr [1]>","5":"response","6":"<chr [0]>"},{"1":"oob_error","2":"Out-of-bag Error","3":"NA","4":"<chr [1]>","5":"NA","6":"<chr [0]>"},{"1":"regr.bias","2":"Bias","3":"regr","4":"<chr [2]>","5":"response","6":"<chr [0]>"},{"1":"regr.ktau","2":"Kendall's tau","3":"regr","4":"<chr [2]>","5":"response","6":"<chr [0]>"},{"1":"regr.mae","2":"Mean Absolute Error","3":"regr","4":"<chr [2]>","5":"response","6":"<chr [0]>"},{"1":"regr.mape","2":"Mean Absolute Percent Error","3":"regr","4":"<chr [2]>","5":"response","6":"<chr [0]>"},{"1":"regr.maxae","2":"Max Absolute Error","3":"regr","4":"<chr [2]>","5":"response","6":"<chr [0]>"},{"1":"regr.medae","2":"Median Absolute Error","3":"regr","4":"<chr [2]>","5":"response","6":"<chr [0]>"},{"1":"regr.medse","2":"Median Squared Error","3":"regr","4":"<chr [2]>","5":"response","6":"<chr [0]>"},{"1":"regr.mse","2":"Mean Squared Error","3":"regr","4":"<chr [2]>","5":"response","6":"<chr [0]>"},{"1":"regr.msle","2":"Mean Squared Log Error","3":"regr","4":"<chr [2]>","5":"response","6":"<chr [0]>"},{"1":"regr.pbias","2":"Percent Bias","3":"regr","4":"<chr [2]>","5":"response","6":"<chr [0]>"},{"1":"regr.rae","2":"Relative Absolute Error","3":"regr","4":"<chr [2]>","5":"response","6":"<chr [0]>"},{"1":"regr.rmse","2":"Root Mean Squared Error","3":"regr","4":"<chr [2]>","5":"response","6":"<chr [0]>"},{"1":"regr.rmsle","2":"Root Mean Squared Log Error","3":"regr","4":"<chr [2]>","5":"response","6":"<chr [0]>"},{"1":"regr.rrse","2":"Root Relative Squared Error","3":"regr","4":"<chr [2]>","5":"response","6":"<chr [0]>"},{"1":"regr.rse","2":"Relative Squared Error","3":"regr","4":"<chr [2]>","5":"response","6":"<chr [0]>"},{"1":"regr.rsq","2":"R Squared","3":"regr","4":"<chr [2]>","5":"response","6":"<chr [0]>"},{"1":"regr.sae","2":"Sum of Absolute Errors","3":"regr","4":"<chr [2]>","5":"response","6":"<chr [0]>"},{"1":"regr.smape","2":"Symmetric Mean Absolute Percent Error","3":"regr","4":"<chr [2]>","5":"response","6":"<chr [0]>"},{"1":"regr.srho","2":"Spearman's rho","3":"regr","4":"<chr [2]>","5":"response","6":"<chr [0]>"},{"1":"regr.sse","2":"Sum of Squared Errors","3":"regr","4":"<chr [2]>","5":"response","6":"<chr [0]>"},{"1":"selected_features","2":"Absolute or Relative Frequency of Selected Features","3":"NA","4":"<chr [1]>","5":"NA","6":"<chr [0]>"},{"1":"sim.jaccard","2":"Jaccard Similarity Index","3":"NA","4":"<chr [2]>","5":"NA","6":"<chr [0]>"},{"1":"sim.phi","2":"Phi Coefficient Similarity","3":"NA","4":"<chr [2]>","5":"NA","6":"<chr [0]>"},{"1":"time_both","2":"Elapsed Time","3":"NA","4":"<chr [1]>","5":"NA","6":"<chr [0]>"},{"1":"time_predict","2":"Elapsed Time","3":"NA","4":"<chr [1]>","5":"NA","6":"<chr [0]>"},{"1":"time_train","2":"Elapsed Time","3":"NA","4":"<chr [1]>","5":"NA","6":"<chr [0]>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><code>mlr3</code>에서 시행되는 모든 측정값은 다음의 세 가지 요소에 의해 정의되어있습니다. 예를 들어 mean absolute error(MAE)를 사용한다고 가정해보죠.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>measure <span class="ot">=</span> <span class="fu">msr</span>(<span class="st">"regr.mae"</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>measure</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;MeasureRegrSimple:regr.mae&gt;: Mean Absolute Error
* Packages: mlr3, mlr3measures
* Range: [0, Inf]
* Minimize: TRUE
* Average: macro
* Parameters: list()
* Properties: -
* Predict type: response</code></pre>
</div>
</div>
</section>
<section id="예측값-점수-매기기" class="level4">
<h4 class="anchored" data-anchor-id="예측값-점수-매기기">예측값 점수 매기기</h4>
<p>모델의 성능을 계산하기 위해서는 prediction 객체의 <code>$score()</code> 메소드를 이용합니다. 이 때 <code>$score()</code> 메소드에는 평가하고자 하는 측정기준을 넣어줍니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span><span class="fu">score</span>(measure)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>regr.mae 
 2.42987 </code></pre>
</div>
</div>
<p>앞서 살펴보았던 <code>msr()</code> 함수는 하나의 성능 지표만 불러오는 함수였습니다. 여러 개의 성능을 동시에 확인하기 위해서는 <code>msrs()</code>를 이용하면 됩니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>measures <span class="ot">=</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">"regr.mse"</span>,<span class="st">"regr.mae"</span>))</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span><span class="fu">score</span>(measures)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>regr.mse regr.mae 
9.565807 2.429870 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
기타 측정값들
</div>
</div>
<div class="callout-body-container callout-body">
<p>mlr3에서는 모델의 예측 성능 뿐만 아니라, 모델에 대한 메타정보 또한 측정할 수 있습니다. 예를 들어</p>
<ul>
<li><code>msr("time_train")</code> : 모델을 학습시키는 데 걸린 시간</li>
<li><code>msr("time_predict")</code>: 모델로 예측하는 데 걸린 시간</li>
<li><code>msr("time_both")</code> : 훈련 및 예측하는 데 걸린 시간</li>
<li><code>msr("selected_features")</code>: 선택된 피처의 수 (모델에 <code>selected_features</code> 속성 있어야 사용 가능)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>measures <span class="ot">=</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">"time_train"</span>, <span class="st">"time_predict"</span>, <span class="st">"time_both"</span>))</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span><span class="fu">score</span>(measures, <span class="at">learner =</span> lrn_rpart)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  time_train time_predict    time_both 
       0.002        0.001        0.003 </code></pre>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="분류classification" class="level2">
<h2 class="anchored" data-anchor-id="분류classification">분류(Classification)</h2>
<p>분류 알고리즘은 연속적인 숫자를 예측하는 것이 아닌, 이산형(discrete), 범주형(categorical)한 값을 예측할 때 사용됩니다. 예를 들어 펭귄의 신체적인 특징을 바탕으로 어떤 종인지 분류하고자 할 때 분류 알고리즘을 사용할 수 있습니다.</p>
<p>분류 역시 앞서 다루었던 회귀와 동일한 흐름으로 태스크, 러너를 활용한 예측, 성능 측정을 하게 됩니다. <code>mlr3</code>의 분류에 사용되는 코드의 특징들을 살펴보겠습니다.</p>
<section id="분류-모델-만들기" class="level3">
<h3 class="anchored" data-anchor-id="분류-모델-만들기">분류 모델 만들기</h3>
<p>위에서 언급한 것처럼, 분류와 회귀 모델을 만들 때에는 태스크, 러너, 측정이 모두 동일합니다. 다만 분류이기 때문에 <code>TaskClassif</code>, <code>LearnerClassif</code>, <code>MeasureClassif</code> 등의 객체가 각각 사용됩니다.</p>
<p>간단하게 펭귄을 분류하는 모델을 하나 만들어보겠습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2023</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>tsk_penguins <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"penguins"</span>)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>splits <span class="ot">=</span> <span class="fu">partition</span>(tsk_penguins, <span class="at">ratio=</span>.<span class="dv">7</span>)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="co"># modeling</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>lrn_featureless <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.featureless"</span>)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>lrn_rpart <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>, <span class="at">cp=</span>.<span class="dv">2</span>, <span class="at">maxdepth=</span><span class="dv">5</span>)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>measure <span class="ot">=</span> <span class="fu">msr</span>(<span class="st">"classif.acc"</span>)</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="co"># train learners</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>lrn_featureless<span class="sc">$</span><span class="fu">train</span>(tsk_penguins, splits<span class="sc">$</span>train)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span><span class="fu">train</span>(tsk_penguins, splits<span class="sc">$</span>train)</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="co"># evaluation</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>lrn_featureless<span class="sc">$</span><span class="fu">predict</span>(tsk_penguins, splits<span class="sc">$</span>test)<span class="sc">$</span><span class="fu">score</span>(measure)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>classif.acc 
  0.4466019 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span><span class="fu">predict</span>(tsk_penguins, splits<span class="sc">$</span>test)<span class="sc">$</span><span class="fu">score</span>(measure)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>classif.acc 
  0.9417476 </code></pre>
</div>
</div>
<p>위의 사례에서 <code>palmerpenguins</code> 패키지에 있는 <code>penguins</code> 데이터셋을 활용하여 분류모델을 만들었습니다. 그 다음 featureless 모델(가장 기본적인 값으로)과 의사결정나무 모형으로 학습시킨 뒤, 예측 성능을 정확도(accuracy)로 측정하였습니다. 그 결과 기본 모형에 비해 의사결정 나무의 정확도가 훨씬 높게 나타났습니다.</p>
</section>
<section id="taskclassif" class="level3">
<h3 class="anchored" data-anchor-id="taskclassif">TaskClassif</h3>
<p>분류 태스크는 회귀 태스크와 거의 유사합니다. 다만 타겟 변수가 범주형으로 되어있다는 것이 둘의 가장 큰 차이점입니다.</p>
<p><code>mlr3</code>에 포함되어있는 분류 태스크들을 보면 다음과 같습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.table</span>(mlr_tasks)[task_type<span class="sc">==</span><span class="st">"classif"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["key"],"name":[1],"type":["chr"],"align":["left"]},{"label":["label"],"name":[2],"type":["chr"],"align":["left"]},{"label":["task_type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["nrow"],"name":[4],"type":["int"],"align":["right"]},{"label":["ncol"],"name":[5],"type":["int"],"align":["right"]},{"label":["properties"],"name":[6],"type":["list"],"align":["right"]},{"label":["lgl"],"name":[7],"type":["int"],"align":["right"]},{"label":["int"],"name":[8],"type":["int"],"align":["right"]},{"label":["dbl"],"name":[9],"type":["int"],"align":["right"]},{"label":["chr"],"name":[10],"type":["int"],"align":["right"]},{"label":["fct"],"name":[11],"type":["int"],"align":["right"]},{"label":["ord"],"name":[12],"type":["int"],"align":["right"]},{"label":["pxc"],"name":[13],"type":["int"],"align":["right"]}],"data":[{"1":"breast_cancer","2":"Wisconsin Breast Cancer","3":"classif","4":"683","5":"10","6":"<chr [1]>","7":"0","8":"0","9":"0","10":"0","11":"0","12":"9","13":"0"},{"1":"german_credit","2":"German Credit","3":"classif","4":"1000","5":"21","6":"<chr [1]>","7":"0","8":"3","9":"0","10":"0","11":"14","12":"3","13":"0"},{"1":"ilpd","2":"Indian Liver Patient Data","3":"classif","4":"583","5":"11","6":"<chr [1]>","7":"0","8":"4","9":"5","10":"0","11":"1","12":"0","13":"0"},{"1":"iris","2":"Iris Flowers","3":"classif","4":"150","5":"5","6":"<chr [1]>","7":"0","8":"0","9":"4","10":"0","11":"0","12":"0","13":"0"},{"1":"optdigits","2":"Optical Recognition of Handwritten Digits","3":"classif","4":"5620","5":"65","6":"<chr [1]>","7":"0","8":"64","9":"0","10":"0","11":"0","12":"0","13":"0"},{"1":"penguins","2":"Palmer Penguins","3":"classif","4":"344","5":"8","6":"<chr [1]>","7":"0","8":"3","9":"2","10":"0","11":"2","12":"0","13":"0"},{"1":"penguins_simple","2":"Simplified Palmer Penguins","3":"classif","4":"333","5":"11","6":"<chr [1]>","7":"0","8":"3","9":"7","10":"0","11":"0","12":"0","13":"0"},{"1":"pima","2":"Pima Indian Diabetes","3":"classif","4":"768","5":"9","6":"<chr [1]>","7":"0","8":"0","9":"8","10":"0","11":"0","12":"0","13":"0"},{"1":"sonar","2":"Sonar: Mines vs. Rocks","3":"classif","4":"208","5":"61","6":"<chr [1]>","7":"0","8":"0","9":"60","10":"0","11":"0","12":"0","13":"0"},{"1":"spam","2":"HP Spam Detection","3":"classif","4":"4601","5":"58","6":"<chr [1]>","7":"0","8":"0","9":"57","10":"0","11":"0","12":"0","13":"0"},{"1":"titanic","2":"Titanic","3":"classif","4":"1309","5":"11","6":"<chr [1]>","7":"0","8":"2","9":"2","10":"3","11":"2","12":"1","13":"0"},{"1":"wine","2":"Wine Regions","3":"classif","4":"178","5":"14","6":"<chr [1]>","7":"0","8":"2","9":"11","10":"0","11":"0","12":"0","13":"0"},{"1":"zoo","2":"Zoo Animals","3":"classif","4":"101","5":"17","6":"<chr [1]>","7":"15","8":"1","9":"0","10":"0","11":"0","12":"0","13":"0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>물론 <code>as_task_classif()</code>를 통해 외부 데이터셋으로 자신만의 분류 태스크를 만들 수도 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_task_classif</span>(palmerpenguins<span class="sc">::</span>penguins, <span class="at">target=</span><span class="st">"species"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;TaskClassif:palmerpenguins::penguins&gt; (344 x 8)
* Target: species
* Properties: multiclass
* Features (7):
  - int (3): body_mass_g, flipper_length_mm, year
  - dbl (2): bill_depth_mm, bill_length_mm
  - fct (2): island, sex</code></pre>
</div>
</div>
<p><code>mlr3</code>에는 두 가지의 분류 태스크가 있습니다. 하나는 binary 분류로, 타겟 변수가 두 가지의 범주를 갖게 됩니다. 다른 하나는 타겟 변수가 세 개 이상의 범주를 갖는 multiclass 분류입니다.</p>
<p>예를 들어 <code>sonar</code> 태스크는 타겟이 두 가지의 범주를 갖기 때문에 binary 분류입니다. 태스크의 속성(Properties)이 twoclass인 것을 확인할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>tsk_sonar <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"sonar"</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>tsk_sonar</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;TaskClassif:sonar&gt; (208 x 61): Sonar: Mines vs. Rocks
* Target: Class
* Properties: twoclass
* Features (60):
  - dbl (60): V1, V10, V11, V12, V13, V14, V15, V16, V17, V18, V19, V2,
    V20, V21, V22, V23, V24, V25, V26, V27, V28, V29, V3, V30, V31,
    V32, V33, V34, V35, V36, V37, V38, V39, V4, V40, V41, V42, V43,
    V44, V45, V46, V47, V48, V49, V5, V50, V51, V52, V53, V54, V55,
    V56, V57, V58, V59, V6, V60, V7, V8, V9</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>tsk_sonar<span class="sc">$</span>class_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "M" "R"</code></pre>
</div>
</div>
<p>반면에 <code>tsk(penguins)</code>는 타겟의 범주가 세 개인 multiclass 분류 태스크입니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>tsk_penguins</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;TaskClassif:penguins&gt; (344 x 8): Palmer Penguins
* Target: species
* Properties: multiclass
* Features (7):
  - int (3): body_mass, flipper_length, year
  - dbl (2): bill_depth, bill_length
  - fct (2): island, sex</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>tsk_penguins<span class="sc">$</span>class_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Adelie"    "Chinstrap" "Gentoo"   </code></pre>
</div>
</div>
<p>binary 태스크와 multiclass 태스크의 유일한 차이점은 <strong><code>$positive</code> 필드의 존재 여부</strong>입니다. binary 태스크의 경우 예측 가능한 값이 두 가지밖에 없습니다. 따라서 어떤 값을 positive 또는 양성으로 예측할지를 지정해주어야 합니다. 나머지는 자동으로 negative 또는 음성으로 분류하게 됩니다. 만약 positive 클래스가 지정되지 않는다면, mlr3에서는 타겟 변수의 첫 번째 레벨(범주)를 positive로 간주하고 분류를 진행합니다. 이는 잘못된 예측을 하게 만드는 것이므로, 반드시 <strong><code>$positive</code>를 지정</strong>해주어야 합니다.</p>
</section>
<section id="learnerclassif-와-measureclassif" class="level3">
<h3 class="anchored" data-anchor-id="learnerclassif-와-measureclassif">LearnerClassif 와 MeasureClassif</h3>
<p>LeanerClassif에 내장된 분류 러너들은 회귀 러너들과 동일한 형태를 갖고 있습니다. 가장 큰 차이점은 분류 러너의 경우 예측 형태가 예측값의 클래스를 예측하는 <code>response</code> 이외에 예측값의 클래스에 속할 확률을 예측하는 <code>prob</code>도 존재한다는 것입니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>lrn_rpart <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span><span class="fu">train</span>(tsk_penguins, splits<span class="sc">$</span>train)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">=</span> lrn_rpart<span class="sc">$</span><span class="fu">predict</span>(tsk_penguins, splits<span class="sc">$</span>test)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>prediction</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;PredictionClassif&gt; for 103 observations:
    row_ids     truth  response prob.Adelie prob.Chinstrap prob.Gentoo
          1    Adelie    Adelie  0.98979592     0.01020408   0.0000000
          6    Adelie    Adelie  0.98979592     0.01020408   0.0000000
          7    Adelie    Adelie  0.98979592     0.01020408   0.0000000
---                                                                   
        334 Chinstrap Chinstrap  0.04347826     0.95652174   0.0000000
        339 Chinstrap Chinstrap  0.04347826     0.95652174   0.0000000
        343 Chinstrap    Gentoo  0.01111111     0.03333333   0.9555556</code></pre>
</div>
</div>
<p>위의 예에서 알 수 있듯이 <code>response</code>에서는 <code>prob</code>에서 확인할 수 있는 예측확률이 가장 높게 나온 범주를 기준으로 예측한 클래스의 값이 나오게 됩니다.</p>
<p>분류 측정값도 러너와 마찬가지로 회귀의 것과 생김새는 동일하지만, <code>predict_type</code>에 따라 다른 예측성능을 측정할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.table</span>(<span class="fu">msr</span>())[</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>    task_type <span class="sc">==</span> <span class="st">"classif"</span> <span class="sc">&amp;</span> predict_type <span class="sc">==</span> <span class="st">"prob"</span> <span class="sc">&amp;</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>    task_properties <span class="sc">!=</span> <span class="st">"twoclass"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["key"],"name":[1],"type":["chr"],"align":["left"]},{"label":["label"],"name":[2],"type":["chr"],"align":["left"]},{"label":["task_type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["packages"],"name":[4],"type":["list"],"align":["right"]},{"label":["predict_type"],"name":[5],"type":["chr"],"align":["left"]},{"label":["task_properties"],"name":[6],"type":["list"],"align":["right"]}],"data":[{"1":"classif.logloss","2":"Log Loss","3":"classif","4":"<chr [2]>","5":"prob","6":"<chr [0]>"},{"1":"classif.mauc_au1p","2":"Weighted average 1 vs. 1 multiclass AUC","3":"classif","4":"<chr [2]>","5":"prob","6":"<chr [0]>"},{"1":"classif.mauc_au1u","2":"Average 1 vs. 1 multiclass AUC","3":"classif","4":"<chr [2]>","5":"prob","6":"<chr [0]>"},{"1":"classif.mauc_aunp","2":"Weighted average 1 vs. rest multiclass AUC","3":"classif","4":"<chr [2]>","5":"prob","6":"<chr [0]>"},{"1":"classif.mauc_aunu","2":"Average 1 vs. rest multiclass AUC","3":"classif","4":"<chr [2]>","5":"prob","6":"<chr [0]>"},{"1":"classif.mbrier","2":"Multiclass Brier Score","3":"classif","4":"<chr [2]>","5":"prob","6":"<chr [0]>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>펭귄의 종을 예측하는 multiclass 분류 모델의 성능을 예측해보면 다음과 같습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>measures <span class="ot">=</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">"classif.mbrier"</span>, <span class="st">"classif.logloss"</span>, <span class="st">"classif.acc"</span>))</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span><span class="fu">score</span>(measures)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> classif.mbrier classif.logloss     classif.acc 
     0.05733419      0.14250164      0.97087379 </code></pre>
</div>
</div>
</section>
<section id="predictionclassif-confusion-matrix-thresholding" class="level3">
<h3 class="anchored" data-anchor-id="predictionclassif-confusion-matrix-thresholding">PredictionClassif, Confusion Matrix, Thresholding</h3>
<p>PredictionClassif 객체는 회귀의 예측에는 없는 두 개의 중요한 요소가 있습니다. 첫 번째는 <code>$confusion</code> 필드이고, 두 번째는 <code>$set_threshold()</code> 메소드입니다.</p>
<section id="confusion-matrix" class="level4">
<h4 class="anchored" data-anchor-id="confusion-matrix">Confusion matrix</h4>
<p>혼동 행렬은 모델이 예측한 값이 잘 분류되었는지 실제 데이터와 비교하여 만들어지는 빈도 표입니다. <code>mlr3</code>에서는 <code>$confusion</code> 필드를 활용해 혼동행렬을 생성할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span>confusion</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           truth
response    Adelie Chinstrap Gentoo
  Adelie        45         0      0
  Chinstrap      0        18      0
  Gentoo         1         2     37</code></pre>
</div>
</div>
<p>가로 방향으로 읽는 <code>truth</code>는 실제 데이터의 값을, <code>response</code>는 분류 모델이 예측한 값을 의미합니다. 대각선의 값들 (45, 18, 37)은 올바르게 예측한 값의 수이고, 나머지 값들은 잘못 예측(분류)한 값을 의미합니다.</p>
<p>또한 <code>autoplot()</code>을 이용해 혼동행렬을 시각화할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(prediction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>binary 분류는 혼동행렬에서 좌측 상단(31)은 True positive, 우측 하단(25)는 True negative입니다. 우측 상단(7)과 좌측 하단(6)은 각각 False positive와 False negative입니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2023</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>splits <span class="ot">=</span> <span class="fu">partition</span>(tsk_sonar)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">train</span>(tsk_sonar, splits<span class="sc">$</span>train)<span class="sc">$</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(tsk_sonar, splits<span class="sc">$</span>test)<span class="sc">$</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>  confusion</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        truth
response  M  R
       M 31  7
       R  6 25</code></pre>
</div>
</div>
<p>혼동행렬에서 계산되는 다양한 binary 분류의 성능들은 <code>mlr3</code> 리샘플링에서 다루도록 하겠습니다.</p>
</section>
<section id="thresholding" class="level4">
<h4 class="anchored" data-anchor-id="thresholding">Thresholding</h4>
<p>binary 분류 모델의 중요한 요소는 바로 positive와 negative를 분류하는 기준인 threshold 를 설정하는 것입니다. multiclass 분류에서 response 값은 여러 개의 범주 중 가장 높은 확률로 예측된 범주였지만, binary 분류에서는 positive로 예측할 확률이 50% 이상이어야 positive로 분류될 수 있습니다.</p>
<p>이처럼 threshold는 일반적으로 50%로 알려져 있습니다. 하지만 이 threshold는 예측하고자 하는 범주(클래스)의 불균형이 있는 경우 변경하여 사용할 수 있습니다.</p>
<p>예를 들어 <code>german_credit</code> 태스크를 살펴보겠습니다. 1000명의 데이터 중에서 700명은 신용이 좋은 경우이고, 나머지 300명은 신용이 나쁜 경우입니다. 이 데이터를 활용해, 모든 사람이 좋은 신용을 가질 것이라고 예측함으로써 70%의 정확도를 보이는 예측 모델을 만들 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>task_credit <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"german_credit"</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>lrn_featureless <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.featureless"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>split <span class="ot">=</span> <span class="fu">partition</span>(task_credit)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>lrn_featureless<span class="sc">$</span><span class="fu">train</span>(task_credit, split<span class="sc">$</span>train)</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">=</span> lrn_featureless<span class="sc">$</span><span class="fu">predict</span>(task_credit, split<span class="sc">$</span>test)</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span><span class="fu">score</span>(<span class="fu">msr</span>(<span class="st">"classif.acc"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>classif.acc 
        0.7 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(prediction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>언뜻 보기에는 모델의 성능이 좋아보이지만, 사실 이 경우는 신용이 나쁜 사람들을 모두 무시해버린 경우입니다. 이는 헬스케어 등과 같은 분야에서 큰 문제를 야기할 수 있습니다.</p>
<p>Thresholding은 클래스들이 다른 확률로 설정되어 예측될 수 있게끔 해줍니다. 따라서 50%를 기준으로 신용의 좋고 나쁨을 예측하는 것이 아니라, 데이터에 맞게 70% 미만을 기준으로 분류를 할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span><span class="fu">set_threshold</span>(<span class="fl">0.7</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span><span class="fu">score</span>(<span class="fu">msr</span>(<span class="st">"classif.acc"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>classif.acc 
  0.5242424 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(prediction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>threshold를 설정하지 않았을 때보다 성능(정확도)은 나빠졌지만, 클래스 간의 관계(신용의 좋고 나쁨 간 비율)를 더욱 정확히 반영하고 있기 때문에 더 좋은 모델이라고 할 수 있습니다.</p>
</section>
</section>
<section id="지원되는-러너-알고리즘" class="level3">
<h3 class="anchored" data-anchor-id="지원되는-러너-알고리즘">지원되는 러너 알고리즘</h3>
<p><code>mlr3</code>에서는 다양한 알고리즘들을 사용할 수 있습니다. <code>mlr3</code>에서 사용할 수 있는 러너들은 기본적으로 <code>mlr3</code> 이외에도 <code>mlr3learners</code>, <code>mlr3extralearners</code> 패키지를 통해 확인 가능합니다.</p>
<p>이러한 러너들은 <code>mlr_learners</code> 딕셔너리를 통해 확인 가능합니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>learners_dt <span class="ot">=</span> <span class="fu">as.data.table</span>(mlr_learners)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>learners_dt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["key"],"name":[1],"type":["chr"],"align":["left"]},{"label":["label"],"name":[2],"type":["chr"],"align":["left"]},{"label":["task_type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["feature_types"],"name":[4],"type":["list"],"align":["right"]},{"label":["packages"],"name":[5],"type":["list"],"align":["right"]},{"label":["properties"],"name":[6],"type":["list"],"align":["right"]},{"label":["predict_types"],"name":[7],"type":["list"],"align":["right"]}],"data":[{"1":"classif.cv_glmnet","2":"NA","3":"classif","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [4]>","7":"<chr [2]>"},{"1":"classif.debug","2":"Debug Learner for Classification","3":"classif","4":"<chr [6]>","5":"<chr [1]>","6":"<chr [4]>","7":"<chr [2]>"},{"1":"classif.featureless","2":"Featureless Classification Learner","3":"classif","4":"<chr [7]>","5":"<chr [1]>","6":"<chr [6]>","7":"<chr [2]>"},{"1":"classif.glmnet","2":"NA","3":"classif","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [3]>","7":"<chr [2]>"},{"1":"classif.kknn","2":"NA","3":"classif","4":"<chr [5]>","5":"<chr [3]>","6":"<chr [2]>","7":"<chr [2]>"},{"1":"classif.lda","2":"NA","3":"classif","4":"<chr [5]>","5":"<chr [3]>","6":"<chr [3]>","7":"<chr [2]>"},{"1":"classif.log_reg","2":"NA","3":"classif","4":"<chr [6]>","5":"<chr [3]>","6":"<chr [2]>","7":"<chr [2]>"},{"1":"classif.multinom","2":"NA","3":"classif","4":"<chr [4]>","5":"<chr [3]>","6":"<chr [4]>","7":"<chr [2]>"},{"1":"classif.naive_bayes","2":"NA","3":"classif","4":"<chr [4]>","5":"<chr [3]>","6":"<chr [2]>","7":"<chr [2]>"},{"1":"classif.nnet","2":"NA","3":"classif","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [3]>","7":"<chr [2]>"},{"1":"classif.qda","2":"NA","3":"classif","4":"<chr [5]>","5":"<chr [3]>","6":"<chr [3]>","7":"<chr [2]>"},{"1":"classif.ranger","2":"NA","3":"classif","4":"<chr [6]>","5":"<chr [3]>","6":"<chr [6]>","7":"<chr [2]>"},{"1":"classif.rpart","2":"Classification Tree","3":"classif","4":"<chr [5]>","5":"<chr [2]>","6":"<chr [6]>","7":"<chr [2]>"},{"1":"classif.svm","2":"NA","3":"classif","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [2]>","7":"<chr [2]>"},{"1":"classif.xgboost","2":"NA","3":"classif","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [6]>","7":"<chr [2]>"},{"1":"clust.MBatchKMeans","2":"Mini Batch K-Means","3":"clust","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [4]>","7":"<chr [2]>"},{"1":"clust.SimpleKMeans","2":"K-Means (Weka)","3":"clust","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [3]>","7":"<chr [1]>"},{"1":"clust.agnes","2":"Agglomerative Hierarchical Clustering","3":"clust","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [3]>","7":"<chr [1]>"},{"1":"clust.ap","2":"Affinity Propagation Clustering","3":"clust","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [3]>","7":"<chr [1]>"},{"1":"clust.cmeans","2":"Fuzzy C-Means Clustering Learner","3":"clust","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [3]>","7":"<chr [2]>"},{"1":"clust.cobweb","2":"Cobweb Clustering","3":"clust","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [3]>","7":"<chr [1]>"},{"1":"clust.dbscan","2":"Density-Based Clustering","3":"clust","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [3]>","7":"<chr [1]>"},{"1":"clust.diana","2":"Divisive Hierarchical Clustering","3":"clust","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [3]>","7":"<chr [1]>"},{"1":"clust.em","2":"Expectation-Maximization Clustering","3":"clust","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [3]>","7":"<chr [1]>"},{"1":"clust.fanny","2":"Fuzzy Analysis Clustering","3":"clust","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [3]>","7":"<chr [2]>"},{"1":"clust.featureless","2":"Featureless Clustering","3":"clust","4":"<chr [3]>","5":"<chr [2]>","6":"<chr [4]>","7":"<chr [2]>"},{"1":"clust.ff","2":"Farthest First Clustering","3":"clust","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [3]>","7":"<chr [1]>"},{"1":"clust.hclust","2":"Agglomerative Hierarchical Clustering","3":"clust","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [3]>","7":"<chr [1]>"},{"1":"clust.kkmeans","2":"Kernel K-Means","3":"clust","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [3]>","7":"<chr [1]>"},{"1":"clust.kmeans","2":"K-Means","3":"clust","4":"<chr [3]>","5":"<chr [4]>","6":"<chr [3]>","7":"<chr [1]>"},{"1":"clust.mclust","2":"Gaussian Mixture Models Clustering","3":"clust","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [3]>","7":"<chr [2]>"},{"1":"clust.meanshift","2":"Mean Shift Clustering","3":"clust","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [3]>","7":"<chr [1]>"},{"1":"clust.pam","2":"Partitioning Around Medoids","3":"clust","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [3]>","7":"<chr [1]>"},{"1":"clust.xmeans","2":"X-means","3":"clust","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [3]>","7":"<chr [1]>"},{"1":"regr.cv_glmnet","2":"NA","3":"regr","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [2]>","7":"<chr [1]>"},{"1":"regr.debug","2":"Debug Learner for Regression","3":"regr","4":"<chr [6]>","5":"<chr [1]>","6":"<chr [1]>","7":"<chr [2]>"},{"1":"regr.featureless","2":"Featureless Regression Learner","3":"regr","4":"<chr [7]>","5":"<chr [2]>","6":"<chr [4]>","7":"<chr [2]>"},{"1":"regr.glmnet","2":"NA","3":"regr","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [1]>","7":"<chr [1]>"},{"1":"regr.kknn","2":"NA","3":"regr","4":"<chr [5]>","5":"<chr [3]>","6":"<chr [0]>","7":"<chr [1]>"},{"1":"regr.km","2":"NA","3":"regr","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [0]>","7":"<chr [2]>"},{"1":"regr.lm","2":"NA","3":"regr","4":"<chr [5]>","5":"<chr [3]>","6":"<chr [2]>","7":"<chr [2]>"},{"1":"regr.nnet","2":"NA","3":"regr","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [1]>","7":"<chr [1]>"},{"1":"regr.ranger","2":"NA","3":"regr","4":"<chr [6]>","5":"<chr [3]>","6":"<chr [4]>","7":"<chr [2]>"},{"1":"regr.rpart","2":"Regression Tree","3":"regr","4":"<chr [5]>","5":"<chr [2]>","6":"<chr [4]>","7":"<chr [1]>"},{"1":"regr.svm","2":"NA","3":"regr","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [0]>","7":"<chr [1]>"},{"1":"regr.xgboost","2":"NA","3":"regr","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [4]>","7":"<chr [1]>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>또한 해당 러너의 딕셔너리에서 특정 조건을 만족하는 값들만 선택하여 확인할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>learners_dt[task_type <span class="sc">==</span> <span class="st">"regr"</span> <span class="sc">&amp;</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(predict_types, <span class="cf">function</span>(x) <span class="st">"se"</span> <span class="sc">%in%</span> x)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["key"],"name":[1],"type":["chr"],"align":["left"]},{"label":["label"],"name":[2],"type":["chr"],"align":["left"]},{"label":["task_type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["feature_types"],"name":[4],"type":["list"],"align":["right"]},{"label":["packages"],"name":[5],"type":["list"],"align":["right"]},{"label":["properties"],"name":[6],"type":["list"],"align":["right"]},{"label":["predict_types"],"name":[7],"type":["list"],"align":["right"]}],"data":[{"1":"regr.debug","2":"Debug Learner for Regression","3":"regr","4":"<chr [6]>","5":"<chr [1]>","6":"<chr [1]>","7":"<chr [2]>"},{"1":"regr.featureless","2":"Featureless Regression Learner","3":"regr","4":"<chr [7]>","5":"<chr [2]>","6":"<chr [4]>","7":"<chr [2]>"},{"1":"regr.km","2":"NA","3":"regr","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [0]>","7":"<chr [2]>"},{"1":"regr.lm","2":"NA","3":"regr","4":"<chr [5]>","5":"<chr [3]>","6":"<chr [2]>","7":"<chr [2]>"},{"1":"regr.ranger","2":"NA","3":"regr","4":"<chr [6]>","5":"<chr [3]>","6":"<chr [4]>","7":"<chr [2]>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
</section>
<section id="결론" class="level2">
<h2 class="anchored" data-anchor-id="결론">결론</h2>
<p>이번 챕터에서는 <code>mlr3</code>를 활용해 머신러닝 알고리즘을 다루는 방법에 대해 살펴보았습니다. 태스크를 이용해 학습시키고자 하는 데이터를 만들고, 러너를 이용해 모델을 학습시킨 후, 예측하였습니다. 또한 <code>Measure</code> 클래스를 이용해 모델이 예측한 값을 바탕으로 모델의 성능을 계산할 수 있었습니다.</p>
<p>이번 챕터에서 가장 중요한 내용들을 표로 요약하면 아래와 같습니다.</p>
<table class="table">
<thead>
<tr class="header">
<th>Class</th>
<th>Constructor/function</th>
<th>Fields/Methods</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>Task</code></td>
<td><code>tsk()</code>/<code>as_task_X()</code></td>
<td><code>$filter()</code>; <code>$data()</code></td>
</tr>
<tr class="even">
<td><code>Learner</code></td>
<td><code>lrn()</code>/<code>lrns()</code></td>
<td><code>$train()</code>; <code>$predict()</code></td>
</tr>
<tr class="odd">
<td><code>Prediction</code></td>
<td><code>learner$predict()</code></td>
<td><code>$score()</code>;</td>
</tr>
<tr class="even">
<td><code>Measure</code></td>
<td><code>msr()</code>/<code>msrs()</code></td>
<td></td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="레퍼런스" class="level2">
<h2 class="anchored" data-anchor-id="레퍼런스">레퍼런스</h2>
<ul>
<li><p><a href="https://mlr3.mlr-org.com/" class="uri">https://mlr3.mlr-org.com/</a></p></li>
<li><p><a href="https://mlr3book.mlr-org.com/chapters/chapter2/data_and_basic_modeling.html#sec-basics-regr-experiment" class="uri">https://mlr3book.mlr-org.com/chapters/chapter2/data_and_basic_modeling.html#sec-basics-regr-experiment</a></p></li>
</ul>


</section>
</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>https://mlr3book.mlr-org.com/<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>https://mlr3.mlr-org.com/<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/rchemistblog\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="rchemist0123/giscus-blog" data-repo-id="R_kgDOJBwa8Q" data-category="General" data-category-id="DIC_kwDOJBwa8c4CUbVM" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><a href="https://https://rchemistblog.com/">Rchemist</a> © 2023 by <a href="https://https://rchemist.quarto.pub/rchemistblog/about.html">YH Jang</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:danjang0123@gmail.com">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/danjang0123/">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>