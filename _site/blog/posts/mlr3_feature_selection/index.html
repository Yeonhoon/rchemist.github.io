<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="JYH">
<meta name="dcterms.date" content="2023-04-28">
<meta name="description" content="머신러닝에서 최적의 피처 선택하기">

<title>Rchemist - mlr3 피처 선택</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

<link href="../../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../../site_libs/pagedtable-1.1/js/pagedtable.js"></script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Rchemist</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html" rel="" target=""><i class="bi bi-house" role="img">
</i> 
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html" rel="" target=""><i class="bi bi-file-person" role="img">
</i> 
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../gallery/index.html" rel="" target=""><i class="bi bi-sliders2" role="img">
</i> 
 <span class="menu-text">Gallery</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">mlr3 피처 선택</h1>
                  <div>
        <div class="description">
          머신러닝에서 최적의 피처 선택하기
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">mlr3</div>
                <div class="quarto-category">machine learning</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>JYH </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 28, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#인트로" id="toc-인트로" class="nav-link active" data-scroll-target="#인트로">인트로</a></li>
  <li><a href="#필터-방식" id="toc-필터-방식" class="nav-link" data-scroll-target="#필터-방식">필터 방식</a>
  <ul class="collapse">
  <li><a href="#filter-value-계산" id="toc-filter-value-계산" class="nav-link" data-scroll-target="#filter-value-계산">Filter value 계산</a></li>
  <li><a href="#feature-importance-filters" id="toc-feature-importance-filters" class="nav-link" data-scroll-target="#feature-importance-filters">Feature importance filters</a></li>
  <li><a href="#embedded-methods" id="toc-embedded-methods" class="nav-link" data-scroll-target="#embedded-methods">Embedded methods</a></li>
  <li><a href="#filter-based-feature-selection" id="toc-filter-based-feature-selection" class="nav-link" data-scroll-target="#filter-based-feature-selection">Filter-based feature selection</a></li>
  </ul></li>
  <li><a href="#래퍼-방식" id="toc-래퍼-방식" class="nav-link" data-scroll-target="#래퍼-방식">래퍼 방식</a>
  <ul class="collapse">
  <li><a href="#간단한-예시" id="toc-간단한-예시" class="nav-link" data-scroll-target="#간단한-예시">간단한 예시</a></li>
  <li><a href="#fselectinstance-클래스" id="toc-fselectinstance-클래스" class="nav-link" data-scroll-target="#fselectinstance-클래스"><code>FSelectInstance</code> 클래스</a></li>
  <li><a href="#fselector-클래스" id="toc-fselector-클래스" class="nav-link" data-scroll-target="#fselector-클래스"><code>Fselector</code> 클래스</a></li>
  <li><a href="#피처-선택-수행" id="toc-피처-선택-수행" class="nav-link" data-scroll-target="#피처-선택-수행">피처 선택 수행</a></li>
  <li><a href="#피처-선택-자동화" id="toc-피처-선택-자동화" class="nav-link" data-scroll-target="#피처-선택-자동화">피처 선택 자동화</a></li>
  </ul></li>
  <li><a href="#요약" id="toc-요약" class="nav-link" data-scroll-target="#요약">요약</a></li>
  <li><a href="#참고자료" id="toc-참고자료" class="nav-link" data-scroll-target="#참고자료">참고자료</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>이 글은 <a href="https://mlr3book.mlr-org.com/">mlr3book</a><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>을 참고하여 작성되었습니다. 국내 R 사용자들에게 잘 알려지지 않은 <code>mlr3</code><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> 패키지를 통해, R에서도 손쉽게 머신러닝을 수행할 수 있다는 것을 보여드리고자 합니다.</p>
</div>
</div>
<section id="인트로" class="level2">
<h2 class="anchored" data-anchor-id="인트로">인트로</h2>
<p>피처 선택 (feature selection)은 크게 두 종류가 있습니다. 먼저 <code>Filter</code> 방식은 데이터 전처리 단계에서 사용됩니다. 반면 <code>Wrapper</code> 방식은 모델을 만들 때 피처의 일부분(subset)을 사용해 성능을 평가할 때 사용되는 방법입니다.</p>
<p>피처 선택은 변수 선택으로도 불리는데, 이 과정은 모델을 학습할 떄 사용될 피처의 일부분을 찾는 과정입니다. 모델 학습 시 최적의 피처들을 사용할 경우 아래와 같은 장점이 있습니다.</p>
<ol type="1">
<li>과적합(overfitting) 감소로 인한 성능 향상</li>
<li>불필요한 feature에 의존하지 않는 안정된(robust) 모델</li>
<li>모델이 간단해지면서 해석이 용이해짐 4 빠른 모델 학습과 예측</li>
<li>잠재적으로 값비싼 feature 수집 불필요</li>
</ol>
</section>
<section id="필터-방식" class="level2">
<h2 class="anchored" data-anchor-id="필터-방식">필터 방식</h2>
<p>필터 방법을 통한 피처 선택은 머신러닝 모델을 학습하기 이전에 수행할 수 있는 전처리(preprocessing) 단계입니다. 예를 들어서 예측하고자 하는 타겟 변수와의 상관계수가 0.2보다 큰 변수들만 선택하는 것입니다.</p>
<p>이러한 방법은 각각의 피처와 타겟 변수에 대한 관계만을 고려하기 때문에 단변량(univariate) 필터라고 합니다. 문제는 이러한 방법이 연속형 변수들로 회귀분석에만 적용할 수 있고, 상관계수가 0.2라는 기준도 임의적이죠.</p>
<p>그래서 피처의 중요성 (feature importance)을 기반으로 하는 다변량 필터 등이 등장을 하게 됩니다. 비록 단변량 필터들은 다변량 필터나 래퍼방식보다 간단하고 빠르게 계산할 수 있다는 장점이 있지만, 성능 측면에서는 같은 고급 필터 방법들이 더 뛰어나곤 합니다.</p>
<p>필터 알고리즘은 각 피처별로 상관계수나 순위와 같은 수치를 부여해 피처를 선택하게 됩니다. 수치가 낮은 리처들은 모델링 단계에서 제외되는 방식입니다.</p>
<p>mlr3에서는 <code>mlr3filters</code> 패키지를 통해 필터 방법을 수행할 수 있습니다. mlr3filters를 통해 수행할 수 있는 필터들은 다음과 같습니다.</p>
<ul>
<li><code>FilterCorrelation</code>: 숫자 피처 - 숫자 타겟 간 피어슨 또는 스피어만 상관계수 활용</li>
<li><code>FilterInformationGain</code>: 피처의 정보로 인해 감소되는 타겟의 불확실성 정도 활용</li>
<li><code>FilterJMIM</code>: Minimal joint mutual information maximization, 선택된 피처들 간에 겹치는 정보를 최소화</li>
<li><code>FilterPermutation</code>: 주어진 러너에서 각 피처별 순열 피처 중요도를 계산</li>
<li><code>FilterAUC</code>: 각 피쳐별로 ROC 곡선 아래의 공간 계산</li>
</ul>
<p>그 외에 수행 가능한 모든 필터 방법들은 <a href="https://mlr3filters.mlr-org.com">다음의 사이트</a>를 참고하시기 바랍니다.</p>
<section id="filter-value-계산" class="level3">
<h3 class="anchored" data-anchor-id="filter-value-계산">Filter value 계산</h3>
<p>우선 원하는 필터 방법을 수행하기 위해 R 객체 형태로 만들어주겠습니다. 다른 mlr3 인스턴스와 마찬가지로 딕셔너리(<code>mlr_filters</code>)나 sugar function인 <code>flt()</code>를 통해 선언할 수 있습니다. 각 필터 객체들은 필터 값과 순위를 계산해 내림차순(점수가 높은 순)으로 정렬하는 <code>$calculate()</code> 메소드를 가집니다. 예를 들어 information gain 필터를 사용해보겠습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3filters)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>filter <span class="ot">=</span> <span class="fu">flt</span>(<span class="st">"information_gain"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>task <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"penguins"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>filter<span class="sc">$</span><span class="fu">calculate</span>(task)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.table</span>(filter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["feature"],"name":[1],"type":["chr"],"align":["left"]},{"label":["score"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"flipper_length","2":"0.581167901"},{"1":"bill_length","2":"0.544896584"},{"1":"bill_depth","2":"0.538718879"},{"1":"island","2":"0.520157171"},{"1":"body_mass","2":"0.442879511"},{"1":"sex","2":"0.007244168"},{"1":"year","2":"0.000000000"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>penguins 데이터의 경우 species 가 target인데, 펭귄의 종을 설명하는 각 피처들의 점수를 보여줍니다.</p>
<p>일부 filter들은 hyperparameters가 존재하는데, learner에서 param_set을 변경해주는 것처럼 간단히 변경 가능합니다. 예를 들면 correlation 방법의 경우 피어슨 또는 스피어만 방법으로 변경해줄 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>filter_cor <span class="ot">&lt;-</span> <span class="fu">flt</span>(<span class="st">'correlation'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>filter_cor<span class="sc">$</span>param_set<span class="sc">$</span>values <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">method=</span><span class="st">'spearman'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>filter_cor<span class="sc">$</span>param_set</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;ParamSet&gt;
       id    class lower upper nlevels    default    value
   &lt;char&gt;   &lt;char&gt; &lt;num&gt; &lt;num&gt;   &lt;int&gt;     &lt;list&gt;   &lt;list&gt;
1:    use ParamFct    NA    NA       5 everything         
2: method ParamFct    NA    NA       3    pearson spearman</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>task2 <span class="ot">&lt;-</span> <span class="fu">tsk</span>(<span class="st">"mtcars"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>filter_cor<span class="sc">$</span><span class="fu">calculate</span>(task2)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.table</span>(filter_cor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["feature"],"name":[1],"type":["chr"],"align":["left"]},{"label":["score"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"cyl","2":"0.9108013"},{"1":"disp","2":"0.9088824"},{"1":"hp","2":"0.8946646"},{"1":"wt","2":"0.8864220"},{"1":"vs","2":"0.7065968"},{"1":"carb","2":"0.6574976"},{"1":"drat","2":"0.6514555"},{"1":"am","2":"0.5620057"},{"1":"gear","2":"0.5427816"},{"1":"qsec","2":"0.4669358"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="feature-importance-filters" class="level3">
<h3 class="anchored" data-anchor-id="feature-importance-filters">Feature importance filters</h3>
<p>피처 중요도 필터는 중요도(importance) 가 있는 모델에서 사용 가능한 필터입니다. 중요도 계산을 할 수 있는 러너들은 아래와 같습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.table</span>(mlr_learners)[<span class="fu">sapply</span>(properties, \(x) <span class="st">"importance"</span> <span class="sc">%in%</span> x)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["key"],"name":[1],"type":["chr"],"align":["left"]},{"label":["label"],"name":[2],"type":["chr"],"align":["left"]},{"label":["task_type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["feature_types"],"name":[4],"type":["list"],"align":["right"]},{"label":["packages"],"name":[5],"type":["list"],"align":["right"]},{"label":["properties"],"name":[6],"type":["list"],"align":["right"]},{"label":["predict_types"],"name":[7],"type":["list"],"align":["right"]}],"data":[{"1":"classif.featureless","2":"Featureless Classification Learner","3":"classif","4":"<chr [7]>","5":"<chr [1]>","6":"<chr [6]>","7":"<chr [2]>"},{"1":"classif.ranger","2":"NA","3":"classif","4":"<chr [6]>","5":"<chr [3]>","6":"<chr [6]>","7":"<chr [2]>"},{"1":"classif.rpart","2":"Classification Tree","3":"classif","4":"<chr [5]>","5":"<chr [2]>","6":"<chr [6]>","7":"<chr [2]>"},{"1":"classif.xgboost","2":"NA","3":"classif","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [6]>","7":"<chr [2]>"},{"1":"regr.featureless","2":"Featureless Regression Learner","3":"regr","4":"<chr [7]>","5":"<chr [2]>","6":"<chr [4]>","7":"<chr [2]>"},{"1":"regr.ranger","2":"NA","3":"regr","4":"<chr [6]>","5":"<chr [3]>","6":"<chr [4]>","7":"<chr [2]>"},{"1":"regr.rpart","2":"Regression Tree","3":"regr","4":"<chr [5]>","5":"<chr [2]>","6":"<chr [4]>","7":"<chr [1]>"},{"1":"regr.xgboost","2":"NA","3":"regr","4":"<chr [3]>","5":"<chr [3]>","6":"<chr [4]>","7":"<chr [1]>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><code>ranger</code>와 같은 일부 러너는 중요도 속성을 갖고 있지만, learner를 만들 때 지정을 해줘야 합니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3learners)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>lrn_rf <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">'classif.ranger'</span>, <span class="at">importance=</span><span class="st">'impurity'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이제 <code>FilterImportance</code> 필터를 이용해보겠습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 결측변수 제거하기</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>task<span class="sc">$</span><span class="fu">filter</span>(<span class="fu">which</span>(<span class="fu">complete.cases</span>(task<span class="sc">$</span><span class="fu">data</span>())))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>filter_imp <span class="ot">&lt;-</span> <span class="fu">flt</span>(<span class="st">'importance'</span>, <span class="at">learner=</span>lrn_rf)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>filter_imp<span class="sc">$</span><span class="fu">calculate</span>(task)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>filter_imp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;FilterImportance:importance&gt;: Importance Score
Task Types: classif
Properties: -
Task Properties: -
Packages: mlr3, mlr3learners, ranger
Feature types: logical, integer, numeric, character, factor, ordered
          feature     score
1:    bill_length 75.228997
2: flipper_length 50.796965
3:     bill_depth 33.371397
4:         island 25.564683
5:      body_mass 23.717214
6:            sex  1.387641
7:           year  1.005973</code></pre>
</div>
</div>
</section>
<section id="embedded-methods" class="level3">
<h3 class="anchored" data-anchor-id="embedded-methods">Embedded methods</h3>
<p>러너로 학습을 진행할 때, 러너는 예측에 도움이 되는 피처의 일부들을 선택하고 나머지 피처는 무시합니다. 이렇게 러너가 선택한 피처의 일부를 피처 선택으로 사용할 수가 있습니다. Embedded 방법이라고 불리는 이유가 바로 피처 선택이 러너 안에 포함되어 있기 때문입니다.</p>
<p>선택된 피처의 경우 러너가 <code>selected_features</code> 라는 속성에 있는 경우 확인해볼 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>task <span class="ot">&lt;-</span> <span class="fu">tsk</span>(<span class="st">'penguins'</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>learner <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">'classif.rpart'</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="st">'selected_features'</span> <span class="sc">%in%</span> learner<span class="sc">$</span>properties)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>learner<span class="sc">$</span><span class="fu">train</span>(task)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>learner<span class="sc">$</span><span class="fu">selected_features</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "flipper_length" "bill_length"    "island"        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>filter <span class="ot">&lt;-</span> <span class="fu">flt</span>(<span class="st">'selected_features'</span>, <span class="at">learner=</span>learner)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>filter<span class="sc">$</span><span class="fu">calculate</span>(task)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>filter</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;FilterSelectedFeatures:selected_features&gt;: Embedded Feature Selection
Task Types: classif
Properties: missings
Task Properties: -
Packages: mlr3, rpart
Feature types: logical, integer, numeric, factor, ordered
          feature score
1: flipper_length     1
2:    bill_length     1
3:         island     1
4:           year     0
5:     bill_depth     0
6:            sex     0
7:      body_mass     0</code></pre>
</div>
</div>
<p>결과를 봤을 때, 학습시킨 모델에 의해 선택된 피처 점수는 1, 나머지는 0 즉 사용되지 않은 피처인 것을 알 수 있습니다.</p>
</section>
<section id="filter-based-feature-selection" class="level3">
<h3 class="anchored" data-anchor-id="filter-based-feature-selection">Filter-based feature selection</h3>
<p>필터를 통해 각 피처들의 점수가 계산이 되었다면, 다음 모델링 단계에서 피처 선택하여 학습을 진행해야 합니다. 위의 임베디드 방법에서 확인한 <code>selected_features</code>의 경우 1과 0으로 선택되는 변수를 구분할 수 있기 때문에 피처 선택에 있어 가장 직관적입니다. 따라서 여기서 선택된 피처들을 사용한다면 아래와 같이 수행할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>task <span class="ot">&lt;-</span> <span class="fu">tsk</span>(<span class="st">'penguins'</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>learner <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">'classif.rpart'</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>filter <span class="ot">&lt;-</span> <span class="fu">flt</span>(<span class="st">'selected_features'</span>, <span class="at">learner=</span>learner)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>filter<span class="sc">$</span><span class="fu">calculate</span>(task)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">which</span>(filter<span class="sc">$</span>scores<span class="sc">==</span><span class="dv">1</span>))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>task<span class="sc">$</span><span class="fu">select</span>(keep) <span class="co"># column을 선택하기 때문에 select</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>task<span class="sc">$</span>feature_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "bill_length"    "flipper_length" "island"        </code></pre>
</div>
</div>
<p>위의 예시에서는 selected_features를 했기 때문에 0과 1로 구분이 되었기 때문에 피처들을 쉽게 선택할 수 있었습니다.</p>
<p>연속형 점수로 피처의 점수가 출력되는 경우에서 피처 선택을 수행하는 경우는 다음과 같은 방법이 있습니다.</p>
<ul>
<li>위에서 top N개의 feature 선택하는 경우</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>task <span class="ot">&lt;-</span> <span class="fu">tsk</span>(<span class="st">'penguins'</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>learner <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">'classif.rpart'</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>filter <span class="ot">&lt;-</span> <span class="fu">flt</span>(<span class="st">'information_gain'</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>filter<span class="sc">$</span><span class="fu">calculate</span>(task)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># top 3개 선택</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">head</span>(filter<span class="sc">$</span>scores,<span class="dv">3</span>))</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>task<span class="sc">$</span><span class="fu">select</span>(keep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>score가 특정 기준 k 보다 큰 경우</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>task <span class="ot">&lt;-</span> <span class="fu">tsk</span>(<span class="st">'penguins'</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>learner <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">'classif.rpart'</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>filter <span class="ot">&lt;-</span> <span class="fu">flt</span>(<span class="st">'information_gain'</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>filter<span class="sc">$</span><span class="fu">calculate</span>(task)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># information gain이 0.5보다 큰 경우</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">which</span>(filter<span class="sc">$</span>scores<span class="sc">&gt;</span><span class="fl">0.5</span>))</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>task<span class="sc">$</span><span class="fu">select</span>(keep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="래퍼-방식" class="level2">
<h2 class="anchored" data-anchor-id="래퍼-방식">래퍼 방식</h2>
<p>래퍼 방식은 피처들의 일부를 선택한 뒤 그 피처들로 모델링을 하고 그 모델의 성능을 비교하여, 최적의 성능을 나타낼 때의 피처들을 선택하게 됩니다. 한마디로 모델의 성능을 최적화하기 위해 반복적으로 피처들을 선택하는 것입니다.</p>
<p>래퍼 방식은 피처들의 순위를 매기는 대신, 일부 피처 사용하여 학습한 뒤 선택된 성능 지표에 따라 평가하게 됩니다. 이는 하이퍼파라미터 최적화 과정과 굉장히 유사합니다. 즉 하이퍼파라미터 최적화를 통해 높은 성능을 내는 하이퍼파라미터를 찾는 것처럼 래퍼 방식을 통해 높은 성능을 내는 피처들을 찾는 것입니다.</p>
<section id="간단한-예시" class="level3">
<h3 class="anchored" data-anchor-id="간단한-예시">간단한 예시</h3>
<p>mlr3에서는 <code>mlr3fselect</code> 패키지의 <code>FSelector</code> 객체를 이용하여 위의 방법을 수행합니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3fselect)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>instance <span class="ot">&lt;-</span> <span class="fu">fselect</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fselector =</span> <span class="fu">fs</span>(<span class="st">"sequential"</span>),</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">task=</span> <span class="fu">tsk</span>(<span class="st">'penguins'</span>)<span class="sc">$</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"bill_depth"</span>,<span class="st">"bill_length"</span>,<span class="st">"body_mass"</span>,<span class="st">"flipper_length"</span>)),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">learner =</span> <span class="fu">lrn</span>(<span class="st">'classif.rpart'</span>),</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">resampling =</span> <span class="fu">rsmp</span>(<span class="st">'holdout'</span>),</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">measure =</span> <span class="fu">msr</span>(<span class="st">'classif.acc'</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>성능 비교를 위한 피처들의 모든 하위집단을 확인하기 위해선 아래의 코드로 확인 가능합니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(instance<span class="sc">$</span>archive)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>dt[batch_nr <span class="sc">==</span><span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>][<span class="fu">order</span>(<span class="sc">-</span>classif.acc)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["bill_depth"],"name":[1],"type":["lgl"],"align":["right"]},{"label":["bill_length"],"name":[2],"type":["lgl"],"align":["right"]},{"label":["body_mass"],"name":[3],"type":["lgl"],"align":["right"]},{"label":["flipper_length"],"name":[4],"type":["lgl"],"align":["right"]},{"label":["classif.acc"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"FALSE","2":"FALSE","3":"FALSE","4":"TRUE","5":"0.7913043"},{"1":"TRUE","2":"FALSE","3":"FALSE","4":"FALSE","5":"0.7043478"},{"1":"FALSE","2":"TRUE","3":"FALSE","4":"FALSE","5":"0.7043478"},{"1":"FALSE","2":"FALSE","3":"TRUE","4":"FALSE","5":"0.7043478"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>위의 결과를 확인해보니, <code>flipper_length</code>가 첫 번째 반복에서 가장 높은 예측 성능을 보였습니다(정확도 0.7478). 또한 두 번째 반복에서는 <code>bill_length</code> 피처가 더해지자가 무려 90% 이상의 예측 정확도가 나타났습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>dt[batch_nr <span class="sc">==</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>][<span class="fu">order</span>(<span class="sc">-</span>classif.acc)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["bill_depth"],"name":[1],"type":["lgl"],"align":["right"]},{"label":["bill_length"],"name":[2],"type":["lgl"],"align":["right"]},{"label":["body_mass"],"name":[3],"type":["lgl"],"align":["right"]},{"label":["flipper_length"],"name":[4],"type":["lgl"],"align":["right"]},{"label":["classif.acc"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"FALSE","2":"TRUE","3":"FALSE","4":"TRUE","5":"0.9304348"},{"1":"FALSE","2":"FALSE","3":"TRUE","4":"TRUE","5":"0.8000000"},{"1":"TRUE","2":"FALSE","3":"FALSE","4":"TRUE","5":"0.7739130"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>dt[batch_nr <span class="sc">==</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>][<span class="fu">order</span>(<span class="sc">-</span>classif.acc)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["bill_depth"],"name":[1],"type":["lgl"],"align":["right"]},{"label":["bill_length"],"name":[2],"type":["lgl"],"align":["right"]},{"label":["body_mass"],"name":[3],"type":["lgl"],"align":["right"]},{"label":["flipper_length"],"name":[4],"type":["lgl"],"align":["right"]},{"label":["classif.acc"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"FALSE","2":"TRUE","3":"TRUE","4":"TRUE","5":"0.9304348"},{"1":"TRUE","2":"TRUE","3":"FALSE","4":"TRUE","5":"0.9217391"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>반면에 세 번째 반복에서 <code>bill_depth가</code> 추가되었지만, 예측 성능이 향상되지는 않았습니다.</p>
<p>최적의 feature 들을 확인하기 위해서는 아래와 같이 입력할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>instance<span class="sc">$</span>result_feature_set</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fselectinstance-클래스" class="level3">
<h3 class="anchored" data-anchor-id="fselectinstance-클래스"><code>FSelectInstance</code> 클래스</h3>
<p><code>mlr3fselect</code> 에서 피처 선택을 수행할 경우, <code>fselect()</code> 함수는 <code>FSelectInstanceSingleCrit</code> 객체를 만들고, <code>FSelector</code> 객체를 통해 피처 선택을 실시합니다.</p>
<p><code>FSelectInstanceSingleCrit</code> 객체를 만들기 위해 fsi() sugar function을 사용할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>instance <span class="ot">&lt;-</span> <span class="fu">fsi</span>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">task =</span> <span class="fu">tsk</span>(<span class="st">"penguins"</span>),</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">learner =</span> <span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">resampling =</span> <span class="fu">rsmp</span>(<span class="st">"holdout"</span>),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">measure =</span> <span class="fu">msr</span>(<span class="st">"classif.acc"</span>),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">"evals"</span>, <span class="at">n_evals=</span><span class="dv">5</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>이제 피처 선택을 위한 인스턴스가 만들어졌습니다. 다음으로 해야할 것은 이 인스턴스를 어떤 알고리즘을 통해 수행할 것인지입니다.</p>
</section>
<section id="fselector-클래스" class="level3">
<h3 class="anchored" data-anchor-id="fselector-클래스"><code>Fselector</code> 클래스</h3>
<p><code>mlr3fselect::FSelector</code>에는 다양한 종류의 피처 선택 알고리즘이 존재합니다.</p>
<ul>
<li>Random Search (<a href="https://mlr3fselect.mlr-org.com/reference/mlr_fselectors_random_search.html"><code>mlr3fselect::FSelectorRandomSearch</code></a>)</li>
<li>Exhaustive Search (<a href="https://mlr3fselect.mlr-org.com/reference/mlr_fselectors_exhaustive_search.html"><code>mlr3fselect::FSelectorExhaustiveSearch</code></a>)</li>
<li>Sequential Search (<a href="https://mlr3fselect.mlr-org.com/reference/mlr_fselectors_sequential.html"><code>mlr3fselect::FSelectorSequential</code></a>)</li>
<li>Recursive Feature Elimination (<a href="https://mlr3fselect.mlr-org.com/reference/mlr_fselectors_rfe.html"><code>mlr3fselect::FSelectorRFE</code></a>)</li>
<li>Design Points (<a href="https://mlr3fselect.mlr-org.com/reference/mlr_fselectors_design_points.html"><code>mlr3fselect::FSelectorDesignPoints</code></a>)</li>
<li>Genetic Search (<a href="https://mlr3fselect.mlr-org.com/reference/mlr_fselectors_genetic_search.html"><code>mlr3fselect::FSelectorGeneticSearch</code></a>)</li>
<li>Shadow Variable Search (<a href="https://mlr3fselect.mlr-org.com/reference/mlr_fselectors_shadow_variable_search.html"><code>mlr3fselect::FSelectorShadowVariableSearch</code></a>)</li>
</ul>
<p>이 알고리즘들을 활용하여 앞서 만들어놓은 인스턴스 (instance)에 대한 피처 선택을 수행합니다. 여기서는 간단한 random search 방식을 이용하도록 하겠습니다. <code>FSelector</code> 클래스는 <code>mlr_fselectors</code> 딕셔너리에서 확인할 수 있습니다. 또한 <code>fs()</code> sugar function을 통해 새로운 피처 선택 클래스를 만들어줄 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>fselector <span class="ot">&lt;-</span> <span class="fu">fs</span>(<span class="st">"random_search"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="피처-선택-수행" class="level3">
<h3 class="anchored" data-anchor-id="피처-선택-수행">피처 선택 수행</h3>
<p>피처 선택 역시 하이퍼파라미터 최적화에서 수행한 것처럼 <code>$optimize()</code> 메소드로 수행합니다. FSelector 클래스를 실행함으로써 최적의 분류 정확도를 갖는 피처들의 조합을 찾아낼 수 있습니다. 실행해보면 생각보다 오랜 시간이 걸리는 것을 알 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>fselector<span class="sc">$</span><span class="fu">optimize</span>(instance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["bill_depth"],"name":[1],"type":["lgl"],"align":["right"]},{"label":["bill_length"],"name":[2],"type":["lgl"],"align":["right"]},{"label":["body_mass"],"name":[3],"type":["lgl"],"align":["right"]},{"label":["flipper_length"],"name":[4],"type":["lgl"],"align":["right"]},{"label":["island"],"name":[5],"type":["lgl"],"align":["right"]},{"label":["sex"],"name":[6],"type":["lgl"],"align":["right"]},{"label":["year"],"name":[7],"type":["lgl"],"align":["right"]},{"label":["features"],"name":[8],"type":["list"],"align":["right"]},{"label":["classif.acc"],"name":[9],"type":["dbl"],"align":["right"]}],"data":[{"1":"FALSE","2":"TRUE","3":"TRUE","4":"TRUE","5":"TRUE","6":"FALSE","7":"TRUE","8":"<chr [5]>","9":"0.9478261"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>이 알고리즘은 다음과 같은 흐름으로 진행됩니다.</p>
<p>피처 선택이 종료되었다면, 최적의 피처 세트는 인스턴스를 통해 접근할 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.table</span>(instance<span class="sc">$</span>result)[,.(features, classif.acc)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["features"],"name":[1],"type":["list"],"align":["right"]},{"label":["classif.acc"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"<chr [5]>","2":"0.9478261"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><code>FSelectInstanceMultiCrit</code> 을 통해 여러 가지 조건으로 피처 선택을 진행할 수 있습니다. 앞서 만들었던 인스턴스와 달라지는 부분은 <code>measure</code> 뿐입니다. sugar function fsi()을 사용한다면 FSelectInstanceSingleCrit 과 FSelectInstanceMultiCrit을 구분 지을 필요 없이, measure의 개수로 자동으로 정해집니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>instance <span class="ot">=</span> <span class="fu">fsi</span>(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">task =</span> <span class="fu">tsk</span>(<span class="st">"penguins"</span>),</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">learner =</span> <span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>),</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">resampling =</span> <span class="fu">rsmp</span>(<span class="st">"holdout"</span>),</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">measure =</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">"classif.acc"</span>,<span class="st">"time_train"</span>)),</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">"evals"</span>, <span class="at">n_evals =</span> <span class="dv">5</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="피처-선택-자동화" class="level3">
<h3 class="anchored" data-anchor-id="피처-선택-자동화">피처 선택 자동화</h3>
<p><code>AutoFSelector</code> 클래스는 <code>FSelectInstanc</code> 를 만들고 <code>FSelector</code> 를 만들어 <code>$optimize()</code>하는 과정을 합쳐놓았습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3learners)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>af <span class="ot">=</span> <span class="fu">auto_fselector</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fselector =</span> <span class="fu">fs</span>(<span class="st">"random_search"</span>),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">learner =</span> <span class="fu">lrn</span>(<span class="st">"classif.log_reg"</span>),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">resampling =</span> <span class="fu">rsmp</span>(<span class="st">"holdout"</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">measure =</span> <span class="fu">msr</span>(<span class="st">"classif.acc"</span>),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">"evals"</span>, <span class="at">n_evals=</span><span class="dv">5</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>AutoFSelector</code> 역시 <code>AutoTuner</code> 와 마찬가지로 러너의 클래스를 상속받기 때문에 러너처럼 활용이 가능합니다. 그래서 피처 선택 이후 <code>$train()</code>,<code>$predict()</code> 메소드 사용이 가능합니다.</p>
<p>이번에는 <code>benchmark()</code>를 통해 피처 선택을 통해 만든 모델과, 그렇지 않은 모델의 성능을 비교해보도록 하겠습니다. <code>sonar</code> 데이터셋을 활용해 로지스틱 회귀 모형을 추가로 만들어줍니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">=</span> <span class="fu">benchmark_grid</span>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">task =</span> <span class="fu">tsk</span>(<span class="st">"sonar"</span>),</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">learner =</span> <span class="fu">list</span>(af, <span class="fu">lrn</span>(<span class="st">"classif.log_reg"</span>)),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">resampling =</span> <span class="fu">rsmp</span>(<span class="st">"cv"</span>, <span class="at">folds=</span><span class="dv">3</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>bmr <span class="ot">=</span> <span class="fu">benchmark</span>(grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>결과를 비교했을 때, 비록 모델 학습에 소요된 시간은 <code>AutoFSelector</code> 로 만든 모델이 더 오래 걸렸지만, 정확도 측면에서는 기본 로지스틱 회귀 모델보다 더 높은 성능을 보여주는 것을 알 수 있습니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>aggr <span class="ot">&lt;-</span> bmr<span class="sc">$</span><span class="fu">aggregate</span>(<span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">"classif.acc"</span>,<span class="st">"time_train"</span>)))</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.table</span>(aggr)[,.(learner_id, classif.acc, time_train)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["learner_id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["classif.acc"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["time_train"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"classif.log_reg.fselector","2":"0.7258109","3":"0.2243333"},{"1":"classif.log_reg","2":"0.7116632","3":"0.0200000"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
</section>
<section id="요약" class="level2">
<h2 class="anchored" data-anchor-id="요약">요약</h2>
<table class="table">
<colgroup>
<col style="width: 27%">
<col style="width: 48%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th>R6 Class</th>
<th>Sugar function</th>
<th>Summary</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Filter</td>
<td>flt()</td>
<td>각 피처들의 점수 계산을 통한 피처 선택</td>
</tr>
<tr class="even">
<td>FSelectInstanceSingleCrit or FSelectInstanceMultiCrit</td>
<td>fselect()</td>
<td>피처 선택 구성 및 결과 저장</td>
</tr>
<tr class="odd">
<td>FSelector</td>
<td>fs()</td>
<td>피처 선택 알고리즘 선택</td>
</tr>
<tr class="even">
<td>AutoFSelectoor</td>
<td>auto_fselector()</td>
<td>피처 선택 자동화</td>
</tr>
</tbody>
</table>
</section>
<section id="참고자료" class="level2">
<h2 class="anchored" data-anchor-id="참고자료">참고자료</h2>
<ul>
<li>https://mlr3book.mlr-org.com/feature-selection.html#sec-multicrit-featsel</li>
</ul>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>https://mlr3book.mlr-org.com/<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>https://mlr3.mlr-org.com/<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="rchemist0123/giscus-blog" data-repo-id="R_kgDOJBwa8Q" data-category="General" data-category-id="DIC_kwDOJBwa8c4CUbVM" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left"><a href="https://https://rchemistblog.com/">Rchemist</a> © 2023 by <a href="https://https://rchemist.quarto.pub/rchemistblog/about.html">YH Jang</a></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:danjang0123@gmail.com">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/danjang0123/">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>