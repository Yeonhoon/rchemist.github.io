{
  "hash": "febda180eaa4a24683e45355a8f2d65b",
  "result": {
    "markdown": "---\ntitle: \"ggplot에서 두 번째 y축 그리기\"\ndescription:  \"ggplot으로 그래프에 두 개의 y축을 활용하는 방법을 배우기\"\ndate: '2023-02-02'\ncategories: [ggplot2, R, Visualization, axis]\nimage: \"https://r-graph-gallery.com/line-chart-dual-Y-axis-ggplot2_files/figure-html/thecode3-1.png\"\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- data.table(\n  day= as.factor(rep(c(1,2,3,7),each=2)),\n  transfusion=rep(c('Yes','No'), 4),\n  num=c(157,845,134,681,68,559, 27,342)\n)\ndat[,transfusion:=factor(transfusion, levels=c('No','Yes'))]\ndat[,y_pos := cumsum(num)-0.5*num,by=.(day)]\n\ndat[,prop :=num/sum(num)*100,by=day]\ndat\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"day\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"transfusion\"],\"name\":[2],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"num\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"y_pos\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"prop\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"Yes\",\"3\":\"157\",\"4\":\"78.5\",\"5\":\"15.668663\"},{\"1\":\"1\",\"2\":\"No\",\"3\":\"845\",\"4\":\"579.5\",\"5\":\"84.331337\"},{\"1\":\"2\",\"2\":\"Yes\",\"3\":\"134\",\"4\":\"67.0\",\"5\":\"16.441718\"},{\"1\":\"2\",\"2\":\"No\",\"3\":\"681\",\"4\":\"474.5\",\"5\":\"83.558282\"},{\"1\":\"3\",\"2\":\"Yes\",\"3\":\"68\",\"4\":\"34.0\",\"5\":\"10.845295\"},{\"1\":\"3\",\"2\":\"No\",\"3\":\"559\",\"4\":\"347.5\",\"5\":\"89.154705\"},{\"1\":\"7\",\"2\":\"Yes\",\"3\":\"27\",\"4\":\"13.5\",\"5\":\"7.317073\"},{\"1\":\"7\",\"2\":\"No\",\"3\":\"342\",\"4\":\"198.0\",\"5\":\"92.682927\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nratio <- data.table(\n  day= as.factor(c(1,2,3,7)),\n  prob = c(15.8,32.2,43.0,50.4)\n)\nratio\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"day\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"prob\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"15.8\"},{\"1\":\"2\",\"2\":\"32.2\"},{\"1\":\"3\",\"2\":\"43.0\"},{\"1\":\"7\",\"2\":\"50.4\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nggplot()+\n  geom_col(data=dat,aes(x=day,y=num, fill=transfusion),\n           color='black', alpha=.5,\n           width=0.5,\n    position = position_stack()) +\n  scale_y_continuous(limits=c(0,1010),expand=c(0,0),\n                     name='Number of patients',\n                     sec.axis = sec_axis(~.*0.1,\n                                         name='Proportion of patients received a transfusion (%)'))+\n  geom_point(data=ratio, aes(x=day, y=prob/0.1, \n                             color='Pateints received transfusion'), \n             size=3)+\n  geom_text(data=dat, aes(x=day, label=num, y=y_pos))+\n  geom_line(data=ratio, aes(x=day, y=prob/0.1, group=1,\n                            color='Pateints received transfusion'))+\n  theme_classic() +\n  scale_color_manual(values=c('Pateints received transfusion'='black'))+\n  scale_fill_discrete(direction=-1,\n                      breaks=c('Yes','No'))+\n  labs(x='Follow-up (days)',\n       fill='RBC transfusion',\n       color='')+\n  theme(legend.position='top',\n        legend.direction = 'vertical',\n        legend.box = 'horizontal',\n        legend.box.spacing = unit(1,units = 'mm'),\n        axis.text.x = element_text(size=12),\n        axis.text.y = element_text(size=12)\n        ) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}