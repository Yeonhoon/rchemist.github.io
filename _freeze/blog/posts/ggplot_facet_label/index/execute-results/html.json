{
  "hash": "7550916e9427a4ffd3f5f39301814f44",
  "result": {
    "markdown": "---\ntitle: \"ggplot2 facet label 설정\"\ndescription: \"ggplot에서 facet을 사용할 때 label을 변경하는 방법에 대해 알아봅시다.\"\ndate: \"2023-02-22\"\ncategories: [R,ggplot2,facet]\nimage: \"https://ggplot2.tidyverse.org/logo.png\"\n---\n\n::: {.cell}\n\n:::\n\n\n다음과 같은 데이터가 있다고 가정해봅시다.\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Day\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"AKI_stage\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Chronic_kidney_ds\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"mean\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"sd\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"3\",\"3\":\"0\",\"4\":\"2.9037908\",\"5\":\"1.7570852\"},{\"1\":\"1\",\"2\":\"0\",\"3\":\"0\",\"4\":\"0.8221207\",\"5\":\"0.3211986\"},{\"1\":\"1\",\"2\":\"1\",\"3\":\"0\",\"4\":\"1.3607847\",\"5\":\"0.3042448\"},{\"1\":\"1\",\"2\":\"2\",\"3\":\"0\",\"4\":\"1.8165630\",\"5\":\"0.4730078\"},{\"1\":\"1\",\"2\":\"0\",\"3\":\"1\",\"4\":\"2.0183333\",\"5\":\"0.8219165\"},{\"1\":\"1\",\"2\":\"1\",\"3\":\"1\",\"4\":\"2.0848980\",\"5\":\"0.8072487\"},{\"1\":\"1\",\"2\":\"3\",\"3\":\"1\",\"4\":\"5.1058367\",\"5\":\"2.5924275\"},{\"1\":\"1\",\"2\":\"2\",\"3\":\"1\",\"4\":\"2.2385714\",\"5\":\"0.7584355\"},{\"1\":\"2\",\"2\":\"3\",\"3\":\"0\",\"4\":\"2.3235418\",\"5\":\"1.2475852\"},{\"1\":\"2\",\"2\":\"0\",\"3\":\"0\",\"4\":\"0.7216265\",\"5\":\"0.2772532\"},{\"1\":\"2\",\"2\":\"1\",\"3\":\"0\",\"4\":\"1.2027311\",\"5\":\"0.3294744\"},{\"1\":\"2\",\"2\":\"2\",\"3\":\"0\",\"4\":\"1.5879795\",\"5\":\"0.5195582\"},{\"1\":\"2\",\"2\":\"0\",\"3\":\"1\",\"4\":\"1.9852941\",\"5\":\"0.8116366\"},{\"1\":\"2\",\"2\":\"1\",\"3\":\"1\",\"4\":\"2.0038776\",\"5\":\"0.8744422\"},{\"1\":\"2\",\"2\":\"3\",\"3\":\"1\",\"4\":\"3.6372016\",\"5\":\"2.0937965\"},{\"1\":\"2\",\"2\":\"2\",\"3\":\"1\",\"4\":\"1.9161111\",\"5\":\"0.7930602\"},{\"1\":\"3\",\"2\":\"3\",\"3\":\"0\",\"4\":\"1.8634005\",\"5\":\"1.1565852\"},{\"1\":\"3\",\"2\":\"0\",\"3\":\"0\",\"4\":\"0.6481818\",\"5\":\"0.2629775\"},{\"1\":\"3\",\"2\":\"1\",\"3\":\"0\",\"4\":\"1.0360621\",\"5\":\"0.3639128\"},{\"1\":\"3\",\"2\":\"2\",\"3\":\"0\",\"4\":\"1.3843487\",\"5\":\"0.5536655\"},{\"1\":\"3\",\"2\":\"0\",\"3\":\"1\",\"4\":\"1.8876531\",\"5\":\"0.7924070\"},{\"1\":\"3\",\"2\":\"1\",\"3\":\"1\",\"4\":\"1.8980851\",\"5\":\"0.9308520\"},{\"1\":\"3\",\"2\":\"3\",\"3\":\"1\",\"4\":\"2.6856481\",\"5\":\"1.9424573\"},{\"1\":\"3\",\"2\":\"2\",\"3\":\"1\",\"4\":\"1.7028125\",\"5\":\"0.7981480\"},{\"1\":\"7\",\"2\":\"3\",\"3\":\"0\",\"4\":\"1.5593884\",\"5\":\"1.1030725\"},{\"1\":\"7\",\"2\":\"0\",\"3\":\"0\",\"4\":\"0.5830791\",\"5\":\"0.3032058\"},{\"1\":\"7\",\"2\":\"1\",\"3\":\"0\",\"4\":\"0.8822043\",\"5\":\"0.3853310\"},{\"1\":\"7\",\"2\":\"2\",\"3\":\"0\",\"4\":\"1.1469378\",\"5\":\"0.5773782\"},{\"1\":\"7\",\"2\":\"0\",\"3\":\"1\",\"4\":\"1.7015000\",\"5\":\"0.7344754\"},{\"1\":\"7\",\"2\":\"1\",\"3\":\"1\",\"4\":\"1.8176190\",\"5\":\"0.6658972\"},{\"1\":\"7\",\"2\":\"3\",\"3\":\"1\",\"4\":\"1.9981140\",\"5\":\"1.5035141\"},{\"1\":\"7\",\"2\":\"2\",\"3\":\"1\",\"4\":\"1.2106667\",\"5\":\"0.4380389\"},{\"1\":\"0\",\"2\":\"3\",\"3\":\"0\",\"4\":\"1.5572115\",\"5\":\"0.9903596\"},{\"1\":\"0\",\"2\":\"0\",\"3\":\"0\",\"4\":\"0.5875236\",\"5\":\"0.2406345\"},{\"1\":\"0\",\"2\":\"1\",\"3\":\"0\",\"4\":\"0.9099000\",\"5\":\"0.3173554\"},{\"1\":\"0\",\"2\":\"2\",\"3\":\"0\",\"4\":\"1.1970178\",\"5\":\"0.4821282\"},{\"1\":\"0\",\"2\":\"0\",\"3\":\"1\",\"4\":\"1.8157031\",\"5\":\"0.7765000\"},{\"1\":\"0\",\"2\":\"1\",\"3\":\"1\",\"4\":\"1.4814286\",\"5\":\"0.5352842\"},{\"1\":\"0\",\"2\":\"3\",\"3\":\"1\",\"4\":\"2.4386364\",\"5\":\"1.8162611\"},{\"1\":\"0\",\"2\":\"2\",\"3\":\"1\",\"4\":\"1.1119444\",\"5\":\"0.3484973\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n만성신질환 (Chronic kidney disease, CKD) 여부에 따라 급성신손상(Acute kidney injury, AKI)의 단계별로 ICU 입원기간 1일부터 7일 간 Cr의 수치를 비교하는 그래프를 그린다고 가정해봅시다.\n\n우선 CKD 여부에 따른 그래프를 각각 그릴 수 있을 것입니다. 이 때, `patchwork` 패키지를 이용해 두 개의 그래프를 붙여줄 수 있습니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_non_ckd <- data[Chronic_kidney_ds==0]|> \n  ggplot(aes(x=Day, y=mean,\n             group = as.factor(AKI_stage)))+\n  geom_line(aes(color=as.factor(AKI_stage))) +\n  geom_ribbon(aes(y=mean, ymin=mean-sd ,ymax = mean+sd, fill=as.factor(AKI_stage)),\n              alpha=.2) +\n  geom_point(aes(color=as.factor(AKI_stage))) +\n  scale_y_continuous(expand=c(0,0),\n                     limits=c(0,8),\n                     breaks=seq(0,8,1))+\n  scale_color_discrete(name=\"AKI Stage\") + \n  scale_fill_discrete(name=\"AKI Stage\") + \n  theme_classic() + \n  labs(x=\"ICU Days\",\n       y= \"Average Cr (mg/dL)\") +\n  theme(legend.position = \"top\")\n\nplot_ckd <- data[Chronic_kidney_ds==1]|> \n  ggplot(aes(x=Day, y=mean,\n             group = as.factor(AKI_stage)))+\n  geom_line(aes(color=as.factor(AKI_stage))) +\n  geom_ribbon(aes(y=mean, ymin=mean-sd ,ymax = mean+sd, fill=as.factor(AKI_stage)),\n              alpha=.2) +\n  geom_point(aes(color=as.factor(AKI_stage))) +\n  scale_y_continuous(expand=c(0,0),\n                     limits=c(0,8),\n                     breaks=seq(0,8,1))+\n  scale_color_discrete(name=\"AKI Stage\") + \n  scale_fill_discrete(name=\"AKI Stage\") + \n  theme_classic() + \n  labs(x=\"ICU Days\",\n       y= \"Average Cr (mg/dL)\") +\n  theme(legend.position = \"top\")\n\n\nplot_non_ckd + plot_ckd\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n물론 두 개의 그래프를 각각 보여주는 것도 나쁘지 않습니다. 다만 y축이나 legend는 공통된 값들이기 때문에 두 번 보여줄 필요는 없습니다.\n\n그럴 때는 `facet_grid()` 를 이용해주면 됩니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot <- data|> \n  ggplot(aes(x=Day, y=mean,\n             group = as.factor(AKI_stage)))+\n  geom_line(aes(color=as.factor(AKI_stage))) +\n  geom_ribbon(aes(y=mean, ymin=mean-sd ,ymax = mean+sd, fill=as.factor(AKI_stage)),\n              alpha=.2) +\n  geom_point(aes(color=as.factor(AKI_stage))) +\n  scale_y_continuous(expand=c(0,0),\n                     limits=c(0,8),\n                     breaks=seq(0,8,1))+\n  scale_color_discrete(name=\"AKI Stage\") + \n  scale_fill_discrete(name=\"AKI Stage\") + \n  theme_classic() + \n  labs(x=\"ICU Days\",\n       y= \"Average Cr (mg/dL)\") +\n  theme(legend.position = \"top\")\n\nplot + facet_grid(~Chronic_kidney_ds)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n여기서 CKD 변수의 코딩이 0과 1로 되어있어, 그래프에도 0과 1로 나타났습니다. facet의 label을 수정하려면 아래와 같이 `labeller`를 추가해주면 됩니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nckd_label <- c(\"Non-CKD\",\"CKD\")\nnames(ckd_label) <- c(0,1)\nplot + \n  facet_grid(~Chronic_kidney_ds,\n             labeller = labeller(Chronic_kidney_ds=ckd_label))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n`labeller` 사용이 어렵다면 데이터의 자체를 리코딩(변경)해주면 됩니다.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}