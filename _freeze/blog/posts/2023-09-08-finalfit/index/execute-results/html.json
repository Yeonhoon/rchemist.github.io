{
  "hash": "d4bd10a18de73e444ebbaa15667bd262",
  "result": {
    "markdown": "---\ntitle: \"finalfit을 이용한 분석결과 시각화\"\ndescription: \"테이블 + forest그래프 그리기\"\nauthor: \"JYH\"\ndate: \"2023-09-08\"\ncategories: [R, table, forestplot, finalfit]\nimage: \"https://finalfit.org/reference/figures/finalfit_hex.png\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(\"finalfit\")\nlibrary(finalfit)\n```\n:::\n\n\n데이터는 `finalfit` 패키지에 포함된 `colon_s` 데이터를 사용하겠습니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(colon_s)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"id\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"rx\"],\"name\":[2],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"sex\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"age\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"obstruct\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"perfor\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"adhere\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"nodes\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"status\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"differ\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"extent\"],\"name\":[11],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"surg\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"node4\"],\"name\":[13],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"time\"],\"name\":[14],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"sex.factor\"],\"name\":[15],\"type\":[\"labelled\"],\"align\":[\"right\"]},{\"label\":[\"rx.factor\"],\"name\":[16],\"type\":[\"labelled\"],\"align\":[\"right\"]},{\"label\":[\"obstruct.factor\"],\"name\":[17],\"type\":[\"labelled\"],\"align\":[\"right\"]},{\"label\":[\"perfor.factor\"],\"name\":[18],\"type\":[\"labelled\"],\"align\":[\"right\"]},{\"label\":[\"adhere.factor\"],\"name\":[19],\"type\":[\"labelled\"],\"align\":[\"right\"]},{\"label\":[\"differ.factor\"],\"name\":[20],\"type\":[\"labelled\"],\"align\":[\"right\"]},{\"label\":[\"extent.factor\"],\"name\":[21],\"type\":[\"labelled\"],\"align\":[\"right\"]},{\"label\":[\"surg.factor\"],\"name\":[22],\"type\":[\"labelled\"],\"align\":[\"right\"]},{\"label\":[\"node4.factor\"],\"name\":[23],\"type\":[\"labelled\"],\"align\":[\"right\"]},{\"label\":[\"status.factor\"],\"name\":[24],\"type\":[\"labelled\"],\"align\":[\"right\"]},{\"label\":[\"age.factor\"],\"name\":[25],\"type\":[\"labelled\"],\"align\":[\"right\"]},{\"label\":[\"loccomp\"],\"name\":[26],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"loccomp.factor\"],\"name\":[27],\"type\":[\"labelled\"],\"align\":[\"right\"]},{\"label\":[\"time.years\"],\"name\":[28],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"mort_5yr\"],\"name\":[29],\"type\":[\"labelled\"],\"align\":[\"right\"]},{\"label\":[\"age.10\"],\"name\":[30],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"mort_5yr.num\"],\"name\":[31],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"hospital\"],\"name\":[32],\"type\":[\"fct\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"1\",\"2\":\"Lev+5FU\",\"3\":\"1\",\"4\":\"43\",\"5\":\"NA\",\"6\":\"0\",\"7\":\"0\",\"8\":\"5\",\"9\":\"1\",\"10\":\"2\",\"11\":\"3\",\"12\":\"0\",\"13\":\"1\",\"14\":\"1521\",\"15\":\"Male\",\"16\":\"Lev+5FU\",\"17\":\"NA\",\"18\":\"No\",\"19\":\"No\",\"20\":\"Moderate\",\"21\":\"Serosa\",\"22\":\"Short\",\"23\":\"Yes\",\"24\":\"Died\",\"25\":\"40-59 years\",\"26\":\"NA\",\"27\":\"NA\",\"28\":\"4.1671233\",\"29\":\"Died\",\"30\":\"4.3\",\"31\":\"2\",\"32\":\"hospital_5\",\"_rn_\":\"1\"},{\"1\":\"2\",\"2\":\"Lev+5FU\",\"3\":\"1\",\"4\":\"63\",\"5\":\"0\",\"6\":\"0\",\"7\":\"0\",\"8\":\"1\",\"9\":\"0\",\"10\":\"2\",\"11\":\"3\",\"12\":\"0\",\"13\":\"0\",\"14\":\"3087\",\"15\":\"Male\",\"16\":\"Lev+5FU\",\"17\":\"No\",\"18\":\"No\",\"19\":\"No\",\"20\":\"Moderate\",\"21\":\"Serosa\",\"22\":\"Short\",\"23\":\"No\",\"24\":\"Alive\",\"25\":\"60+ years\",\"26\":\"0\",\"27\":\"No\",\"28\":\"8.4575342\",\"29\":\"Alive\",\"30\":\"6.3\",\"31\":\"1\",\"32\":\"hospital_3\",\"_rn_\":\"2\"},{\"1\":\"3\",\"2\":\"Obs\",\"3\":\"0\",\"4\":\"71\",\"5\":\"0\",\"6\":\"0\",\"7\":\"1\",\"8\":\"7\",\"9\":\"1\",\"10\":\"2\",\"11\":\"2\",\"12\":\"0\",\"13\":\"1\",\"14\":\"963\",\"15\":\"Female\",\"16\":\"Obs\",\"17\":\"No\",\"18\":\"No\",\"19\":\"Yes\",\"20\":\"Moderate\",\"21\":\"Muscle\",\"22\":\"Short\",\"23\":\"Yes\",\"24\":\"Died\",\"25\":\"60+ years\",\"26\":\"1\",\"27\":\"Yes\",\"28\":\"2.6383562\",\"29\":\"Died\",\"30\":\"7.1\",\"31\":\"2\",\"32\":\"hospital_5\",\"_rn_\":\"3\"},{\"1\":\"4\",\"2\":\"Lev+5FU\",\"3\":\"0\",\"4\":\"66\",\"5\":\"1\",\"6\":\"0\",\"7\":\"0\",\"8\":\"6\",\"9\":\"1\",\"10\":\"2\",\"11\":\"3\",\"12\":\"1\",\"13\":\"1\",\"14\":\"293\",\"15\":\"Female\",\"16\":\"Lev+5FU\",\"17\":\"Yes\",\"18\":\"No\",\"19\":\"No\",\"20\":\"Moderate\",\"21\":\"Serosa\",\"22\":\"Long\",\"23\":\"Yes\",\"24\":\"Died\",\"25\":\"60+ years\",\"26\":\"1\",\"27\":\"Yes\",\"28\":\"0.8027397\",\"29\":\"Died\",\"30\":\"6.6\",\"31\":\"2\",\"32\":\"hospital_4\",\"_rn_\":\"4\"},{\"1\":\"5\",\"2\":\"Obs\",\"3\":\"1\",\"4\":\"69\",\"5\":\"0\",\"6\":\"0\",\"7\":\"0\",\"8\":\"22\",\"9\":\"1\",\"10\":\"2\",\"11\":\"3\",\"12\":\"1\",\"13\":\"1\",\"14\":\"659\",\"15\":\"Male\",\"16\":\"Obs\",\"17\":\"No\",\"18\":\"No\",\"19\":\"No\",\"20\":\"Moderate\",\"21\":\"Serosa\",\"22\":\"Long\",\"23\":\"Yes\",\"24\":\"Died\",\"25\":\"60+ years\",\"26\":\"0\",\"27\":\"No\",\"28\":\"1.8054795\",\"29\":\"Died\",\"30\":\"6.9\",\"31\":\"2\",\"32\":\"hospital_5\",\"_rn_\":\"5\"},{\"1\":\"6\",\"2\":\"Lev+5FU\",\"3\":\"0\",\"4\":\"57\",\"5\":\"0\",\"6\":\"0\",\"7\":\"0\",\"8\":\"9\",\"9\":\"1\",\"10\":\"2\",\"11\":\"3\",\"12\":\"0\",\"13\":\"1\",\"14\":\"1767\",\"15\":\"Female\",\"16\":\"Lev+5FU\",\"17\":\"No\",\"18\":\"No\",\"19\":\"No\",\"20\":\"Moderate\",\"21\":\"Serosa\",\"22\":\"Short\",\"23\":\"Yes\",\"24\":\"Died\",\"25\":\"40-59 years\",\"26\":\"0\",\"27\":\"No\",\"28\":\"4.8410959\",\"29\":\"Died\",\"30\":\"5.7\",\"31\":\"2\",\"32\":\"hospital_4\",\"_rn_\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n# 테이블\n\n## 요약 테이블\n\n데이터의 기본 특성을 알려주는 요약 테이블은 `summary_factorlist()`를 이용합니다.\n\n설명변수와 종속변수를 각각 인자에 넣어도 되고, `~`을 이용해서 식 형태로 만들어줄 수 있습니다.\n\n::: {.cell}\n\n```{.r .cell-code}\ntbl1 = colon_s |> \n  summary_factorlist(\n    dependent = \"perfor.factor\",\n    explanatory = c(\"age\", \"age.factor\", \"sex.factor\", \"obstruct.factor\"),\n    # OR  formula = perfor.factor ~ age + age.factor + sex.factor + obstruct.factor,\n  p=TRUE, \n  add_dependent_label=TRUE,\n  total_col = TRUE)\nknitr::kable(tbl1, \n             row.names=FALSE, \n             align=c(\"l\", \"l\", \"r\", \"r\", \"r\"))\n```\n\n::: {.cell-output-display}\n|Dependent: Perforation |            |          No|         Yes|       Total|p     |\n|:----------------------|:-----------|-----------:|-----------:|-----------:|:-----|\n|Age (years)            |Mean (SD)   | 59.8 (11.9)| 58.4 (13.3)| 59.8 (11.9)|0.542 |\n|Age                    |<40 years   |    68 (7.5)|     2 (7.4)|    70 (7.5)|1.000 |\n|                       |40-59 years |  334 (37.0)|   10 (37.0)|  344 (37.0)|      |\n|                       |60+ years   |  500 (55.4)|   15 (55.6)|  515 (55.4)|      |\n|Sex                    |Female      |  432 (47.9)|   13 (48.1)|  445 (47.9)|1.000 |\n|                       |Male        |  470 (52.1)|   14 (51.9)|  484 (52.1)|      |\n|Obstruction            |No          |  715 (81.2)|   17 (63.0)|  732 (80.6)|0.035 |\n|                       |Yes         |  166 (18.8)|   10 (37.0)|  176 (19.4)|      |\n:::\n:::\n\n\n## 변수에 따른 Test 설정\n\n범주형 변수의 경우는 `p_cat`을 이용해 `chisq` 또는 `fisher`를 선택할 수 있습니다.\n\n연속형 변수의 경우, 기본적으로 `kruskal.test`가 적용됩니다. 다만 `p_cont_para='t.test'`를 적용하여 모수 분석로 가정한 p값을 산출할 수 있습니다.\n\n::: {.cell}\n\n```{.r .cell-code}\ntbl2  = colon_s |> \n  summary_factorlist(\n    dependent = \"perfor.factor\",\n    explanatory = c(\"age\", \"age.factor\", \"sex.factor\", \"obstruct.factor\"),\n  p=TRUE, \n  p_cat = \"fisher\",\n  p_cont_para = 't.test',\n  add_dependent_label=TRUE,\n  total_col = TRUE)\nknitr::kable(tbl2, \n             row.names=FALSE, \n             align=c(\"l\", \"l\", \"r\", \"r\", \"r\"))\n```\n\n::: {.cell-output-display}\n|Dependent: Perforation |            |          No|         Yes|       Total|p     |\n|:----------------------|:-----------|-----------:|-----------:|-----------:|:-----|\n|Age (years)            |Mean (SD)   | 59.8 (11.9)| 58.4 (13.3)| 59.8 (11.9)|0.586 |\n|Age                    |<40 years   |    68 (7.5)|     2 (7.4)|    70 (7.5)|1.000 |\n|                       |40-59 years |  334 (37.0)|   10 (37.0)|  344 (37.0)|      |\n|                       |60+ years   |  500 (55.4)|   15 (55.6)|  515 (55.4)|      |\n|Sex                    |Female      |  432 (47.9)|   13 (48.1)|  445 (47.9)|1.000 |\n|                       |Male        |  470 (52.1)|   14 (51.9)|  484 (52.1)|      |\n|Obstruction            |No          |  715 (81.2)|   17 (63.0)|  732 (80.6)|0.026 |\n|                       |Yes         |  166 (18.8)|   10 (37.0)|  176 (19.4)|      |\n:::\n:::\n\n\n\n비모수 연속형 변수의 경우 `cont='median'`을 통해 mean(SD)가 아닌 Median(IQR)값으로 출력할 수 있습니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntbl3  = colon_s |> \n  summary_factorlist(\n    dependent = \"perfor.factor\",\n    explanatory = c(\"age\", \"nodes\",  \"age.factor\", \"sex.factor\", \"obstruct.factor\"),\n  p=TRUE, \n  cont = \"median\",\n  total_col = TRUE)\nknitr::kable(tbl3, \n             row.names=FALSE, \n             align=c(\"l\", \"l\", \"r\", \"r\", \"r\"))\n```\n\n::: {.cell-output-display}\n|label       |levels       |                  No|                 Yes|               Total|p     |\n|:-----------|:------------|-------------------:|-------------------:|-------------------:|:-----|\n|Age (years) |Median (IQR) | 61.0 (53.0 to 69.0)| 60.0 (50.0 to 68.0)| 61.0 (53.0 to 69.0)|0.578 |\n|nodes       |Median (IQR) |    2.0 (1.0 to 5.0)|    3.0 (2.0 to 4.0)|    2.0 (1.0 to 5.0)|0.125 |\n|Age         |<40 years    |            68 (7.5)|             2 (7.4)|            70 (7.5)|1.000 |\n|            |40-59 years  |          334 (37.0)|           10 (37.0)|          344 (37.0)|      |\n|            |60+ years    |          500 (55.4)|           15 (55.6)|          515 (55.4)|      |\n|Sex         |Female       |          432 (47.9)|           13 (48.1)|          445 (47.9)|1.000 |\n|            |Male         |          470 (52.1)|           14 (51.9)|          484 (52.1)|      |\n|Obstruction |No           |          715 (81.2)|           17 (63.0)|          732 (80.6)|0.035 |\n|            |Yes          |          166 (18.8)|           10 (37.0)|          176 (19.4)|      |\n:::\n:::\n\n\n\n## 회귀 테이블\nregression 테이블을 만들 때, univariable과 multivariable 테이블을 함께 만들어주는 것이 좋았습니다.\n\n### Logistic regression\n\n앞선 요약 테이블과 마찬가지로, 설명변수와 종속변수를 각가 입력해주거나, formula 를 입력할 수 있습니다.\n\n::: {.cell}\n\n```{.r .cell-code}\nlr_tbl = colon_s |> \n  finalfit(explanatory = c(\"age.factor\", \"sex.factor\", \"obstruct.factor\", \"perfor.factor\"),\n           dependent = 'mort_5yr')\nknitr::kable(lr_tbl, \n             row.names=FALSE, \n             align=c(\"l\", \"l\", \"r\", \"r\", \"r\", \"r\"))\n```\n\n::: {.cell-output-display}\n|Dependent: Mortality 5 year |            |      Alive|       Died|          OR (univariable)|        OR (multivariable)|\n|:---------------------------|:-----------|----------:|----------:|-------------------------:|-------------------------:|\n|Age                         |<40 years   |  31 (46.3)|  36 (53.7)|                         -|                         -|\n|                            |40-59 years | 208 (61.4)| 131 (38.6)| 0.54 (0.32-0.92, p=0.023)| 0.57 (0.34-0.98, p=0.041)|\n|                            |60+ years   | 272 (53.4)| 237 (46.6)| 0.75 (0.45-1.25, p=0.270)| 0.81 (0.48-1.36, p=0.426)|\n|Sex                         |Female      | 243 (55.6)| 194 (44.4)|                         -|                         -|\n|                            |Male        | 268 (56.1)| 210 (43.9)| 0.98 (0.76-1.27, p=0.889)| 0.98 (0.75-1.28, p=0.902)|\n|Obstruction                 |No          | 408 (56.7)| 312 (43.3)|                         -|                         -|\n|                            |Yes         |  89 (51.1)|  85 (48.9)| 1.25 (0.90-1.74, p=0.189)| 1.25 (0.90-1.76, p=0.186)|\n|Perforation                 |No          | 497 (56.0)| 391 (44.0)|                         -|                         -|\n|                            |Yes         |  14 (51.9)|  13 (48.1)| 1.18 (0.54-2.55, p=0.672)| 1.12 (0.51-2.44, p=0.770)|\n:::\n:::\n\n일반적으로 다중(multivariable) 회귀분석은 단일(univariable) 회귀분석에서 유의한 변수(*P*<0.2)만 투입하기 마련이죠. `finalfit()`에서는 `explanatory_multi` 인자를 통해, multivariable regression에 포함시킬 변수를 선택할 수 있습니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlr_tbl2 = colon_s |> \n  finalfit(explanatory = c(\"age.factor\", \"sex.factor\", \"obstruct.factor\", \"perfor.factor\"),\n           explanatory_multi = c(\"age.factor\",\"obstruct.factor\"),\n           dependent = 'mort_5yr')\nknitr::kable(lr_tbl2, \n             row.names=FALSE, \n             align=c(\"l\", \"l\", \"r\", \"r\", \"r\", \"r\"))\n```\n\n::: {.cell-output-display}\n|Dependent: Mortality 5 year |            |      Alive|       Died|          OR (univariable)|        OR (multivariable)|\n|:---------------------------|:-----------|----------:|----------:|-------------------------:|-------------------------:|\n|Age                         |<40 years   |  31 (46.3)|  36 (53.7)|                         -|                         -|\n|                            |40-59 years | 208 (61.4)| 131 (38.6)| 0.54 (0.32-0.92, p=0.023)| 0.57 (0.34-0.98, p=0.041)|\n|                            |60+ years   | 272 (53.4)| 237 (46.6)| 0.75 (0.45-1.25, p=0.270)| 0.81 (0.48-1.36, p=0.424)|\n|Sex                         |Female      | 243 (55.6)| 194 (44.4)|                         -|                         -|\n|                            |Male        | 268 (56.1)| 210 (43.9)| 0.98 (0.76-1.27, p=0.889)|                         -|\n|Obstruction                 |No          | 408 (56.7)| 312 (43.3)|                         -|                         -|\n|                            |Yes         |  89 (51.1)|  85 (48.9)| 1.25 (0.90-1.74, p=0.189)| 1.26 (0.90-1.76, p=0.176)|\n|Perforation                 |No          | 497 (56.0)| 391 (44.0)|                         -|                         -|\n|                            |Yes         |  14 (51.9)|  13 (48.1)| 1.18 (0.54-2.55, p=0.672)|                         -|\n:::\n:::\n\n### Cox regression\n\nCox 회귀분석을 위해서는, dependent 인자에 `Surv()`를 이용한 값을 넣어주면 됩니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncox_tbl = colon_s |> \n  finalfit(explanatory = c(\"age.factor\", \"sex.factor\", \"obstruct.factor\", \"perfor.factor\"),\n           explanatory_multi = c(\"age.factor\",\"obstruct.factor\"),\n           dependent = \"Surv(time, status)\")\nknitr::kable(cox_tbl, \n             row.names=FALSE, \n             align=c(\"l\", \"l\", \"r\", \"r\", \"r\", \"r\"))\n```\n\n::: {.cell-output-display}\n|Dependent: Surv(time, status) |            |        all|          HR (univariable)|        HR (multivariable)|\n|:-----------------------------|:-----------|----------:|-------------------------:|-------------------------:|\n|Age                           |<40 years   |   70 (7.5)|                         -|                         -|\n|                              |40-59 years | 344 (37.0)| 0.76 (0.53-1.09, p=0.132)| 0.79 (0.55-1.14, p=0.203)|\n|                              |60+ years   | 515 (55.4)| 0.93 (0.66-1.31, p=0.668)| 0.99 (0.70-1.40, p=0.943)|\n|Sex                           |Female      | 445 (47.9)|                         -|                         -|\n|                              |Male        | 484 (52.1)| 1.01 (0.84-1.22, p=0.888)|                         -|\n|Obstruction                   |No          | 732 (80.6)|                         -|                         -|\n|                              |Yes         | 176 (19.4)| 1.29 (1.03-1.62, p=0.028)| 1.31 (1.04-1.64, p=0.022)|\n|Perforation                   |No          | 902 (97.1)|                         -|                         -|\n|                              |Yes         |   27 (2.9)| 1.17 (0.70-1.95, p=0.556)|                         -|\n:::\n:::\n\n# 그래프\n\nOR 그래프나 HR 그래프를 손쉽게 그릴 수 있습니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncolon_s |> \n  or_plot(dependent = \"status\",\n          explanatory = c(\"age.factor\",\"sex.factor\",\"obstruct.factor\",\"perfor.factor\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncolon_s |> \n  hr_plot(dependent = \"Surv(time, status)\",\n          explanatory = c(\"age.factor\",\"sex.factor\",\"obstruct.factor\",\"perfor.factor\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n개인적으로 `moonBook` 패키지의 `ORplot()`, `survminer` 패키지의 `ggforest()`보다 더 깔끔하게 표현되어 더 좋은 것 같습니다.\n\n\n레퍼런스\n[finalfit vignette](https://finalfit.org/articles/finalfit.html)\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}