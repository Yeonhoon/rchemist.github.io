{
  "hash": "dc747eca3d55ef9d0b8e06c5e9eb6ef4",
  "result": {
    "markdown": "---\ntitle: \"Sankey plot 그리기 (feat.Alluvial plot)\"\nauthor: \"JYH\"\ndescription: \"`alluvial`, `ggalluvial`을 통한 Sankey plot 그리기\"\ncategories: [R, Visualization, alluvial, sankey]\ndate: \"2023-04-18\"\nimage: \"https://r-charts.com/en/flow/ggalluvial_files/figure-html/alluvial-plot.png\"\n---\n\n\n# 인트로: 개념의 차이\n\nAlluvial plot과 Sankey plot은 데이터의 흐름을 시각화하는 데 사용되는 그래프 중 하나입니다.\n\n두 그래프는 겉으로 보기에는 비슷하면서도, 명확히 다른 점을 갖고 있습니다.\n우선 두 그래프의 예시부터 살펴보도록 하겠습니다.\n\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n![Fig1. Alluvial plot](http://www.datasmith.org/wp-content/uploads/2020/05/cran-alluvial-example.png){width=500}\n:::\n\n::: {.column width=\"50%\"}\n![Fig2. Sankey diagram](http://www.datasmith.org/wp-content/uploads/2020/05/d3-sankey-classic-example-1536x800.png){width=600}\n\n:::\n\n::::\n\n## 공통점\n\n겉으로 보기에는 두 그래프가 비슷합니다. 예를 들어\n\n- 두 그래프 모두 노드와 여러 범주로 이루어진 수직 막대가 존재합니다.\n- 노드 간에 두께와 높이가 각각 다른 곡선으로 연결되어 있습니다.\n\n이러한 점들 때문에 두 그래프를 혼동하고는 합니다.\n\n그러나 두 그래프 간에는 명확한 차이점이 존재합니다.\n\n## **Alluvial plot**\n\n먼저 Alluvial plot의 특징은 다음과 같습니다.\n\n- 특정 집단에 소속된 사람들이 다양한 범주차원에서 어떻게 구성되는지를 보여줍니다.\n- 범주를 나타내는 막대의 위치가 크게 상관없습니다.\n- 특정 사람들이 어떤 특징을 가지고 있는지 보여주는 데 적합합니다.\n\n## Sankey diagram\n\n반면 **Sankey diagram**은 다음과 같은 특징을 갖습니다.\n\n- 특정 데이터의 **양**이 어떻게 흐르는지, 어떻게 변화하는지를 보여줍니다.\n- 범주를 나타내는 막대의 배치에 따라 시간의 흐름을 나타냅니다.\n- 어떤 데이터의 양, 크기, 또는 사람들의 흐름이나 과정을 시각화하는 데 적합합니다.\n\n\n이렇게 두 그래프의 개념적인 차이에 대해 살펴보았습니다.\n\n우리가 다룰 패키지는 비록 alluvial이 들어가지만, **어떤 데이터를 어떻게 표현는지에 따라** Alluvial plot이 될 수도 있고, Sankey diagram이 될 수도 있다는 것을 말씀드리고 싶습니다.\n\n그럼 지금부터 Alluvial 또는 Sankey plot을 그리는 방법을 패키지를 통해 말씀드리겠습니다.\n\n# `alluvial` 패키지를 이용한 시각화\n\n\n::: {.cell}\n\n:::\n\n\n\n`alluvial` 패키지를 이용해 시각화를 진행해보겠습니다.\n해당 데이터는 제가 연구하던 패혈증 데이터입니다.\\\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(df)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"AKI_stage\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"AKI_initial\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"AKI_status_day1\"],\"name\":[3],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"AKI_status_day2\"],\"name\":[4],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"AKI_status_day3\"],\"name\":[5],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"AKI_status_day7\"],\"name\":[6],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"N\"],\"name\":[7],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Stage 3\",\"2\":\"1\",\"3\":\"1\",\"4\":\"2\",\"5\":\"2\",\"6\":\"3\",\"7\":\"1\",\"_rn_\":\"1\"},{\"1\":\"Stage 3\",\"2\":\"3\",\"3\":\"3\",\"4\":\"Dead\",\"5\":\"Dead\",\"6\":\"Dead\",\"7\":\"123\",\"_rn_\":\"2\"},{\"1\":\"Stage 3\",\"2\":\"3\",\"3\":\"3\",\"4\":\"2\",\"5\":\"2\",\"6\":\"1\",\"7\":\"2\",\"_rn_\":\"3\"},{\"1\":\"Stage 3\",\"2\":\"3\",\"3\":\"3\",\"4\":\"2\",\"5\":\"Alive\",\"6\":\"Alive\",\"7\":\"34\",\"_rn_\":\"4\"},{\"1\":\"Stage 3\",\"2\":\"1\",\"3\":\"1\",\"4\":\"2\",\"5\":\"Dead\",\"6\":\"Dead\",\"7\":\"2\",\"_rn_\":\"5\"},{\"1\":\"Stage 2\",\"2\":\"2\",\"3\":\"2\",\"4\":\"2\",\"5\":\"Alive\",\"6\":\"Alive\",\"7\":\"62\",\"_rn_\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\nICU에 입원한 환자들의 일자별 AKI stage 상태의 변화를 시각화하는 그래프입니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(alluvial)\nalluvial(TZ=df$AKI_initial, \n         `Day 1` = df$AKI_status_day1, \n         `Day 2` = df$AKI_status_day2, \n         `Day 3` = df$AKI_status_day3, \n         `Day 7` = df$AKI_status_day7,\n         freq=df$N,\n         col = ifelse(df$AKI_stage == 'Stage 1','#00AFBB',\n                             ifelse(df$AKI_stage == 'Stage 2','#E7B800',\"#FC4E07\")),\n         alpha=.8\n         )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n이 그래프는 일자별로 환자들의 상태가 어떻게 변화되는지를 나타내기 때문에, Sankey diagram으로 분류됩니다.\n\n`alluvial()`사용법은 굉장히 간단합니다.\n막대별로 들어갈 변수를 입력해준 뒤, 각 경우별 빈도를 뜻하는 column을 `freq`에 넣어주면 됩니다.\n\n색상은 `col`에서 설정 가능합니다.\n\n# `ggalluvial` 이용\n\nR에서 Sankey plot을 시각화할 수 있는 패키지 중 또 다른 하나는 `ggalluvial` 입니다. `gg`가 붙은 것에서 알 수 있듯이, `ggplot2` 의 확장 패키지 중 하나입니다.\n\n저 같은 경우, 시간의 흐름에 따른 범주의 양상을 Sankey plot으로 시각화한 경험이 있습니다. 예를 들면 첫 번째 건강검진부터 세 번째 건강검진 간 비만인 사람들의 분포를 시각화하는 것이죠.\n\n`ggalluvial`은 Sankey plot을 그리기 위해 wide 데이터와 long 데이터를 모두 사용할 수 있습니다.\n\n\n## Wide 데이터로 Sankey plot 그리기\n\nwide 데이터는 쉽게 말해 여러 가지 column이 옆으로 붙어있는 데이터를 의미합니다.\n\nSankey plot을 그리기 위한 wide 데이터에서는 하나의 열에 범주가 와야 하고, 범주의 조합에 해당하는 빈도(Frequency) 열이 와야 합니다.\n\n예를 들어 `HairEyeColor` 데이터를 살펴보겠습니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nHairEyeColor |> as.data.frame() \n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Hair\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Eye\"],\"name\":[2],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Sex\"],\"name\":[3],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Freq\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Black\",\"2\":\"Brown\",\"3\":\"Male\",\"4\":\"32\"},{\"1\":\"Brown\",\"2\":\"Brown\",\"3\":\"Male\",\"4\":\"53\"},{\"1\":\"Red\",\"2\":\"Brown\",\"3\":\"Male\",\"4\":\"10\"},{\"1\":\"Blond\",\"2\":\"Brown\",\"3\":\"Male\",\"4\":\"3\"},{\"1\":\"Black\",\"2\":\"Blue\",\"3\":\"Male\",\"4\":\"11\"},{\"1\":\"Brown\",\"2\":\"Blue\",\"3\":\"Male\",\"4\":\"50\"},{\"1\":\"Red\",\"2\":\"Blue\",\"3\":\"Male\",\"4\":\"10\"},{\"1\":\"Blond\",\"2\":\"Blue\",\"3\":\"Male\",\"4\":\"30\"},{\"1\":\"Black\",\"2\":\"Hazel\",\"3\":\"Male\",\"4\":\"10\"},{\"1\":\"Brown\",\"2\":\"Hazel\",\"3\":\"Male\",\"4\":\"25\"},{\"1\":\"Red\",\"2\":\"Hazel\",\"3\":\"Male\",\"4\":\"7\"},{\"1\":\"Blond\",\"2\":\"Hazel\",\"3\":\"Male\",\"4\":\"5\"},{\"1\":\"Black\",\"2\":\"Green\",\"3\":\"Male\",\"4\":\"3\"},{\"1\":\"Brown\",\"2\":\"Green\",\"3\":\"Male\",\"4\":\"15\"},{\"1\":\"Red\",\"2\":\"Green\",\"3\":\"Male\",\"4\":\"7\"},{\"1\":\"Blond\",\"2\":\"Green\",\"3\":\"Male\",\"4\":\"8\"},{\"1\":\"Black\",\"2\":\"Brown\",\"3\":\"Female\",\"4\":\"36\"},{\"1\":\"Brown\",\"2\":\"Brown\",\"3\":\"Female\",\"4\":\"66\"},{\"1\":\"Red\",\"2\":\"Brown\",\"3\":\"Female\",\"4\":\"16\"},{\"1\":\"Blond\",\"2\":\"Brown\",\"3\":\"Female\",\"4\":\"4\"},{\"1\":\"Black\",\"2\":\"Blue\",\"3\":\"Female\",\"4\":\"9\"},{\"1\":\"Brown\",\"2\":\"Blue\",\"3\":\"Female\",\"4\":\"34\"},{\"1\":\"Red\",\"2\":\"Blue\",\"3\":\"Female\",\"4\":\"7\"},{\"1\":\"Blond\",\"2\":\"Blue\",\"3\":\"Female\",\"4\":\"64\"},{\"1\":\"Black\",\"2\":\"Hazel\",\"3\":\"Female\",\"4\":\"5\"},{\"1\":\"Brown\",\"2\":\"Hazel\",\"3\":\"Female\",\"4\":\"29\"},{\"1\":\"Red\",\"2\":\"Hazel\",\"3\":\"Female\",\"4\":\"7\"},{\"1\":\"Blond\",\"2\":\"Hazel\",\"3\":\"Female\",\"4\":\"5\"},{\"1\":\"Black\",\"2\":\"Green\",\"3\":\"Female\",\"4\":\"2\"},{\"1\":\"Brown\",\"2\":\"Green\",\"3\":\"Female\",\"4\":\"14\"},{\"1\":\"Red\",\"2\":\"Green\",\"3\":\"Female\",\"4\":\"7\"},{\"1\":\"Blond\",\"2\":\"Green\",\"3\":\"Female\",\"4\":\"8\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n`HairEyeColor` 데이터는 성별, 머리 색상, 눈동자 색상에 따른 빈도 데이터를 담고 있습니다. 이 데이터를 활용해 Sankey plot을 작성해보도록 하겠습니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggalluvial)\nggplot(as.data.frame(HairEyeColor),\n       aes(y=Freq, axis1 = Hair, axis2 = Eye, axis3= Sex)) +\n  geom_alluvium(aes(fill=Eye),\n                width=1/8, knot.pos = 0, reverse = F) +\n  geom_stratum(alpha = .25, width=1/8, reverse=F) +\n  geom_text(stat = \"stratum\", aes(label = after_stat(stratum)), reverse=F) +\n  scale_fill_manual(values=c(Brown=\"brown\", Hazel=\"#E2AC76\", Green=\"darkgreen\", Blue=\"lightblue2\")) +\n  coord_flip() +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n`geom_alluvial()`은 Sankey plot에서 노드를 그려주고, `geom_stratum()`은 각 열의 범주를 나타내는 막대를 그려줍니다.\n\n성별 \\* 머리 색상 \\* 눈동자 색상에 따른 범주의 분포를 보여주는 그래프가 완성되었습니다.\n\n## Long 데이터로 Sankey plot 그리기\n\n이번에는 긴 데이터를 활용해 Sankey plot을 그려보겠습니다. 긴 데이터는 열들의 조합에 따른 범주를 나타내는 넓은 데이터와 달리, 하나의 행이 보통 하나의 경우를 의미합니다. 긴 데이터는 주로 공통된 ID, 그룹 별 값에 따른 데이터를 보여줍니다.\n\n예를 들어보겠습니다. `majors`라는 데이터를 보면 `student` 라고 하는 학생 ID가 1번부터 15번 까지 있습니다. 또한 `semester`는 1학기부터 15학기까지 있는데, 각 학생들의 학기별 `curriculum`에 대한 데이터를 보여주고 있습니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmajors$curriculum <- as.factor(majors$curriculum)\nggplot(majors,\n       aes(x=semester, stratum = curriculum, alluvium=student, fill=curriculum, label = curriculum)) +\n  geom_flow(stat = \"alluvium\", lode.guidance = lode_frontback,\n            color = \"darkgrey\") + \n  geom_stratum() +\n  scale_fill_brewer(type=\"qual\", palette = \"Set2\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n위의 그래프를 통해, 학생들이 학기별로 어떤 커리큘럼을 선택했는지 **흐름과 빈도**를 알 수 있습니다.\n\n물론 긴 데이터에 빈도가 있는 경우도 이를 활용할 수 있습니다. 마찬가지로 `ggalluvial` 패키지의 `vaccinations` 데이터를 이용하겠습니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvaccinations\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"survey\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"freq\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"subject\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"response\"],\"name\":[4],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"start_date\"],\"name\":[5],\"type\":[\"date\"],\"align\":[\"right\"]},{\"label\":[\"end_date\"],\"name\":[6],\"type\":[\"date\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"ms153_NSA\",\"2\":\"48\",\"3\":\"1\",\"4\":\"Always\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"9\",\"3\":\"2\",\"4\":\"Always\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"66\",\"3\":\"3\",\"4\":\"Always\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"1\",\"3\":\"4\",\"4\":\"Always\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"11\",\"3\":\"5\",\"4\":\"Always\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"1\",\"3\":\"6\",\"4\":\"Always\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"5\",\"3\":\"7\",\"4\":\"Always\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"4\",\"3\":\"8\",\"4\":\"Always\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"24\",\"3\":\"9\",\"4\":\"Missing\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"4\",\"3\":\"10\",\"4\":\"Missing\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"29\",\"3\":\"11\",\"4\":\"Missing\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"1\",\"3\":\"12\",\"4\":\"Missing\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"1\",\"3\":\"13\",\"4\":\"Missing\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"9\",\"3\":\"14\",\"4\":\"Missing\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"10\",\"3\":\"15\",\"4\":\"Missing\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"14\",\"3\":\"16\",\"4\":\"Missing\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"3\",\"3\":\"17\",\"4\":\"Never\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"7\",\"3\":\"18\",\"4\":\"Never\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"42\",\"3\":\"19\",\"4\":\"Never\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"20\",\"3\":\"20\",\"4\":\"Never\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"2\",\"3\":\"21\",\"4\":\"Never\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"36\",\"3\":\"22\",\"4\":\"Never\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"7\",\"3\":\"23\",\"4\":\"Never\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"2\",\"3\":\"24\",\"4\":\"Never\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"4\",\"3\":\"25\",\"4\":\"Never\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"9\",\"3\":\"26\",\"4\":\"Never\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"48\",\"3\":\"27\",\"4\":\"Sometimes\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"11\",\"3\":\"28\",\"4\":\"Sometimes\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"99\",\"3\":\"29\",\"4\":\"Sometimes\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"3\",\"3\":\"30\",\"4\":\"Sometimes\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"41\",\"3\":\"31\",\"4\":\"Sometimes\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"168\",\"3\":\"32\",\"4\":\"Sometimes\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"2\",\"3\":\"33\",\"4\":\"Sometimes\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"23\",\"3\":\"34\",\"4\":\"Sometimes\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"22\",\"3\":\"35\",\"4\":\"Sometimes\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"38\",\"3\":\"36\",\"4\":\"Sometimes\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"1\",\"3\":\"37\",\"4\":\"Sometimes\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"15\",\"3\":\"38\",\"4\":\"Sometimes\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms153_NSA\",\"2\":\"113\",\"3\":\"39\",\"4\":\"Sometimes\",\"5\":\"2010-09-22\",\"6\":\"2010-10-25\"},{\"1\":\"ms432_NSA\",\"2\":\"48\",\"3\":\"1\",\"4\":\"Always\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"9\",\"3\":\"2\",\"4\":\"Always\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"66\",\"3\":\"3\",\"4\":\"Missing\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"1\",\"3\":\"4\",\"4\":\"Missing\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"11\",\"3\":\"5\",\"4\":\"Missing\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"1\",\"3\":\"6\",\"4\":\"Never\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"5\",\"3\":\"7\",\"4\":\"Sometimes\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"4\",\"3\":\"8\",\"4\":\"Sometimes\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"24\",\"3\":\"9\",\"4\":\"Always\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"4\",\"3\":\"10\",\"4\":\"Always\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"29\",\"3\":\"11\",\"4\":\"Missing\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"1\",\"3\":\"12\",\"4\":\"Missing\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"1\",\"3\":\"13\",\"4\":\"Missing\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"9\",\"3\":\"14\",\"4\":\"Missing\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"10\",\"3\":\"15\",\"4\":\"Sometimes\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"14\",\"3\":\"16\",\"4\":\"Sometimes\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"3\",\"3\":\"17\",\"4\":\"Always\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"7\",\"3\":\"18\",\"4\":\"Missing\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"42\",\"3\":\"19\",\"4\":\"Missing\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"20\",\"3\":\"20\",\"4\":\"Missing\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"2\",\"3\":\"21\",\"4\":\"Never\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"36\",\"3\":\"22\",\"4\":\"Never\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"7\",\"3\":\"23\",\"4\":\"Never\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"2\",\"3\":\"24\",\"4\":\"Sometimes\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"4\",\"3\":\"25\",\"4\":\"Sometimes\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"9\",\"3\":\"26\",\"4\":\"Sometimes\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"48\",\"3\":\"27\",\"4\":\"Always\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"11\",\"3\":\"28\",\"4\":\"Always\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"99\",\"3\":\"29\",\"4\":\"Missing\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"3\",\"3\":\"30\",\"4\":\"Missing\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"41\",\"3\":\"31\",\"4\":\"Missing\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"168\",\"3\":\"32\",\"4\":\"Missing\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"2\",\"3\":\"33\",\"4\":\"Never\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"23\",\"3\":\"34\",\"4\":\"Never\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"22\",\"3\":\"35\",\"4\":\"Never\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"38\",\"3\":\"36\",\"4\":\"Sometimes\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"1\",\"3\":\"37\",\"4\":\"Sometimes\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"15\",\"3\":\"38\",\"4\":\"Sometimes\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms432_NSA\",\"2\":\"113\",\"3\":\"39\",\"4\":\"Sometimes\",\"5\":\"2015-06-04\",\"6\":\"2015-10-05\"},{\"1\":\"ms460_NSA\",\"2\":\"48\",\"3\":\"1\",\"4\":\"Always\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"9\",\"3\":\"2\",\"4\":\"Sometimes\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"66\",\"3\":\"3\",\"4\":\"Always\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"1\",\"3\":\"4\",\"4\":\"Never\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"11\",\"3\":\"5\",\"4\":\"Sometimes\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"1\",\"3\":\"6\",\"4\":\"Always\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"5\",\"3\":\"7\",\"4\":\"Always\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"4\",\"3\":\"8\",\"4\":\"Sometimes\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"24\",\"3\":\"9\",\"4\":\"Always\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"4\",\"3\":\"10\",\"4\":\"Sometimes\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"29\",\"3\":\"11\",\"4\":\"Always\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"1\",\"3\":\"12\",\"4\":\"Missing\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"1\",\"3\":\"13\",\"4\":\"Never\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"9\",\"3\":\"14\",\"4\":\"Sometimes\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"10\",\"3\":\"15\",\"4\":\"Always\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"14\",\"3\":\"16\",\"4\":\"Sometimes\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"3\",\"3\":\"17\",\"4\":\"Always\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"7\",\"3\":\"18\",\"4\":\"Always\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"42\",\"3\":\"19\",\"4\":\"Never\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"20\",\"3\":\"20\",\"4\":\"Sometimes\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"2\",\"3\":\"21\",\"4\":\"Missing\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"36\",\"3\":\"22\",\"4\":\"Never\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"7\",\"3\":\"23\",\"4\":\"Sometimes\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"2\",\"3\":\"24\",\"4\":\"Always\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"4\",\"3\":\"25\",\"4\":\"Never\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"9\",\"3\":\"26\",\"4\":\"Sometimes\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"48\",\"3\":\"27\",\"4\":\"Always\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"11\",\"3\":\"28\",\"4\":\"Sometimes\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"99\",\"3\":\"29\",\"4\":\"Always\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"3\",\"3\":\"30\",\"4\":\"Missing\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"41\",\"3\":\"31\",\"4\":\"Never\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"168\",\"3\":\"32\",\"4\":\"Sometimes\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"2\",\"3\":\"33\",\"4\":\"Always\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"23\",\"3\":\"34\",\"4\":\"Never\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"22\",\"3\":\"35\",\"4\":\"Sometimes\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"38\",\"3\":\"36\",\"4\":\"Always\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"1\",\"3\":\"37\",\"4\":\"Missing\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"15\",\"3\":\"38\",\"4\":\"Never\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"},{\"1\":\"ms460_NSA\",\"2\":\"113\",\"3\":\"39\",\"4\":\"Sometimes\",\"5\":\"2016-09-27\",\"6\":\"2016-10-25\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n`vaccinations` 데이터는 RAND American Life Panel 설문 조사 중 세 건을 합친 데이터입니다. 인플루엔자 예방을 위해 백신 접종을 할 의향을 묻고 있는 데이터입니다. Never, Sometimes, Always 등의 응답이 기록되어 있습니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 그래프에서 나타나는 범주 순서 변경 위해 \nvaccinations$response <- factor(vaccinations$response, levels = rev(levels(vaccinations$response)))\n\nggplot(vaccinations,\n       aes(x=survey, y=freq,\n           stratum = response, \n           alluvium = subject,\n           fill = response,\n           label = response)) +\n  geom_flow() +\n  geom_stratum(alpha=.5) +\n  geom_text(stat = \"stratum\", size=3) +\n  scale_x_discrete(expand = c(0.1,0.1)) +\n  theme_void() +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n위의 그래프에서 `freq`는 `survey`와 `response`별로 합해져 그래프에 나타나는 것을 알 수 있습니다.\n\n## 참고자료\n- [Alluvial plots vs Sankey diagrams](http://www.datasmith.org/2020/05/02/alluvial-plots-vs-sankey-diagrams/)\n- [alluvial github](https://github.com/mbojan/alluvial)\n- [ggalluvial vignetts](https://cran.r-project.org/web/packages/ggalluvial/vignettes/ggalluvial.html)\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}