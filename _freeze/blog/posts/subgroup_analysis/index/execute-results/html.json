{
  "hash": "71192a708303f6e674d831e692388909",
  "result": {
    "markdown": "---\ntitle: \"Subgroup analysis (feat. forester)\"\ndescription: \"R을 활용한 하위그룹 분석\"\nauthor: \"JYH\"\ncategories: [R, Subgroup analysis, Publish, forester]\ndate: \"2023-04-22\"\n---\n\n\n\n\n## 인트로\n\nSubgroup analysis이란 치료군-대조군 연구에서 특정 약물의 사용에 따른 임상적 결과 (질병의 발생, 사망 등)를 비교하고자 할 때, 그 효과가 과연 하위집단(e.g. 성별, 수술 여부) 간에는 어떻게 나타나는지, 그리고 그 하위그룹 변수와 약물 사용 변수 간의 상호작용이 있는지 분석하는 방법입니다.\n\n이번 포스트에서는 R에서 하위집단 분석을 수행하는 방법에 대해 살펴보겠습니다.\n\n## 준비\n\nSubgroup analysis를 수행하기 위해 필요한 패키지는 `Publish` 입니다. Subgroup anlysis 예제는 Publish 패키지에 내장된 `traceR` 데이터를 사용하도록 하겠습니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(Publish)\nrequire(survival)\nrequire(data.table)\ndata(traceR)\n```\n:::\n\n\ntraceR 의 변수는 다음과 같습니다.\n\n-   `weight`: 체중(kg)\n-   `height`: 키(m)\n-   `abdominalCircumference`: 복부둘레(cm)\n-   `seCreatinine`: 세럼 크레아티닌 (mmol/L)\n-   `wallMotionIndex`: 좌심실 기능 (0: 최악, 2: 정상)\n-   `observationTime`: 관찰기간\n-   `age`: 나이(연)\n-   `sex`: 성별(0: 여성, 1: 남성)\n-   `smoking`: 흡연 (0: 핀 적 없음, 1: 과거, 2: 현재)\n-   `dead`: 사망(0: 생존, 1: 사망)\n-   `treatment`: 위약 또는 치료제(trandolapril: 고혈압 치료제)\n\n## 회귀식 만들기\n\n우선 콕스 회귀식을 하나 만들어주겠습니다.\n\n과연 치료제가 사망을 줄일 수 있는지 확인해보도록 하겠습니다. 관찰시간 변수는 `observationTime`, 결과변수는 `dead`, 그리고 중재(intervention) 변수는 `treatment` 입니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit <- coxph(Surv(observationTime, dead==1) ~ treatment, data=traceR)\n\npublish(fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Variable        Units HazardRatio       CI.95  p-value \n treatment      placebo         Ref                      \n           trandolapril        0.89 [0.79;0.99]   0.0313 \n```\n:::\n:::\n\n\n결과를 봤을 때, 치료제를 사용한 집단의 Hazard ratio (HR)가 0.887 (95% CI 0.795-0.989) 로 나타났습니다. 즉, 치료제를 투여받은 집단이 그렇지 않은 집단에 비해 사망위험이 감소하는 경향이 있다고 해석할 수 있습니다.\n\n## Subgroup analysis\n\n위의 결과에서 치료제가 사망률을 낮추는 효과가 있는 것으로 나타났죠. 이제 하위 집단을 대상으로, 과연 이 치료제가 하위 집단별로 상호작용을 하는지, 즉 하위집단별로 치료제의 효과가 다르게 나타나는지 확인해보겠습니다.\n\nSubgroup analysis를 위한 함수는 `sugroupAnalysis()`입니다. 이 함수는 로지스틱 회귀분석 또는 콕스 회귀분석처럼 결과가 0과 1로 나뉘는 변수를 대상으로 수행할 수 있습니다.\n\ntraceR의 데이터를 바탕으로 하위 집단들을 생성해주겠습니다. 일반적으로 하위집단은 두 개의 범주를 갖습니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsetDT(traceR) # data.table로 변경\n\ntraceR[,`:=`(\n  age_2 = fifelse(age < 68, \"under68\",\"over68\") |> as.factor(),\n  wmi_2 = fifelse(wallMotionIndex < 0.9, \"bad\", \"good\") |> as.factor(),\n  abd_2 = fifelse(abdominalCircumference >= 95, \"fat\", \"slim\") |> as.factor(),\n  sex = factor(sex, labels=c(\"female\",\"male\"))\n)]\n```\n:::\n\n\ntraceR에 있는 데이터를 바탕으로 하위집단 세 가지를 추가했습니다.\n\n-   `age_2`: 나이의 평균인 68세보다 낮은 경우와 그렇지 않은 경우\n-   `wmi_2`: `wallMotionIndex`가 0.9 미만인 경우 bad, 그렇지 않으면 good\n-   `abd_2`: 복부 둘레가 95cm 이상이면 fat, 그렇지 않으면 slim\n\n여기에 `sex` 까지 더해 총 4개의 하위집단을 사용하겠습니다. 이 때 주의해야 할 것은 모든 하위집단은 반드시 **`factor`로 되어있어야** 한다는 것입니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsubgroups <- c(\"sex\", \"age_2\", \"wmi_2\", \"abd_2\")\n\nsub_fit <- subgroupAnalysis(fit, \n                      data = traceR,\n                      treatment = \"treatment\",\n                      subgroups = subgroups)\nsub_fit_tbl <- copy(sub_fit) |> as.data.table()\n```\n:::\n\n\nsubgroup analysis 결과가 나왔습니다. 이제 이 표를 `gt()`를 이용해 보기 좋게끔 변경해주도록 하겠습니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsub_fit_tbl[,`:=`(\n  hr_ci = paste0(format(round(HazardRatio,2),nsmall=2), \n                                ' (', format(round(Lower,2),nsmall=2), '-', \n                                format(round(Upper,2),nsmall=2),\n                                ')'),\n         control = paste0(event_placebo,'/',sample_placebo),\n         case = paste0(event_trandolapril,'/',sample_trandolapril))]\n\nsub_fit_tbl[,.(subgroups, level, case, control, hr_ci, pinteraction)] |> \n  group_by(subgroups) |> \n  gt()  |> \n  cols_label(\n    level = md(\"**Subgroup**\"),\n    case = md(\"**Case**\"),\n    control = md(\"**Control**\"),\n    hr_ci = md(\"**HR (95% CI)**\"),\n    pinteraction = md(\"***P* for interaction**\")\n  ) |> \n  fmt_number(\n    column = pinteraction,\n    decimal = 4\n  ) |> \n  cols_align(\n    align=\"center\",\n    columns = -level\n  ) |> \n  cols_align(\n    align = \"left\",\n    columns = level\n  ) |> \n  tab_style(\n    style = list(cell_text(weight=\"bold\")),\n    locations = cells_row_groups()\n  ) \n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"dmqcwjgfkn\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#dmqcwjgfkn table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#dmqcwjgfkn thead, #dmqcwjgfkn tbody, #dmqcwjgfkn tfoot, #dmqcwjgfkn tr, #dmqcwjgfkn td, #dmqcwjgfkn th {\n  border-style: none;\n}\n\n#dmqcwjgfkn p {\n  margin: 0;\n  padding: 0;\n}\n\n#dmqcwjgfkn .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#dmqcwjgfkn .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#dmqcwjgfkn .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#dmqcwjgfkn .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#dmqcwjgfkn .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#dmqcwjgfkn .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#dmqcwjgfkn .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#dmqcwjgfkn .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#dmqcwjgfkn .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#dmqcwjgfkn .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#dmqcwjgfkn .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#dmqcwjgfkn .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#dmqcwjgfkn .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#dmqcwjgfkn .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#dmqcwjgfkn .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#dmqcwjgfkn .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#dmqcwjgfkn .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#dmqcwjgfkn .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#dmqcwjgfkn .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dmqcwjgfkn .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#dmqcwjgfkn .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#dmqcwjgfkn .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#dmqcwjgfkn .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dmqcwjgfkn .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#dmqcwjgfkn .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#dmqcwjgfkn .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#dmqcwjgfkn .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dmqcwjgfkn .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#dmqcwjgfkn .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#dmqcwjgfkn .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#dmqcwjgfkn .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#dmqcwjgfkn .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#dmqcwjgfkn .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dmqcwjgfkn .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#dmqcwjgfkn .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dmqcwjgfkn .gt_left {\n  text-align: left;\n}\n\n#dmqcwjgfkn .gt_center {\n  text-align: center;\n}\n\n#dmqcwjgfkn .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#dmqcwjgfkn .gt_font_normal {\n  font-weight: normal;\n}\n\n#dmqcwjgfkn .gt_font_bold {\n  font-weight: bold;\n}\n\n#dmqcwjgfkn .gt_font_italic {\n  font-style: italic;\n}\n\n#dmqcwjgfkn .gt_super {\n  font-size: 65%;\n}\n\n#dmqcwjgfkn .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#dmqcwjgfkn .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#dmqcwjgfkn .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#dmqcwjgfkn .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#dmqcwjgfkn .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#dmqcwjgfkn .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#dmqcwjgfkn .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;Subgroup&lt;/strong&gt;\"><strong>Subgroup</strong></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;Case&lt;/strong&gt;\"><strong>Case</strong></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;Control&lt;/strong&gt;\"><strong>Control</strong></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;HR (95% CI)&lt;/strong&gt;\"><strong>HR (95% CI)</strong></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;&lt;em&gt;P&lt;/em&gt; for interaction&lt;/strong&gt;\"><strong><em>P</em> for interaction</strong></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"5\" class=\"gt_group_heading\" style=\"font-weight: bold;\" scope=\"colgroup\" id=\"sex\">sex</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"sex  level\" class=\"gt_row gt_left\">female</td>\n<td headers=\"sex  case\" class=\"gt_row gt_center\">183/249</td>\n<td headers=\"sex  control\" class=\"gt_row gt_center\">199/252</td>\n<td headers=\"sex  hr_ci\" class=\"gt_row gt_center\">0.83 (0.67-1.01)</td>\n<td headers=\"sex  pinteraction\" class=\"gt_row gt_center\">0.4077</td></tr>\n    <tr><td headers=\"sex  level\" class=\"gt_row gt_left\">male</td>\n<td headers=\"sex  case\" class=\"gt_row gt_center\">448/627</td>\n<td headers=\"sex  control\" class=\"gt_row gt_center\">453/621</td>\n<td headers=\"sex  hr_ci\" class=\"gt_row gt_center\">0.91 (0.80-1.04)</td>\n<td headers=\"sex  pinteraction\" class=\"gt_row gt_center\">0.4077</td></tr>\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"5\" class=\"gt_group_heading\" style=\"font-weight: bold;\" scope=\"colgroup\" id=\"age_2\">age_2</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"age_2  level\" class=\"gt_row gt_left\">over68</td>\n<td headers=\"age_2  case\" class=\"gt_row gt_center\">422/493</td>\n<td headers=\"age_2  control\" class=\"gt_row gt_center\">427/476</td>\n<td headers=\"age_2  hr_ci\" class=\"gt_row gt_center\">0.87 (0.76-0.99)</td>\n<td headers=\"age_2  pinteraction\" class=\"gt_row gt_center\">0.9324</td></tr>\n    <tr><td headers=\"age_2  level\" class=\"gt_row gt_left\">under68</td>\n<td headers=\"age_2  case\" class=\"gt_row gt_center\">209/383</td>\n<td headers=\"age_2  control\" class=\"gt_row gt_center\">225/397</td>\n<td headers=\"age_2  hr_ci\" class=\"gt_row gt_center\">0.88 (0.73-1.06)</td>\n<td headers=\"age_2  pinteraction\" class=\"gt_row gt_center\">0.9324</td></tr>\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"5\" class=\"gt_group_heading\" style=\"font-weight: bold;\" scope=\"colgroup\" id=\"wmi_2\">wmi_2</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"wmi_2  level\" class=\"gt_row gt_left\">bad</td>\n<td headers=\"wmi_2  case\" class=\"gt_row gt_center\">133/146</td>\n<td headers=\"wmi_2  control\" class=\"gt_row gt_center\">148/161</td>\n<td headers=\"wmi_2  hr_ci\" class=\"gt_row gt_center\">0.87 (0.69-1.10)</td>\n<td headers=\"wmi_2  pinteraction\" class=\"gt_row gt_center\">0.8484</td></tr>\n    <tr><td headers=\"wmi_2  level\" class=\"gt_row gt_left\">good</td>\n<td headers=\"wmi_2  case\" class=\"gt_row gt_center\">498/730</td>\n<td headers=\"wmi_2  control\" class=\"gt_row gt_center\">504/712</td>\n<td headers=\"wmi_2  hr_ci\" class=\"gt_row gt_center\">0.90 (0.79-1.02)</td>\n<td headers=\"wmi_2  pinteraction\" class=\"gt_row gt_center\">0.8484</td></tr>\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"5\" class=\"gt_group_heading\" style=\"font-weight: bold;\" scope=\"colgroup\" id=\"abd_2\">abd_2</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"abd_2  level\" class=\"gt_row gt_left\">fat</td>\n<td headers=\"abd_2  case\" class=\"gt_row gt_center\">319/435</td>\n<td headers=\"abd_2  control\" class=\"gt_row gt_center\">296/403</td>\n<td headers=\"abd_2  hr_ci\" class=\"gt_row gt_center\">0.93 (0.79-1.09)</td>\n<td headers=\"abd_2  pinteraction\" class=\"gt_row gt_center\">0.3287</td></tr>\n    <tr><td headers=\"abd_2  level\" class=\"gt_row gt_left\">slim</td>\n<td headers=\"abd_2  case\" class=\"gt_row gt_center\">274/389</td>\n<td headers=\"abd_2  control\" class=\"gt_row gt_center\">324/427</td>\n<td headers=\"abd_2  hr_ci\" class=\"gt_row gt_center\">0.83 (0.71-0.98)</td>\n<td headers=\"abd_2  pinteraction\" class=\"gt_row gt_center\">0.3287</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\n위의 표에서 Case와 Control은 각각 치료군과 대조군의 인원 중 사망한 사람들의 수를 나타냅니다. 또한 위험비가 95% 신뢰구간과 함께 나타나있고, 상호작용의 유의성을 알려주는 p for interaction이 있습니다.\\\n\n결과를 정리해보면 다음과 같습니다.\\\n하위집단들의 **상호작용이 유의하지 않은 것**으로 나타났습니다. 왜냐하면 상호작용 p-value를 의미하는 Pinteraction이 하위집단 모두에서 0.5 이상으로 나타났기 때문입니다. 즉, 남녀 할 것 없이, 68세 미만이든 이상이든, 좌심실 기능이 좋든 나쁘든, 뚱뚱하든 날씬하든 모두 치료제가 사망률을 낮춰주었다고 해석할 수 있습니다.\n\n## 시각화\n\nSubgroup analysis는 표 뿐만 아니라 그래프를 통해 결과를 보여줄 수 있습니다.\n\n<p style=\"text-align: center\">\n\n<img src=\"https://www.researchgate.net/profile/Shweta-Bansal-3/publication/305467160/figure/fig3/AS:613915083948038@1523380170283/Forest-Plot-of-Primary-Outcome-According-to-Subgroups-The-dashed-vertical-line.png\" width=\"80%;&quot;\"/>\n\n</p>\n\n위와 같은 그림을 **forest plot**이라고 부릅니다. forest plot은 메타 분석 (meta analysis)에서 많이 활용되는 그래프이지만, subgroup analysis에서도 자주 활용되는 그래프입니다. `Publish`에서 제공되는 함수를 통해 forest plot을 그릴 수 있습니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplotConfidence(x=sub_fit[,c(\"HazardRatio\",\"Lower\",\"Upper\")],\n              label = sub_fit[,c(\"subgroups\",\"level\")],\n              xlab = \"Hazard ratio\",\n              points.cex = 2,\n              points.col=\"darkblue\",\n              # arrows.col=\"darkblue\",\n              points.pch=15,\n              cex=1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n자 그런데 어디가 좀 부족해보입니다. `p-value`는 나오지도 않고 하니... 뭔가 아쉽죠.\n\nR에는 subgroup analysis 의 forest plot을 그리기 위한 패키지들이 몇 가지 존재합니다. 저는 그 중에서 `forester` 패키지를 사용하여 forest plot을 그려보도록 하겠습니다. 참고로 이 패키지는 CRAN에 없기 때문에, github를 통해 다운로드받아야 합니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndevtools::install_github(\"rdboyes/forester\")\nlibrary(forester)\n```\n:::\n\n\n이제 `forester()` 를 이용해 forest plot을 그려보겠습니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsub_fit_tbl\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"subgroups\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"level\"],\"name\":[2],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"sample_placebo\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"sample_trandolapril\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"event_placebo\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"event_trandolapril\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"time_placebo\"],\"name\":[7],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"time_trandolapril\"],\"name\":[8],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"Units\"],\"name\":[9],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"HazardRatio\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Lower\"],\"name\":[11],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Upper\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Pvalue\"],\"name\":[13],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"pinteraction\"],\"name\":[14],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Missing\"],\"name\":[15],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"hr_ci\"],\"name\":[16],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"control\"],\"name\":[17],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"case\"],\"name\":[18],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"sex\",\"2\":\"female\",\"3\":\"252\",\"4\":\"249\",\"5\":\"199\",\"6\":\"183\",\"7\":\"439904\",\"8\":\"500893\",\"9\":\"\",\"10\":\"0.8250790\",\"11\":\"0.6749718\",\"12\":\"1.0085685\",\"13\":\"0.06056075\",\"14\":\"0.4076925\",\"15\":\"NA\",\"16\":\"0.83 (0.67-1.01)\",\"17\":\"199/252\",\"18\":\"183/249\"},{\"1\":\"sex\",\"2\":\"male\",\"3\":\"621\",\"4\":\"627\",\"5\":\"453\",\"6\":\"448\",\"7\":\"1248682\",\"8\":\"1374232\",\"9\":\"\",\"10\":\"0.9129140\",\"11\":\"0.8011296\",\"12\":\"1.0402961\",\"13\":\"0.17156947\",\"14\":\"0.4076925\",\"15\":\"NA\",\"16\":\"0.91 (0.80-1.04)\",\"17\":\"453/621\",\"18\":\"448/627\"},{\"1\":\"age_2\",\"2\":\"over68\",\"3\":\"476\",\"4\":\"493\",\"5\":\"427\",\"6\":\"422\",\"7\":\"693134\",\"8\":\"808488\",\"9\":\"\",\"10\":\"0.8675195\",\"11\":\"0.7582654\",\"12\":\"0.9925154\",\"13\":\"0.03851259\",\"14\":\"0.9324230\",\"15\":\"NA\",\"16\":\"0.87 (0.76-0.99)\",\"17\":\"427/476\",\"18\":\"422/493\"},{\"1\":\"age_2\",\"2\":\"under68\",\"3\":\"397\",\"4\":\"383\",\"5\":\"225\",\"6\":\"209\",\"7\":\"995452\",\"8\":\"1066637\",\"9\":\"\",\"10\":\"0.8762499\",\"11\":\"0.7258537\",\"12\":\"1.0578080\",\"13\":\"0.16912708\",\"14\":\"0.9324230\",\"15\":\"NA\",\"16\":\"0.88 (0.73-1.06)\",\"17\":\"225/397\",\"18\":\"209/383\"},{\"1\":\"wmi_2\",\"2\":\"bad\",\"3\":\"161\",\"4\":\"146\",\"5\":\"148\",\"6\":\"133\",\"7\":\"183764\",\"8\":\"199044\",\"9\":\"\",\"10\":\"0.8740633\",\"11\":\"0.6914933\",\"12\":\"1.1048360\",\"13\":\"0.26017473\",\"14\":\"0.8483905\",\"15\":\"NA\",\"16\":\"0.87 (0.69-1.10)\",\"17\":\"148/161\",\"18\":\"133/146\"},{\"1\":\"wmi_2\",\"2\":\"good\",\"3\":\"712\",\"4\":\"730\",\"5\":\"504\",\"6\":\"498\",\"7\":\"1504822\",\"8\":\"1676081\",\"9\":\"\",\"10\":\"0.8969453\",\"11\":\"0.7924589\",\"12\":\"1.0152083\",\"13\":\"0.08523111\",\"14\":\"0.8483905\",\"15\":\"NA\",\"16\":\"0.90 (0.79-1.02)\",\"17\":\"504/712\",\"18\":\"498/730\"},{\"1\":\"abd_2\",\"2\":\"fat\",\"3\":\"403\",\"4\":\"435\",\"5\":\"296\",\"6\":\"319\",\"7\":\"791326\",\"8\":\"932423\",\"9\":\"\",\"10\":\"0.9301404\",\"11\":\"0.7940398\",\"12\":\"1.0895688\",\"13\":\"0.36960724\",\"14\":\"0.3287261\",\"15\":\"95\",\"16\":\"0.93 (0.79-1.09)\",\"17\":\"296/403\",\"18\":\"319/435\"},{\"1\":\"abd_2\",\"2\":\"slim\",\"3\":\"427\",\"4\":\"389\",\"5\":\"324\",\"6\":\"274\",\"7\":\"813727\",\"8\":\"842340\",\"9\":\"\",\"10\":\"0.8312816\",\"11\":\"0.7077444\",\"12\":\"0.9763822\",\"13\":\"0.02437690\",\"14\":\"0.3287261\",\"15\":\"95\",\"16\":\"0.83 (0.71-0.98)\",\"17\":\"324/427\",\"18\":\"274/389\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nforester(left_side_data = sub_fit_tbl[,c(\"subgroups\",\"level\", \"case\",\"control\")],\n         estimate = as.numeric(sub_fit_tbl[['HazardRatio']]),\n         ci_low = as.numeric(sub_fit_tbl$Lower),\n         ci_high= as.numeric(sub_fit_tbl$Upper),\n         estimate_col_name = \"HR (95% CI)\",\n         estimate_precision =2,\n         xlim=c(0.6,1.1),\n         null_line_at = 1,\n         arrows = T,\n         arrow_labels=c('Mortality ↓ ', 'Mortality ↑')\n         )\n```\n:::\n\n\n<p style=\"text-align:center;\">\n\n<img src=\"forest_plot1.png\" width=\"75%\"/>\n\n</p>\n\n`forester()`는 Hazard ratio 그래프를 기준으로 왼쪽과 오른쪽에 숫자들이 들어갈 수 있습니다.\n\n-   `left_side_data`: 그래프 왼쪽에 들어갈 수치들\n-   `right_side_data`: 그래프 오른쪽에 들어갈 수치들\n-   `estimate`: HR 또는 OR\n-   `ci_lower`: 하위 신뢰구간\n-   `ci_upper`: 상위 신뢰구간\n-   `xlim`: 그래프의 x축 범위\n-   `null_line_at`: 신뢰구간 기준(1) 점선으로 표시\n-   `arrows`: 그래프의 x축 아래에 텍스트 표시 여부\n-   `arrow_labels`: 그래프의 x축 아래에 표시할 텍스트\n\n원래는 estimate, ci_lower, ci_upper를 입력하면 자동으로 그래프 오른쪽에 `HR (ci_lower to ci_upper)` 형태의 열이 생성됩니다, 만약, `right_side_data` 값을 입력하는 경우, 그 열이 오른쪽에 들어가게 됩니다. 물론 `right_side_data에` 값을 준다고 해도 반드시 `estimate`, `ci_lower`, `ci_upper` 값은 입력해야합니다.\\\n또한 신뢰구간이 `xlim`에서 설정한 값을 넘어갈 경우 그래프는 화살표로 표시됩니다.\n\n더 자세한 사항은 `?forester` 를 참고하시기 바랍니다.\n\n위의 그래프를 좀더 예쁘게 그리기 위해 하위집단 분석결과 데이터를 바탕으로 직접 데이터프레임을 만들어 그래프를 그리면 더 아름다운 `forest plot`이 그려보겠습니다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- data.table(\n  Subgroups = c(\"Sex\", \"  Female\", \"  Male\", \"Age\", \"  <68\", \"  ≥68\", \"WMI\", \"  Bad\",\"  Good\", \"Abdominal\",\"  Fat\", \"  Slim\"),\n  Case = c(NA, \"183/249\", \"448/627\", NA, \"422/493\", \"209/383\", NA, \"133/146\", \"498/730\", NA, \"319/435\", \"274/389\"),\n  Control = c(NA, \"199/252\",\"453/621\", NA, \"427/476\", \"225/397\", NA, \"148/161\t\", \"504/712\", NA, \"296/403\", \"324/427\"),\n  HR = c(NA, 0.825, 0.913, NA, 0.868, 0.876, NA, 0.874, 0.897, NA, 0.930, 0.831),\n  ci_low = c(NA, 0.675, 0.801, NA, 0.758, 0.726, NA, 0.691, 0.792, NA, 0.794, 0.708),\n  ci_high = c(NA, 1.009, 1.040, NA, 0.993, 1.058, NA, 1.105, 1.015, NA, 1.090, 0.976),\n  `P for interaction` = c(0.4077, NA, NA, 0.9324, NA, NA, 0.8484, NA, NA, 0.3287, NA, NA)\n)\ndf[!is.na(HR),`   HR (95% CI)` := paste0(format(HR,2), ' (',format(ci_low,2),'—',format(ci_high,2),\")\")]   \nforester(\n  left_side_data = df[,c(\"Subgroups\",\"Case\",\"Control\")],\n  right_side_data = df[,c(\"   HR (95% CI)\",\"P for interaction\")],\n  estimate = df$HR,\n  ci_low = as.numeric(df$ci_low),\n  ci_high= as.numeric(df$ci_high),\n  estimate_precision =2,\n  xlim=c(0.6,1.1),\n  null_line_at = 1,\n  nudge_x = 1,\n  arrows = T,\n  arrow_labels=c('Mortality ↓ ', 'Mortality ↑'),\n  justify=c(0, 0.5,0.5, 0.5, 0.5)\n)\n```\n:::\n\n\n<p style=\"text-align:center;\">\n\n<img src=\"forest_plot_2.png\" width=\"75%\"/>\n\n</p>\n\nforest plot을 그리기 위한 데이터 프레임을 직접 만드는 건 굉장히 번거로운 일이지만, 그만큼 훌륭한 그래프가 그려지기 때문에 나쁘지 않은 것 같습니다. ☺️\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}