{
  "hash": "14b34b6a985291e2628f8ad59e29823b",
  "result": {
    "markdown": "---\ntitle: \"머신러닝 모델별 퍼포먼스 그래프\"\ndate: \"2023-03-03\"\ncategories: [Machine learning, ggplot2]\nimage: \"images/performace_male.png\"\n---\n\n\n아래와 같이 모델별로 머신러닝 성능을 정리한 표가 있다고 해보자.\n\n![](images/image-1092017324.png)\n\n이 데이터를 통해 머신러닝 모델별, 그리고 질병별 성능을 아래와 같이 시각화해보자. X축에는 모델이, Y축에는 성능이 와야 하고, 각 성능 지표별로 다른 선으로 구성할 것이다. 그리고 각 질병별로 이런 그래프가 나열되어야 한다.\n\n![](images/image-1077021831.png)\n\n우선 데이터 시각화를 위한 데이터프레임을 만들어야 한다. 저 표 형태 그대로는 데이터프레임으로 저장할 수 없다. 따라서 데이터 프레임 형태를 잘 구성하는 게 중요하다.\n\n특정 범주별로 색상을 구분해주는 그래프를 만들기 위해선 X축과 범례에 들어갈 범주 데이터, 그리고 수치에 해당하는 숫자 데이터를 각각 다른 열로 구성해야 한다.\n\n우선 각 모델별 성능별 점수가 질병별로 필요하므로, 질병 열을 구성해준다. 위의 표에서 질병 \\* 모델 \\* 성능을 봤을 때, 하나의 행이 질병 하나의 모델별 성능별 점수인 것을 알 수 있다. 따라서 질병에 따라 모델, 성능, 점수가 길게 늘어지는 long data가 되도록 구성한다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(data.table)\nrequire(ggplot2)\nrequire(ggthemes)\ndf <- data.table(\n  disease = rep(c(\"Death\",\"Heart disease\",\"Stroke\",\"Cancer\",\"Hypertension\",\"Diabetes\"), each=12),\n  model = rep(rep(c(\"Mod1\",\"Mod2\",\"Mod3\",\"Mod4\"),each=3),6),\n  category = rep(c(\"AUC\",\"Accuracy\",\"F1\"), 4*6),\n  score = c(0.863, 0.725, 0.106, 0.873, 0.753, 0.116, 0.877, 0.802, 0.135, 0.887, 0.793, 0.135,\n            0.718,\t0.617,\t0.213,\t0.731,\t0.653, 0.224,\t0.731,\t0.605,\t0.216,\t0.734,\t0.614,\t0.218,\n            0.790,\t0.684,\t0.223,\t0.794,\t0.681, 0.223,\t0.794,\t0.713,\t0.234,\t0.795,\t0.705,\t0.233,\n            0.774,\t0.654,\t0.123,\t0.775,\t0.669, 0.126,\t0.776,\t0.665,\t0.125,\t0.783,\t0.690,\t0.131,\n            0.698,\t0.615,\t0.434,\t0.720,\t0.595, 0.449,\t0.769,\t0.662,\t0.492,\t0.770,\t0.665,\t0.493,\n            0.706,\t0.592,\t0.324,\t0.725,\t0.615, 0.336,\t0.806,\t0.699,\t0.400,\t0.809,\t0.726,\t0.413\n            )\n)\ndf |> head(12)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"disease\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"model\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"category\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"score\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Death\",\"2\":\"Mod1\",\"3\":\"AUC\",\"4\":\"0.863\"},{\"1\":\"Death\",\"2\":\"Mod1\",\"3\":\"Accuracy\",\"4\":\"0.725\"},{\"1\":\"Death\",\"2\":\"Mod1\",\"3\":\"F1\",\"4\":\"0.106\"},{\"1\":\"Death\",\"2\":\"Mod2\",\"3\":\"AUC\",\"4\":\"0.873\"},{\"1\":\"Death\",\"2\":\"Mod2\",\"3\":\"Accuracy\",\"4\":\"0.753\"},{\"1\":\"Death\",\"2\":\"Mod2\",\"3\":\"F1\",\"4\":\"0.116\"},{\"1\":\"Death\",\"2\":\"Mod3\",\"3\":\"AUC\",\"4\":\"0.877\"},{\"1\":\"Death\",\"2\":\"Mod3\",\"3\":\"Accuracy\",\"4\":\"0.802\"},{\"1\":\"Death\",\"2\":\"Mod3\",\"3\":\"F1\",\"4\":\"0.135\"},{\"1\":\"Death\",\"2\":\"Mod4\",\"3\":\"AUC\",\"4\":\"0.887\"},{\"1\":\"Death\",\"2\":\"Mod4\",\"3\":\"Accuracy\",\"4\":\"0.793\"},{\"1\":\"Death\",\"2\":\"Mod4\",\"3\":\"F1\",\"4\":\"0.135\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n하나의 질병 당 모델 네 종류, 그리고 모델 성능 세 종류가 필요하다. 그렇기 떄문에 하나의 질병을 12번씩 반복하여 만들어주면 된다.\n\n다음으로 원하는 순서대로 출력하기 위해, 질병의 순서와 모델 성능의 순서를 정해준다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf$disease <- factor(df$disease, levels=c(\"Death\",\"Heart disease\",\"Stroke\",\"Cancer\",\"Hypertension\",\"Diabetes\"))\ndf$category <- factor(df$category, levels=c(\"AUC\",\"Accuracy\",\"F1\"))\n```\n:::\n\n\n그리고 나서 질병 \\* 모델 \\* 성능 지표 별 점수를 시각화해준다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n df |> \n  ggplot(aes(x=model, y=score, color=category, group=category))+\n  geom_point(aes(shape=category)) + \n  geom_line(aes(lty=category)) + \n  facet_grid(~disease) +\n  scale_x_discrete(labels=c(\"Model 1\", \"Model 2\", \"Model 3\", \"Model 4\"))+\n  scale_y_continuous(limits = c(0,1),\n                     breaks = seq(0,1,0.2),\n                     expand = c(0,0)) + \n  scale_shape_discrete(labels=c(\"AUC\",\"Accuracy\",\"F1-score\"),\n                       name = NULL)+\n  scale_color_tableau(labels=c(\"AUC\",\"Accuracy\",\"F1-score\"),\n                       name = NULL)+\n  scale_linetype_discrete(labels=c(\"AUC\",\"Accuracy\",\"F1-score\"),\n                          name = NULL)+\n  geom_text(aes(label=format(score,3)), vjust=-1, size=1.5) +\n  theme_few() +\n  theme(legend.position = \"top\",\n        legend.direction = \"horizontal\",\n        axis.title = element_blank(),\n        legend.text = element_text(size=7),\n        axis.text = element_text(size=4),\n        strip.text = element_text(size=6, face = \"bold\")) +\n  ggtitle(\"(A) Male (n=64,389)\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n질병은 `facet_grid()`에 포함시켜 옆으로 나열하게끔 시각화 하였다.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}