---
title: "data.table ê¸°ì´ˆ ë¬¸ë²•"
description:  "data.table ë¬¸ë²•, ì—°ì‚°ì, í•¨ìˆ˜"
date: '2023-01-18'
categories: [data.table, R]
---

## 1. data.table ì†Œê°œ

[![data.table](logo.png){fig-align="center"}](https://rdatatable.gitlab.io/data.table/)

`data.table`ì€ Rì˜ `data.frame`ì„ ìƒì†í•˜ì—¬ ë§Œë“¤ì–´ì§„ íŒ¨í‚¤ì§€ì…ë‹ˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ëŒ€ê´„í˜¸(`[]`)ë¥¼ ì“°ëŠ” ë“±ì˜ ë¬¸ë²•ì€ ëŒ€ì²´ë¡œ `data.frame`ê³¼ ë¹„ìŠ·í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ `data.table`ì€ ê¸°ì¡´ì˜ `data.frame`ê³¼ ë‹¤ë¥¸ ì¥ì ì„ ê°–ê³  ìˆìŠµë‹ˆë‹¤.

`data.table`ì˜ ì¥ì ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

-   **ë§¤ìš° ë¹ ë¥¸ ì†ë„**

    `data.table`ì€ ê¸°ë³¸ `data.frame` êµ¬ì¡°ë³´ë‹¤ í›¨ì”¬ ë¹ ë¥´ê²Œ ë°ì´í„°ë¥¼ ì—°ì‚°í•©ë‹ˆë‹¤.

    ```{r}
    require(data.table)
    require(dplyr)
    require(microbenchmark)
    data('storms')
    df_test <- function(){
      aggregate(x=storms[,c('wind','pressure')],
                by = list(storms$name,storms$year, storms$month,storms$day),
                FUN = mean)
    }

    dplyr_test <- function(){
      storms %>% 
        group_by(name, year, month, day) %>% 
        summarise(wind=mean(wind), pressure=mean(pressure),
                  )
    }
    storm_dt <- as.data.table(storms)
    dt_test <- function(){
      storm_dt[,.(wind=mean(wind), pressure=mean(pressure)), by=.(name, year,month,day)]
    }

    microbenchmark(df_test(), dplyr_test(), dt_test(), times=10)

    ```

    ìœ„ëŠ” ê°ê° `data.frame`, `dplyr`, `data.table`ë¡œ ë™ì¼í•œ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ë„ë¡ ì‹¤í–‰í–ˆì„ ë•Œ ê±¸ë¦° ì‹œê°„ì…ë‹ˆë‹¤. `data.table`ì˜ ê²°ê³¼ê°€ ìµœì†Œ 10ë°°ëŠ” ë”ìš± ë¹ ë¥¸ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

-   **íš¨ìœ¨ì ì¸ ë©”ëª¨ë¦¬ ì²˜ë¦¬**

    `data.table`ì€ ë‹¤ë¥¸ ë°ì´í„° íŒ¨í‚¤ì§€ë³´ë‹¤ íš¨ìœ¨ì ìœ¼ë¡œ ë°ì´í„°ì—°ì‚°ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ë©”ëª¨ë¦¬ ì‚¬ìš©ì— ìˆì–´ì„œë„ ë” ì ì€ ì–‘ìœ¼ë¡œ ë” ë¹ ë¥´ê²Œ ê³„ì‚°ì„ ì§„í–‰í•©ë‹ˆë‹¤.

-   **ë‚®ì€ íŒ¨í‚¤ì§€ ì˜ì¡´ì„±**

    íŒ¨í‚¤ì§€ ì˜ì¡´ì„±ì´ë¼ëŠ” ê²ƒì€ íŠ¹ì • íŒ¨í‚¤ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ê¸° ìœ„í•´ ë˜ë‹¤ë¥¸ íŒ¨í‚¤ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ìš°ë¦¬ê°€ ë°°ìš¸ `data.table`ì€ R ì‚¬ìš©ìë“¤ì—ê²Œ ìì£¼ í™œìš©ë˜ëŠ” `tidyverse` ê³„ì—´ì˜ `dplyr`íŒ¨í‚¤ì§€ë³´ë‹¤ ì˜ì¡´ì„±ì´ í›¨ì”¬ ë‚®ìŠµë‹ˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ë²ˆê±°ë¡­ê²Œ í•˜ë‚˜ì˜ íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë‹¤ë¥¸ íŒ¨í‚¤ì§€ë“¤ì„ ì„¤ì¹˜í•´ì¤„ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.

    ![dplyr vs data.table íŒ¨í‚¤ì§€ ì˜ì¡´ì„± ë¹„êµ](https://pbs.twimg.com/media/FJ5hZ-sXoA0acyu?format=jpg&name=medium)

------------------------------------------------------------------------

## 2. data.table í•¨ìˆ˜

`data.table` íŒ¨í‚¤ì§€ì—ëŠ” `data.table`ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê³ ìœ ì˜ í•¨ìˆ˜ë“¤ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ìš°ì„  ì•ìœ¼ë¡œ ì‚¬ìš©í•  ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ì„¤ì •í•˜ê¸° ìœ„í•œ í•¨ìˆ˜ë“¤ì„ ìš°ì„  ë°°ì›Œë´…ì‹œë‹¤.

-   `fread()`: f(ast) + readì˜ ì˜ë¯¸ì…ë‹ˆë‹¤. ë§ê·¸ëŒ€ë¡œ ë¹ ë¥´ê²Œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒ(read)ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. `.csv`, `.txt` ë“±ì˜ í™•ì¥ì ì´ë¦„ì„ ê°€ì§„ íŒŒì¼ë“¤ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```{r}
require(NHANES)
dt <- as.data.table(NHANES)
```

`fread()`ë¥¼ í†µí•´ ë¶ˆëŸ¬ì˜¨ íŒŒì¼ì˜ `class`ëŠ” `data.table`ì…ë‹ˆë‹¤.

```{r}
class(dt)
```

`data.table`ì„ ì¶œë ¥í–ˆì„ ë•Œ, `data.frame`ê³¼ ë‹¤ë¥¸ ì ì€ í¬ê²Œ ë‘ ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.

`data.table`ì€ ìš°ì„  ëª¨ë“  columnì— ëŒ€í•´ ì²« 5ê°œ, ë§ˆì§€ë§‰ 5ê°œì˜ í–‰ì„ ì¶œë ¥í•©ë‹ˆë‹¤.

ë˜í•œ í–‰ì˜ ë²ˆí˜¸ì— `:`ê°€ ë¶™ì–´ ì¶œë ¥ë©ë‹ˆë‹¤.

-   `fwrite()`: f(ast) + write ì…ë‹ˆë‹¤. ë§ê·¸ëŒ€ë¡œ ë¹ ë¥´ê²Œ ë°ì´í„°ë¥¼ ì €ì¥(write)í•©ë‹ˆë‹¤. `.csv`, `.txt` ë“±ì˜ í™•ì¥ì íŒŒì¼ë¡œ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```{r}
names(dt)
```

-   `setnames()`: column ì´ë¦„ì„ ì‚¬ìš©ìê°€ ì•Œì•„ë³´ê¸° ì‰½ê²Œë” ë³€ê²½í•´ì•¼ í•  ë•Œê°€ ìˆìŠµë‹ˆë‹¤. `setnames()`ëŠ” columnì˜ ì´ë¦„ì„ ë³€ê²½í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤. columnì˜ ì´ë¦„ì„ í•˜ë‚˜ë§Œ ë°”ê¾¸ê³  ì‹¶ì€ ê²½ìš°ì—ëŠ” ë¬¸ìì—´ í•˜ë‚˜ë§Œ ë„£ì–´ì£¼ë©´ ë˜ê³ , ì—¬ëŸ¬ ê°œì˜ column ì´ë¦„ì„ ë™ì‹œì— ë³€ê²½í•  ë•ŒëŠ” ë¬¸ì ë²¡í„°ë¥¼ ë„£ì–´ì£¼ë©´ ë©ë‹ˆë‹¤.

```{r}
# í•˜ë‚˜ì˜ column ì´ë¦„ì„ ë³€ê²½í•  ë•Œ
setnames(dt, old='Gender', new='gender')

# ì—¬ëŸ¬ ê°œì˜ column ì´ë¦„ì„ ë™ì‹œì— ë³€ê²½í•  ë•Œ
setnames(dt,
         old = c('Age','Race1','Education'),# ë°”ê¿”ì¤„ ê¸°ì¡´ì˜ column ì´ë¦„
         new = c('age','race','education') # ìƒˆë¡œìš´ column ì´ë¦„
         )
```

-   `data.frame` ë“±ì„ `data.table`ë¡œ ë³€ê²½í•˜ê¸°

    ìƒˆë¡­ê²Œ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒ ë¿ë§Œ ì•„ë‹ˆë¼ ê¸°ì¡´ì˜ `data.frame`ì„ `data.table` í˜•íƒœë¡œ ë³€ê²½í•´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

    -   `setDT()` : ì˜êµ¬ì ìœ¼ë¡œ `data.table` í˜•íƒœë¡œ **ì €ì¥**í•©ë‹ˆë‹¤. ì €ì¥ëœ ê°’ì„ ë”°ë¡œ ì¶œë ¥í•˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤.

        ```{r}
        # setDT()
        ```

    -   `as.data.table()` : ì¼ì‹œì ìœ¼ë¡œ `data.table` í˜•íƒœë¡œ **ì¶œë ¥**í•©ë‹ˆë‹¤. ì¶œë ¥ëœ ë°ì´í„°ê°€ ì €ì¥ë˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤.

        ```{r}
        require(data.table)
        as.data.table(iris)
        ```

------------------------------------------------------------------------

## 3. i: data.table í–‰

`data.table`ì—ì„œ í–‰(row)ì„ ë‹¤ë£¨ëŠ” ë¶€ë¶„ì„ `i` ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤ (ì™œ iê°€ ëœê±´ì§€ëŠ” ëª¨ë¥´ê² ìŠµë‹ˆë‹¤).

`data.table`ì—ì„œ í–‰ì„ ë‹¤ë£¬ë‹¤ëŠ” ê²ƒì€ [íŠ¹ì •í•œ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” í–‰ë“¤ì„ ì¶”ì¶œ ë˜ëŠ” ì„ íƒ]{.underline}(filtering)í•œë‹¤ëŠ” ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤.

ì, ì´ì œ `data.table`ì—ì„œ í–‰ì„ ë‹¤ë£¨ëŠ” ë°©ë²•ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

### 1) ë…¼ë¦¬ ì—°ì‚°ìë¥¼ ì´ìš©í•œ row filtering

`data.frame` ì˜ í–‰ì„ ë‹¤ë£¨ëŠ” ë¶€ë¶„ì—ì„œë„ ë°°ì› ì§€ë§Œ, ê¸°ë³¸ì ìœ¼ë¡œ iì—ì„œëŠ” ë…¼ë¦¬ ì—°ì‚°ìë¥¼ ì´ìš©í•´ í–‰ì„ ì„ íƒí•©ë‹ˆë‹¤. ë…¼ë¦¬ ì—°ì‚°ìì˜ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” í–‰ë“¤, ì¦‰ ë…¼ë¦¬ ì—°ì‚°ìì˜ ì‹¤í–‰ ê²°ê³¼ê°€ `TRUE` ì¸ í–‰ë“¤ë§Œ ì¶”ì¶œí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

```{r}
dt[age>=30]
```

```{r}
dt[gender=='male' & age>=45] # ë‚¨ì„±ì´ê³  45ì„¸ ì´ìƒ
```

```{r}
dt[gender=='female' | age>=50] #ì—¬ì„± ë˜ëŠ” 50ì„¸ ì´ìƒ
```

ì´ì²˜ëŸ¼ `&`ë‚˜ `|`ë¥¼ ë¶™ì—¬ì£¼ë©´, ì—¬ëŸ¬ ì¡°ê±´ì„ ì‚¬ìš©í•˜ì—¬ ì›í•˜ëŠ” í–‰ë“¤ì„ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

::: callout-important
## í–‰ì„ ë‹¤ë£° ë•Œ data.tableê³¼ data.frameì˜ ì°¨ì´ì 

`data.frame`ê³¼ ë‹¬ë¦¬ `data.table` ë¬¸ë²•ì—ì„œëŠ”, ëŒ€ê´„í˜¸ ì•ˆì—ì„œ columnì„ `df$var` ì–‘ì‹ìœ¼ë¡œ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤. ê·¸ëƒ¥ columnì˜ ì´ë¦„ë§Œ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.

ë˜í•œ `data.frame`ì—ì„œëŠ” í–‰ ë¶€ë¶„ì„ ì…ë ¥í•  ë•Œ, ê¼­ `,` ë¥¼ ë¶™ì—¬ì¤˜ì•¼ í–ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ `data.table`ì˜ ê²½ìš° í–‰ë§Œ filtering í•  ë•Œ, êµ³ì´ `,`ì„ ë¶™ì—¬ì¤„ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.

ì–´ë–¤ê°€ìš”? `data.table`ì´ í›¨ì”¬ ë” ê°„ë‹¨í•˜ì£ ? ğŸ˜ƒ
:::

### 2) Infix ì—°ì‚°ìë¥¼ ì´ìš©í•œ row filtering

`data.table`ì—ì„œëŠ” ë…¼ë¦¬ ì—°ì‚°ì ë¿ë§Œ ì•„ë‹ˆë¼ infix ì—°ì‚°ìë¥¼ ì´ìš©í•˜ì—¬, ì¡°ê±´ì„ ì¶©ì¡±ì‹œí‚¤ëŠ” í–‰ì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŒŒì´í”„ ì—°ì‚°ì ì—­ì‹œ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ê²½ìš°ì¸ `TRUE` ì— í•´ë‹¹í•˜ëŠ” ê°’ë“¤ë§Œ ì„ íƒí•©ë‹ˆë‹¤.

::: callout-note
## Infix ì—°ì‚°ìë€?

infix ì—°ì‚°ìëŠ” í•¨ìˆ˜ í”¼ì—°ì‚°ìì˜ ì–‘ìª½ì— ìˆëŠ” ì¸ìˆ˜ì— ê³„ì‚°ì„ ì ìš©í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
:::

-   `A %in% B`: Aê°€ B ì•ˆì— ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. ì´ ë•Œ BëŠ” `vector`ê°€ ì˜µë‹ˆë‹¤. ë¬¸ìë¥¼ í™•ì¸í•˜ëŠ” ê²½ìš°ì—ëŠ” `%chin%` ì„ ì´ìš©í•´ ë”ìš± ë¹ ë¥´ê²Œ ê³„ì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

    ```{r}
    dt[race %in% c('Black','White')]
    ```

-   `A %like% B`: Aê°€ Bì™€ ë¹„ìŠ·í•œì§€ í™•ì¸í•©ë‹ˆë‹¤. ì´ ë•Œ Bì—ëŠ” ë³´í†µ ë¬¸ìì—´(`character`)ì´ ì˜µë‹ˆë‹¤.

    ```{r}
    dt[MaritalStatus %like% 'Married']
    ```

-   `A %between% B`: Aê°€ B ì‚¬ì´ì— ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. ì´ ë•Œ BëŠ” `c(0,10)`ê³¼ ê°™ì€ ë²”ìœ„ë¡œ ì§€ì •í•©ë‹ˆë‹¤.

    ```{r}
    dt[BMI %between% c(20,25)]
    ```

::: callout-tip
## íŒŒì´í”„ ì—°ì‚°ì ëŒ€ì‹  í•¨ìˆ˜ ì´ìš©í•˜ê¸°

ìœ„ì—ì„œ ì†Œê°œí•´ë“œë¦° %%ì„ ì´ìš©í•œ íŒŒì´í”„ ì—°ì‚°ì ë§ê³ ë„ data.table íŒ¨í‚¤ì§€ ë‚´ì˜ í•¨ìˆ˜ë¥¼ ì´ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

`%between%`ì€ `between()`

`%like%` ëŠ” `like()`

```{r}
dt[like(race,'ite')]
```
:::

### 3) í•¨ìˆ˜ë¥¼ ì´ìš©í•œ row filtering

ë…¼ë¦¬ ì—°ì‚°ìë‚˜ infix ì—°ì‚°ì ë¿ë§Œ ì•„ë‹ˆë¼ `TRUE`/`FALSE`ë¥¼ ë°˜í™˜í•˜ëŠ” ë‹¤ë¥¸ í•¨ìˆ˜ë“¤ë„ í–‰ì„ ì„ íƒí•˜ëŠ” ë° í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°€ì¥ ëŒ€í‘œì ì¸ í•¨ìˆ˜ê°€ ë°”ë¡œ `is.na()` ì…ë‹ˆë‹¤.

```{r}
dt[is.na(Testosterone)]
```

`NA`ê°€ ì•„ë‹Œ ë°ì´í„°ë¥¼ ì¶œë ¥í•˜ëŠ” ë°©ë²•ì€ `!is.na()` ì…ë‹ˆë‹¤. Chapter 2ì˜ ë…¼ë¦¬ ì—°ì‚°ì ë¶€ë¶„ì—ì„œ `NOT`ì„ ì˜ë¯¸í•˜ëŠ” ê¸°í˜¸ëŠ” `!`ë¼ê³  ë°°ì› ìŠµë‹ˆë‹¤.

```{r}
dt[!is.na(SleepHrsNight)]
```

### 4) í–‰ì˜ ì •ë ¬

í–‰ì˜ ì •ë ¬ ì—­ì‹œ `i` ë¶€ë¶„ì—ì„œ ë‹´ë‹¹í•©ë‹ˆë‹¤. íŠ¹ì •í•œ columnì„ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì˜¤ë¦„ì°¨ìˆœ ë˜ëŠ” ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ì„ í•  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`data.table`ì—ì„œ íŠ¹ì • columnì„ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì •ë ¬í•˜ëŠ” ë°©ë²•ì€ ë‘ ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.

-   `order()`

    `order()`ëŠ” ì •ë ¬í•œ ê°’ì˜ ì¶œë ¥ë§Œ í•©ë‹ˆë‹¤.

    ```{r}
    dt[order(BMI)] |> head()
    ```

    ë§Œì•½ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬í•˜ê³  ì‹¶ì€ ê²½ìš°ëŠ” ë³€ìˆ˜ ì•ì— -ë¥¼ ë¶™ì—¬ì£¼ë©´ ë©ë‹ˆë‹¤.

    ```{r}
    dt[order(-BMI)] |> head()
    ```

-   `setorder()`

    `setorder()`ëŠ” ë°ì´í„°ë¥¼ ì •ë ¬í•˜ì—¬ data.tableì— ì €ì¥í•©ë‹ˆë‹¤. `order`ì™€ëŠ” ë‹¤ë¥´ê²Œ ì •ë ¬ëœ ê²°ê³¼ë¥¼ ì¶œë ¥í•˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤.

    ```{r}
    setorder(dt, # ì •ë ¬í•  ë°ì´í„°
             age # ê¸°ì¤€ì´ ë˜ëŠ” ë³€ìˆ˜
             )
    ```

::: callout-tip
## setì´ ë“¤ì–´ê°€ëŠ” í•¨ìˆ˜

`data.table`ì—ì„œ `set`ì´ ë¶™ëŠ” í•¨ìˆ˜ëŠ” ì–´ë–¤ ê°’ì„ ì¶œë ¥ì—†ì´ ì €ì¥í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.

```{r eval=FALSE}
#| eval: false
setnames() # columnì˜ ì´ë¦„ ë³€ê²…
setorder() # row ì •ë ¬
setDT() #  data.tableë¡œ ì €ì¥
```
:::

------------------------------------------------------------------------

## 4. j: data.table ì—´

`j` ë¶€ë¶„ì€ ë°ì´í„°ì˜ ì—´ (column)ì„ ë‹¤ë£¨ëŠ” ë¶€ë¶„ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. `j` ë¶€ë¶„ì„ í†µí•´ ì›í•˜ëŠ” ì—´ë“¤ì„ ì„ íƒí•˜ê±°ë‚˜, íŠ¹ì • ì—´ì„ ê³„ì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ìƒˆë¡œìš´ ë³€ìˆ˜ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ê¸°ì¡´ì˜ ë³€ìˆ˜ë¥¼ ìˆ˜ì • ë˜ëŠ” ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`j` ë¥¼ í™œìš©í•˜ê¸° ìœ„í•´ì„  `dt[,j]` ì²˜ëŸ¼ ì•ì— `,`ë¥¼ í•­ìƒ ë¶™ì—¬ì¤˜ì•¼ í•©ë‹ˆë‹¤.

### 1) column ì„ íƒ

`data.table`ì—ì„œ ì—´ì„ ì„ íƒí•˜ëŠ” ë°©ë²•ì€ ë‹¤ì–‘í•©ë‹ˆë‹¤.

-   `dt[,c('X','Y')]`

-   `dt[,list(X,Y)]`

-   `dt[,.(X,Y)]`

ì—¬ê¸°ì„œ `list()`ì™€ `.()`ì€ ë™ì¼í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤. ë™ì¼í•œ ê¸°ëŠ¥ì´ë¼ë©´ ë” ì ì€ ì½”ë“œë¥¼ ì…ë ¥í•˜ëŠ” í›„ìê°€ ë” ë‚«ê² ì£ ?

```{r}
dt[,.(gender,age)]
```

ë¬¸ì vectorë¥¼ ì´ìš©í•´ì„œë„ ì›í•˜ëŠ” columnì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë•ŒëŠ” `..`ê¸°í˜¸ë¥¼ ì´ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

```{r}
target <- c('gender','age','race')
dt[,..target]
```

### 2) column ê³„ì‚°

columnì„ ê³„ì‚°í•˜ëŠ” ê²ƒ ì—­ì‹œ `data.table`ì˜ `j` ë¶€ë¶„ì—ì„œ ë‹´ë‹¹í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ íŠ¹ì • columnì˜ í‰ê· ì„ ê³„ì‚°í•˜ê±°ë‚˜ í‘œì¤€í¸ì°¨ë¥¼ ê³„ì‚°í•˜ëŠ” ê²½ìš°ê°€ ìˆê² ì£ . ë§Œì•½ í•˜ë‚˜ì˜ columnë§Œ ê³„ì‚°í•˜ëŠ” ê²½ìš° `data.table`ì˜ `[]` ì•ˆì—ì„œ í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ë©´ ë©ë‹ˆë‹¤.

```{r}
dt[,mean(BMI,na.rm=T)]
```

ë§Œì•½ ì—¬ëŸ¬ ê°œì˜ columnì— ëŒ€í•´ ê³„ì‚°í•˜ëŠ” ê²½ìš° ë˜ëŠ” ê³„ì‚°í•˜ëŠ” ê°’ì„ `data.table` í˜•íƒœë¡œ ì¶œë ¥í•˜ê³  ì‹¶ì€ ê²½ìš°, column ì„ íƒì—ì„œ ë°°ì› ë˜ `.()`ë¥¼ í™œìš©í•˜ë©´ ë©ë‹ˆë‹¤.

```{r}
dt[,.(mean_BMI = mean(BMI, na.rm=T),
      sd_BMI = sd(BMI,na.rm=T))]
```

### 3) column ìƒì„± ë° ë³€ê²½ `:=`

`data.table`ì—ëŠ” íŠ¹ìˆ˜í•œ ê¸°í˜¸ê°€ ìˆìŠµë‹ˆë‹¤. ë°”ë¡œ `:=` ì…ë‹ˆë‹¤. walrus (ë°”ë‹¤ì½”ë¼ë¦¬) ì—°ì‚°ìë¼ê³ ë„ ë¶ˆë¦¬ê¸°ë„ í•©ë‹ˆë‹¤. ë°”ë‹¤ì½”ë¼ë¦¬ì˜ ì–´ê¸ˆë‹ˆë¥¼ ë‹®ì•„ì„œ ë¶™ì—¬ì§„ ì´ë¦„ ê°™ìŠµë‹ˆë‹¤.

![ë°”ë‹¤ì½”ë¼ë¦¬(Walrus)ì˜ ì–´ê¸ˆë‹ˆê°€ `:=` ì™€ ë‹®ì•˜ìŠµë‹ˆë‹¤.](walrus.jpg){fig-align="center" width="400"}

`data.table`ì„ ì‚¬ìš©í•œë‹¤ë©´ `:=` ì—°ì‚°ìë¥¼ í™œìš©í•  ì¤„ ì•„ëŠ” ê²ƒì´ êµ‰ì¥íˆ ì¤‘ìš”í•©ë‹ˆë‹¤. ìƒˆë¡œìš´ columnì„ ì¶”ê°€í•˜ê±°ë‚˜, ê¸°ì¡´ì˜ columnì„ ë³€ê²½í•  ë•Œ, ë˜ëŠ” columnì„ ì‚­ì œí•  ë•Œ í™œìš©ë˜ëŠ” ì—°ì‚°ì ì…ë‹ˆë‹¤.

#### a. columnì˜ ìƒì„±

ìƒˆë¡œìš´ columnì„ ìƒì„±í•˜ê¸° ìœ„í•´ì„œëŠ” `dt[,column_name := value]` í˜•ì‹ìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤. `:=`ì˜ ì™¼ìª½ì—ëŠ” ìƒˆë¡œìš´ columnì˜ ì´ë¦„ì´, ì˜¤ë¥¸ìª½ì—ëŠ” ë°ì´í„°ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.

```{r}
dt[,age_group := paste0((age %/% 10) * 10,'ëŒ€')]
dt[,table(age_group)]
```

`age` ë¥¼ ì´ìš©í•˜ì—¬ `age_group`(ì—°ë ¹ëŒ€) columnì„ ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤.

ë§Œì•½ ì—¬ëŸ¬ ê°œì˜ columnì„ ë™ì‹œì— ì¶”ê°€í•˜ê³  ì‹¶ë‹¤ë©´, ë°±í‹±(``` `` ```) ë˜ëŠ” ë”°ì˜´í‘œ(`''`)ê³¼ í•¨ê»˜ `:=`ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

ì´ ë•Œ `()`ì•ˆì˜ ë“±í˜¸ë“¤ì€ `:=`ê°€ ì•„ë‹ˆë¼ ê·¸ëƒ¥ ë“±í˜¸(`=`)ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

```{r}
dt[,`:=`(
  age2 = age/5,
  age3 = age/10
)]
```

#### b. columnì˜ ë³€ê²½

columnì„ ë³€ê²½í•œë‹¤ëŠ” ê²ƒì€ ê¸°ì¡´ì˜ column ê°’ë“¤ì„ ë‹¤ë¥´ê²Œ ë°”ê¿”ì¤€ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ë©´ 1ê³¼ 2ë¡œ ì´ë£¨ì–´ì§„ columnì„ 'no'ì™€ 'yes'ë¡œ ë³€ê²½í•´ì£¼ëŠ” ê²ƒì²˜ëŸ¼ìš”.

columnì„ ë³€ê²½í•˜ëŠ” ê²ƒ ì—­ì‹œ ìƒì„±ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ `dt[,column_name := value]` í˜•ì‹ìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ ë©ë‹ˆë‹¤. `column_name`ì—ëŠ” ë°”ê¿”ì¤„ columnì˜ ì´ë¦„ì´, `value`ì—ëŠ” ìƒˆë¡­ê²Œ ë„£ì–´ì¤„ ë°ì´í„°ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.

```{r}
dt[,gender := ifelse(gender=='male','m','f')]
```

ìœ„ì˜ ì½”ë“œì²˜ëŸ¼ `:=`ë¥¼ ì´ìš©í•´ `male`, `female`ë¡œ ë˜ì–´ìˆëŠ” `Gender` ë¥¼ ê°ê° `m`ê³¼ `f`ë¡œ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í•œí¸ ì—¬ëŸ¬ ê°œì˜ columnì„ ìƒì„±í•˜ê±°ë‚˜ ë³€ê²½í•˜ëŠ” ê²½ìš°, ìƒˆë¡œìš´ columnì´ ìƒì„±ë˜ëŠ” `[]`ì•ˆì—ì„œ ê·¸ columnì„ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

```{r eval=FALSE}
#|eval: false
dt[,`:=`(
  A2=age,
  A3=A2
)]

# ì—ëŸ¬ë©”ì‹œì§€ ë°œìƒ
# Error in eval(jsub, SDenv, parent.frame()) : object 'A2' not found
```

ìœ„ ì½”ë“œëŠ” A2ì™€ A3 columnì„ ë™ì‹œì— ìƒì„±í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ A2ê°€ ì•„ì§ ë§Œë“¤ì–´ì§€ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì—, A3 columnì€ ìƒì„±ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ,

```{r}
dt[,A2:=age][,A3:=A2][]
```

ìœ„ì˜ ì½”ë“œì²˜ëŸ¼ `[]`ì„ ì—¬ëŸ¬ ë²ˆ ë¶™ì—¬ ìˆœì°¨ì ìœ¼ë¡œ columnì„ ìƒì„± ë˜ëŠ” ë³€ê²½í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ **chaining**ì´ë¼ê³  í•©ë‹ˆë‹¤.

#### c. columnì˜ ì‚­ì œ

íŠ¹ì • ë°ì´í„°ì˜ columnì„ ì‚­ì œí•  ë•ŒëŠ” `dt[,column_name := NULL]` í˜•ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì‚­ì œí•˜ë ¤ëŠ” í•˜ëŠ” `column_name`ë§Œ ì„ íƒí•˜ë©´ ë˜ê² ì£ .

```{r}
dt[,column_name := NULL] # ì‚­ì œëŒ€ìƒ ì—´ ì´ë¦„ := NULL
```

`:=` ì—°ì‚°ìë¥¼ í™œìš©í•œ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê²Œ ë˜ë©´ í•´ë‹¹ ë°ì´í„°ê°€ ì €ì¥ì´ ë  ë¿, ì¶œë ¥ì´ ë˜ì§„ ì•ŠìŠµë‹ˆë‹¤ (`set`í•¨ìˆ˜ì™€ ê°™ì€ ì—­í• ). ë³€ê²½í•œ columnì„ í™•ì¸í•˜ê¸° ìœ„í•´ì„  ëŒ€ê´„í˜¸ë¥¼ í•œ ë²ˆ ë” ë¶™ì—¬ì¤ë‹ˆë‹¤.

```{r eval=FALSE}
dt[,column_name := NULL][]
```

------------------------------------------------------------------------

## 5. by: ê·¸ë£¹ ë³„ ë¶„ì„

`by`: íŠ¹ì • columnì— ë”°ë¼ `j` ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì„±ë³„ì— ë”°ë¥¸ ë‚˜ì´ì˜ í‰ê· ì„ êµ¬í•˜ëŠ” ê²½ìš°, ë”°ë¼ì„œ [`by`ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” `j` ë¶€ë¶„ì´ ì¡´ì¬í•´ì•¼]{.underline} í•©ë‹ˆë‹¤.

```{r}
dt[,mean(age),by=MaritalStatus]
```

`keyby`: byì™€ ë§ˆì°¬ê°€ì§€ë¡œ íŠ¹ì • ê·¸ë£¹ì— ë”°ë¼ ê³„ì‚°í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ `by`ì™€ ë‹¤ë¥´ê²Œ ê·¸ë£¹ìœ¼ë¡œ ì„ íƒëœ columnì„ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ê²°ê³¼ê°’ì„ ì¶œë ¥í•©ë‹ˆë‹¤.

```{r}
dt[,mean(age),keyby=MaritalStatus]
```

í˜¼ì¸ìƒíƒœ(`MaritalStatus`)ì— ë”°ë¥¸ ë‚˜ì´(`age`)ì˜ í‰ê·  ê°’ì´ í˜¼ì¸ìƒíƒœì˜ ì´ë¦„ìœ¼ë¡œ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬ì´ ë˜ì–´ ì¶œë ¥ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

------------------------------------------------------------------------

## 6. ì´ì™¸ ìœ ìš©í•œ data.table ì „ìš© í•¨ìˆ˜

-   `fifelse()`: fast ifelseì…ë‹ˆë‹¤. `ifelse()`ë³´ë‹¤ ë” ë¹ ë¥´ê²Œ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.ê¸°ë³¸ `ifelse()`ì™€ ë‹¤ë¥´ê²Œ yesì™€ no ìë¦¬ì— ì˜¤ëŠ” ì¸ìë“¤ì˜ ìœ í˜•(type)ì´ ë°˜ë“œì‹œ ë™ì¼í•´ì•¼ í•©ë‹ˆë‹¤.

    ```{r}
    dt[,SEX := fifelse(gender=='m','ë‚¨ì„±','ì—¬ì„±')]
    dt[,Temp := fifelse(age<10,NA,age)] # error ë°œìƒ.
    ```

-   `fcase()` : fast case whenì…ë‹ˆë‹¤. `ifelse()`ì²˜ëŸ¼ ì¡°ê±´ì„ ì‚¬ìš©í•´ ë°ì´í„°ë¥¼ ì¡°ì‘í•˜ì§€ë§Œ, ë°˜ë³µì ìœ¼ë¡œ `ifelse()` í•¨ìˆ˜ë¥¼ ê³„ì†í•´ì„œ ì‚¬ìš©í•  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì— ë” ì ì€ ì½”ë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

    ```{r}
    dt[,age_group2 := fcase(
      age<20,'10ëŒ€',
      age<30,'20ëŒ€',
      age<40,'30ëŒ€',
      age<50,'40ëŒ€',
      age<60,'50ëŒ€'
    )]
    dt[,table(age_group2, useNA = 'always')]
    ```

    ì¡°ê±´ì— í•´ë‹¹ë˜ì§€ ì•ŠëŠ” ë‚˜ë¨¸ì§€ ê°’ë“¤ì€ ìë™ìœ¼ë¡œ `NA` ì²˜ë¦¬ ë©ë‹ˆë‹¤. ë‚˜ë¨¸ì§€ ê°’ë“¤ì— ê°’ì„ ì£¼ê³  ì‹¶ë‹¤ë©´ `default` ì¸ìë¥¼ í™œìš©í•˜ë©´ ë©ë‹ˆë‹¤.

    ```{r}
    dt[,age_group2 := fcase(
      age<20,'10ëŒ€',
      age<30,'20ëŒ€',
      age<40,'30ëŒ€',
      age<50,'40ëŒ€',
      age<60,'50ëŒ€',
      default='60ëŒ€ ì´ìƒ'
    )]
    dt[,table(age_group2, useNA = 'always')]
    ```

-   `uniqueN()` : ê³ ìœ í•œ ë°ì´í„°ì˜ ìˆ˜ë¥¼ í™•ì¸í•˜ëŠ” ë° ì‚¬ìš©í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤. ì£¼ë¡œ ì‚¬ëŒì˜ ID ìˆ˜ë¥¼ ì¹´ìš´íŠ¸ í•˜ëŠ” ë° ì‚¬ìš©í•©ë‹ˆë‹¤.

    ```{r}
    dt[,BMI2:=fifelse(is.na(BMI),'donno', fifelse(BMI>=30,'obese','normal'))][,uniqueN(BMI2)]
    ```
